<!DOCTYPE html>
<!-- saved from url=(0050)http://www.haomou.net/2014/09/12/2014_angularjs_2/ -->
<html class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  
  <title>AngularJS笔记-详细使用 | 皓眸大前端-前端开发学习交流圈子</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="指令用处AngularJS这个框架真的比较神奇，就像一杯酒，你用的越久，越喜欢用这个框架。之前我是觉得用Angular做一些复杂的效果不好做，好多都是用jQuery来辅助实现的。今天我这里要详细总结的是Angular的使用方法，包括数据绑定，过滤器，自定义模块及服务，指令等。其中通过指令可以自定义html标签，并解析成自己需要的内容。注意本文中“{”表示的是“{”，“|”表示的是“|”，转义后显示">
<meta property="og:type" content="article">
<meta property="og:title" content="AngularJS笔记-详细使用">
<meta property="og:url" content="http://haomou.net/2014/09/12/2014_angularjs_2/index.html">
<meta property="og:site_name" content="皓眸大前端-前端开发学习交流圈子">
<meta property="og:description" content="指令用处AngularJS这个框架真的比较神奇，就像一杯酒，你用的越久，越喜欢用这个框架。之前我是觉得用Angular做一些复杂的效果不好做，好多都是用jQuery来辅助实现的。今天我这里要详细总结的是Angular的使用方法，包括数据绑定，过滤器，自定义模块及服务，指令等。其中通过指令可以自定义html标签，并解析成自己需要的内容。注意本文中“{”表示的是“{”，“|”表示的是“|”，转义后显示">
<meta property="og:image" content="http://haomou.net/images/angular1.png">
<meta property="og:updated_time" content="2016-05-10T05:36:24.986Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AngularJS笔记-详细使用">
<meta name="twitter:description" content="指令用处AngularJS这个框架真的比较神奇，就像一杯酒，你用的越久，越喜欢用这个框架。之前我是觉得用Angular做一些复杂的效果不好做，好多都是用jQuery来辅助实现的。今天我这里要详细总结的是Angular的使用方法，包括数据绑定，过滤器，自定义模块及服务，指令等。其中通过指令可以自定义html标签，并解析成自己需要的内容。注意本文中“{”表示的是“{”，“|”表示的是“|”，转义后显示">
<meta name="twitter:image" content="http://haomou.net/images/angular1.png">
  
  
    <link rel="icon" href="http://www.haomou.net/favicon.png">
  

  <link rel="stylesheet" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/style.css">
  
    <link rel="stylesheet" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/jquery.fancybox.css">
  
  
    <link rel="stylesheet" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/style(1).css">
  
  


  
    <style type="text/css">
      .logo { background-image:url(/logo.png); }
    </style>
  

  
    <link href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/css" rel="stylesheet" type="text/css">
    <link href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/css(1)" rel="stylesheet" type="text/css">
  

<script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/share.js"></script><script type="text/javascript" async="" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/embed.js" charset="UTF-8"></script><style type="text/css">.fancybox-margin{margin-right:17px;}</style><link rel="stylesheet" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/share_style0_32.css"><link type="text/css" rel="stylesheet" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/embed.default.css"></head>

<body>
  <div id="wrap">
    <header id="header">

  <embed id="bac_flash" allowscriptaccess="never" allownetworking="internal" invokeurls="false" src="/images/bck.swf" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" quality="high" autostart="0" wmode="transparent" width="100%" height="300" align="middle" style="position: absolute;margin-top: -100px;margin-left: 5px;">

  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <!-- <a href="/" class="logo"></a> -->
             <a href="http://www.fed123.com/"><img alt="fedǰ��" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/logo.png" width="121px" height="75px" style="display: block;" data-bd-imgshare-binded="1"></a>
          </h1>
          
            <h2 class="subtitle-wrap">
              <p class="subtitle">前端开发(Front End Developer)</p>
            </h2>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
                <li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/">主页</a></li>
              
                    <li class="main-nav-list-item"><a class="main-nav-list-link current" href="http://www.haomou.net/categories/Angular-React/">Angular|React</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/HTML5-CSS3/">HTML5|CSS3</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/JAVA/">JAVA</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/JavaScript-NodeJs/">JavaScript|NodeJs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/WebGL-ThreeJs/">WebGL|ThreeJs</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/ionic-reapp/">ionic|reapp</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/loopback-%E6%9C%8D%E5%8A%A1%E7%AB%AF/">loopback|服务端</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></li>
                  
            </ul>

          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="http://www.haomou.net/categories/Angular-React/">Angular|React</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-2014_angularjs_2" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      AngularJS笔记-详细使用
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子.html" class="article-date">
  <time datetime="2014-09-12T03:40:49.000Z" itemprop="datePublished">2014-09-12</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <h3 id="指令用处"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#指令用处" class="headerlink" title="指令用处"></a>指令用处</h3><p>AngularJS这个框架真的比较神奇，就像一杯酒，你用的越久，越喜欢用这个框架。之前我是觉得用Angular做一些复杂的效果不好做，好多都是用jQuery来辅助实现的。今天我这里要详细总结的是Angular的使用方法，包括数据绑定，过滤器，自定义模块及服务，指令等。其中通过指令可以自定义html标签，并解析成自己需要的内容。注意本文中“{”表示的是“{”，“|”表示的是“|”，转义后显示有点问题。<br><a id="more"></a><br><img class="floatnone scrollLoading" alt="皓眸大前端开发学习" data-url="/images/angular1.png" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/angular1.png" data-bd-imgshare-binded="1"><span class="caption">皓眸大前端开发学习</span><br><br></p>
<p>转载请注明出处：<a href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子.html" target="_blank" rel="external">http://www.haomou.net/2014/09/12/2014_angularjs_2/</a></p>
<h3 id="AngularJS"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AngularJS" class="headerlink" title="AngularJS"></a>AngularJS</h3><p>AngularJS 是 Google 开源出来的一套 js 工具。下面简称其为 ng 。这里只说它是“工具”，没说它是完整的“框架”，是因为它并不是定位于去完成一套框架要做的事。更重要的，是它给我们揭示了一种新的应用组织与开发方式。</p>
<p>ng 最让我称奇的，是它的数据双向绑定。其实想想，我们一直在提数据与表现的分离，但是这里的“双向绑定”从某方面来说，是把数据与表现完全绑定在一起——数据变化，表现也变化。反之，表现变化了，内在的数据也变化。有过开发经验的人能体会到这种机制对于前端应用来说，是很有必要的，能带来维护上的巨大优势。当然，这里的绑定与提倡的分离并不是矛盾的。</p>
<p>ng 可以和 jQuery 集成工作，事实上，如果没有 jQuery ， ng 自己也做了一个轻量级的 jQuery ，主要实现了元素操作部分的 API 。</p>
<p>关于 ng 的几点：</p>
<p>1.对 IE 方面，它兼容 IE8 及以上的版本。<br>2.与 jQuery 集成工作，它的一些对象与 jQuery 相关对象表现是一致的。<br>3.使用 ng 时不要冒然去改变相关 DOM 的结构。</p>
<h3 id="一个例子"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">   &lt;html&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">   &lt;meta charset="utf-8" /&gt;</span><br><span class="line"></span><br><span class="line">   &lt;title&gt;试验&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">   &lt;script type="text/javascript" src="jquery-1.8.3.js"&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script type="text/javascript" src="angular.js"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">   &lt;/head&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">    &lt;div ng-controller="BoxCtrl"&gt;</span><br><span class="line">       &lt;div style="width: 100px; height: 100px; background-color: red;"</span><br><span class="line">            ng-click="click()"&gt;&lt;/div&gt;</span><br><span class="line">       &lt;p&gt;{{ w } } x {{ h } }&lt;/p&gt;</span><br><span class="line">       &lt;p&gt;W: &lt;input type="text" ng-model="w" /&gt;&lt;/p&gt;</span><br><span class="line">       &lt;p&gt;H: &lt;input type="text" ng-model="h" /&gt;&lt;/p&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   var BoxCtrl = function($scope, $element){</span><br><span class="line"></span><br><span class="line">     //$element 就是一个 jQuery 对象</span><br><span class="line">     var e = $element.children().eq(0);</span><br><span class="line">     $scope.w = e.width();</span><br><span class="line">     $scope.h = e.height();</span><br><span class="line"></span><br><span class="line">     $scope.click = function(){</span><br><span class="line">       $scope.w = parseInt($scope.w) + 10;</span><br><span class="line">       $scope.h = parseInt($scope.h) + 10;</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     $scope.$watch('w',</span><br><span class="line">       function(to, from){</span><br><span class="line">         e.width(to);</span><br><span class="line">       }</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     $scope.$watch('h',</span><br><span class="line">       function(to, from){</span><br><span class="line">         e.height(to);</span><br><span class="line">       }</span><br><span class="line">     );</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">   angular.bootstrap(document.documentElement);</span><br><span class="line">   &lt;/script&gt;</span><br><span class="line">   &lt;/body&gt;</span><br><span class="line">   &lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>你可以看到一个可被控制大小的红色方块。其中：<br>angular.bootstrap(document.documentElement);是Angular开始作用的入口，开始驱动整个页面。还有另外一种定义Angular入口的方式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body ng-app&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>一个angular应用是跑起来的“入口”，有两方式：</p>
<p>（1）在元素上添加ng-app指令（暂时无需关心什么意思）；ng-app可以有属性值（ng-app=”app”），这样的话就需要咱们去写一个名为app的module了，后续详解。</p>
<p>（2）不去指定ng-app，通过JS代码执行：angular.bootstrap(element, [‘模块名’…])，一样也是可以启动的<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">   &lt;html ng-app="MyApp"&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">   &lt;meta charset="utf-8" /&gt;</span><br><span class="line"></span><br><span class="line">   &lt;title&gt;数据正向绑定&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">   &lt;script type="text/javascript" src="jquery-1.8.3.js"&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script type="text/javascript" src="angular.js"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;input type="text" value="" id="a" /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line">  var TestCtrl = function(){</span><br><span class="line">    console.log('ok');</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  //angular.bootstrap(document.documentElement);</span><br><span class="line">  angular.module('MyApp', [], function(){console.log('here')});</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里说的一个 App 就是 ng 概念中的一个 Module 。上面的例子中使用的全局函数作为控制器函数。对于 Controller 来说， 如果不想使用全局函数，也可以在 app 中定义：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('MyApp', [], function(){console.log('here')});</span><br><span class="line">  app.controller('TestCtrl',</span><br><span class="line">    function($scope){</span><br><span class="line">      console.log('ok');</span><br><span class="line">    }</span><br><span class="line">  );</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面我们使用 ng-app 来指明要使用的 App ，这样的话可以把显式的初始化工作省了。一般完整的过程是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>使用 angular.bootstrap 来显示地做初始化工具，参数指明了根节点，装载的模块（可以是多个模块）。</p>
<h3 id="依赖注入"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>injector ，学过java的同学对这个都不陌生。用过spring框架，都知道这个神奇的依赖注入。通过简单的xml文件配置，轻松实现数据层与后台业务逻辑层的分离，实现软件的松耦合。Angular中也是这个逻辑，比如上面的例子：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var BoxCtrl = function($scope, $element){}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>在这个函数定义中，注意那两个参数： \$scope ， \$element ，这是两个很有意思的东西。总的来说，它们是参数，这没什么可说的。但又不仅仅是参数——你换个名字代码就不能正常运行了。</p>
<p>事实上，这两个参数，除了完成“参数”的本身任务之外，还作为一种语法糖完成了“依赖声明”的任务。本来这个函数定义，完整的写法应该写成：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var BoxCtrl = ['$scope', '$element', function(s, e){}];</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这样就很明显，表示有一个函数，它依赖于两个东西，然后这两个东西会依次作为参数传入。</p>
<p>简单起见，就写成了一个函数定义原本的样子，然后在定义参数的名字上作文章，来起到依赖声明的作用。</p>
<p>在处理时，通过函数对象的 toString() 方法可以知道这个函数定义代码的字符串表现形式，然后就知道它的参数是 \$scope 和 \$element 。通过名字判断出这是两个外部依赖，然后就去获取资源，最后把资源作为参数，调用定义的函数。</p>
<p>所以，参数的名字是不能随便写的，这里也充分利用了 js 的特点来尽量做到“反省”了。</p>
<p>在 Python 中受限于函数名的命名规则，写出来不太好看。不过也得利于反省机制，做到这点也很容易：</p>
<h3 id="作用域"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>这里提到的“作用域”的概念，是一个在范围上与 DOM 结构一致，数据上相对于某个 $scope 对象的属性的概念。我们还是从 HTML 代码上来入手：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="BoxCtrl"&gt;</span><br><span class="line">    &lt;div style="width: 100px; height: 100px; background-color: red;"</span><br><span class="line">         ng-click="click()"&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;p&gt;{{ w } } x {{ h } }&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;W: &lt;input type="text" ng-model="w" /&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;H: &lt;input type="text" ng-model="h" /&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面的代码中，我们给一个 div 元素指定了一个 BoxCtrl ，那么， div 元素之内，就是 BoxCtrl 这个函数运行时， \$scope 这个注入资源的控制范围。在代码中我们看到的 click() ， w ， h 这些东西，它们本来的位置对应于 \$scope.click ， \$scope.w ， \$scope.h 。</p>
<p>我们在后面的 js 代码中，也可以看到我们就是在操作这些变量。依赖于 ng 的数据绑定机制，操作变量的结果直接在页面上表现出来了。</p>
<h3 id="数据绑定与模板"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#数据绑定与模板" class="headerlink" title="数据绑定与模板"></a>数据绑定与模板</h3><h4 id="数据到模板"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#数据到模板" class="headerlink" title="数据到模板"></a>数据到模板</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;{{ w } } x {{ h } }&lt;/p&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>其中，使用双花括号这个标记，就可以直接引用，并绑定一个作用域内的变量。在实现上，ng 自动创建了一个 watcher 。效果就是，不管因为什么，如果作用域的变量发生了改变，我们随时可以让相应的页面表现也随之改变。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id="test" ng-controller="TestCtrl"&gt;{{ a } }&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.a = '123';</span><br><span class="line">  }</span><br><span class="line">  angular.bootstrap(document.documentElement);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面的例子在页面载入之后，我们可以在页面上看到 123 。这时，我们可以打开一个终端控制器，输入</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$('#test').scope().a = '12345';</span><br><span class="line">$('#test').scope().$digest();</span><br></pre></td></tr></tbody></table></figure>
<p>上面的代码执行之后，就可以看到页面变化了。<br>对于使用 ng 进行的事件绑定，在处理函数中就不需要去关心 \$digest() 的调用了。因为 ng 会自己处理。源码中，对于 ng 的事件绑定，真正的处理函数不是指定名字的函数，而是经过 \$apply() 包装过的一个函数。这个 \$apply() 做的一件事，就是调用根作用域 \$rootScope 的 \$digest() ，这样整个世界就清净了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id="test" ng-controller="TestCtrl" ng-click="click()"&gt;{{ a } }&lt;/p&gt;</span><br><span class="line">  &lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.a = '123';</span><br><span class="line"></span><br><span class="line">    $scope.click = function(){</span><br><span class="line">      $scope.a = '456';</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  angular.bootstrap(document.documentElement);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>那个 click 函数的定义，绑定时变成了类似于：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function(){</span><br><span class="line">    $scope.$apply(</span><br><span class="line">      function(){</span><br><span class="line">        $scope.click();</span><br><span class="line">      }</span><br><span class="line">    )</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里的 \$scope.\$apply() 中做的一件事：\$rootScope.\$digest();</p>
<h4 id="模板到数据"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板到数据" class="headerlink" title="模板到数据"></a>模板到数据</h4><p>模板到数据的绑定，主要是通过 ng-model 来完成的：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type="text" id="test" ng-controller="TestCtrl" ng-model="a" /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.a = '123';</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这时修改 input 中的值，然后再在控制终端中使用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$('#test').scope().a</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>查看，发现变量 a 的值已经更改了。<br>实际上， ng-model 是把两个方向的绑定都做了。它不光显示出变量的值，也把显示上的数值变化反映给了变量。这个在实现上就简单多了，只是绑定 change 事件，然后做一些赋值操作即可。不过 ng 里，还要区分对待不同的控件。</p>
<h3 id="模版数据模板综合"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模版数据模板综合" class="headerlink" title="模版数据模板综合"></a>模版数据模板综合</h3><p>现在要考虑的是一种在现实中很普遍的一个需求。比如就是我们可以输入数值，来控制一个矩形的长度。在这里，数据与表现的关系是：</p>
<p>1.长度数值保存在变量中<br>2.变量显示于某个 input 中<br>3.变量的值即是矩形的长度<br>4.input 中的值变化时，变量也要变化<br>5.input 中的值变化时，矩形的长度也要变化</p>
<p>当然，要实现目的在这里可能就不止一种方案了。按照以前的做法，很自然地会想法，绑定 input 的 change 事件，然后去做一些事就好了。但是，我们前面提到过 ng-model 这个东西，利用它就可以在不手工处理 change 的条件下完成数据的展现需求，在此基础之上，我们还需要做的一点，就是把变化后的数据应用到矩形的长度之上。</p>
<p>最开始，我们面对的应该是这样一个东西：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div style="width: 100px; height: 10px; background-color: red"&gt;&lt;/div&gt;</span><br><span class="line">  &lt;input type="text" name="width" ng-model="width" /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.width = 100;</span><br><span class="line">}</span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>我们从响应数据变化，但又不使用 change 事件的角度来看，可以这样处理宽度变化：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($scope, $element){</span><br><span class="line">  $scope.width = 100;</span><br><span class="line">  $scope.$watch('width',</span><br><span class="line">    function(to, from){</span><br><span class="line">      $element.children(':first').width(to);</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>使用 $watch() 来绑定数据变化。</p>
<p>当然，这种样式的问题，有更直接有效的手段， ng 的数据绑定总是让人惊异：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div style="width: 10px; height: 10px; background-color: red" ng-style="style"&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;input type="text" name="width" ng-model="style.width" /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.style = {width: 100 + 'px'};</span><br><span class="line">}</span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="模板"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板" class="headerlink" title="模板"></a>模板</h3><p>前面讲了数据绑定之后，现在可以单独讲讲模板了。</p>
<p>作为一套能称之谓“模板”的系统，除了能干一些模板的常规的事之外（好吧，即使是常规的逻辑判断现在它也做不了的），配合作用域 \$scope 和 ng 的数据双向绑定机制， ng 的模板系统就变得比较神奇了。<br>定义模板的内容现在有三种方式：</p>
<ol>
<li>在需要的地方直接写字符串</li>
<li>外部文件</li>
<li>使用 script 标签定义的“内部文件”<br>第一种不需要多说。第二种和第三种都可以和 ng-include 一起工作，来引入一段模板。</li>
</ol>
<p>直接引入同域的外部文件作为模板的一部分：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-include src="'tpl.html'"&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"> &lt;div ng-include="'tpl.html'"&gt;</span><br><span class="line"> &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>注意， src 中的字符串会作为表达式处理（可以是 $scope 中的变量），所以，直接写名字的话需要使用引号。</p>
<p>引入 script 定义的“内部文件”：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type="text/ng-template" id="tpl"&gt;</span><br><span class="line"> here, {{ 1 + 1 } }</span><br><span class="line"> &lt;/script&gt;</span><br><span class="line"></span><br><span class="line"> &lt;div ng-include src="'tpl'"&gt;&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>配合变量使用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type="text/ng-template" id="tpl"&gt;</span><br><span class="line"> here, {{ 1 + 1 } }</span><br><span class="line"> &lt;/script&gt;</span><br><span class="line"></span><br><span class="line"> &lt;a ng-click="v='tpl'"&gt;Load&lt;/a&gt;</span><br><span class="line"> &lt;div ng-include src="v"&gt;&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>###内容渲染控制</p>
<h4 id="ng-repeat"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#ng-repeat" class="headerlink" title="ng-repeat"></a>ng-repeat</h4><p>这算是唯一的一个控制标签么……，它的使用方法：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;ul ng-repeat="member in obj_list"&gt;</span><br><span class="line">      &lt;li&gt;{{ member } }&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.obj_list = [1,2,3,4];</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>除此之外，它还提供了几个变量可供使用：</p>
<ol>
<li>\$index 当前索引</li>
<li>\$first 是否为头元素</li>
<li>\$middle 是否为非头非尾元素</li>
<li>\$last 是否为尾元素<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;ul ng-repeat="member in obj_list"&gt;</span><br><span class="line">      &lt;li&gt;{{ $index } }, {{ member.name } }&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.obj_list = [{name: 'A'}, {name: 'B'}, {name: 'C'}];</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<h4 id="赋值-ng-init"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#赋值-ng-init" class="headerlink" title="赋值 ng-init"></a>赋值 ng-init</h4><p>这个指令可以在模板中直接赋值，它作用于 angular.bootstrap 之前，并且，定义的变量与 \$scope 作用域无关。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl" ng-init="a=[1,2,3,4];"&gt;</span><br><span class="line">    &lt;ul ng-repeat="member in a"&gt;</span><br><span class="line">      &lt;li&gt;{{ member } }&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="节点控制"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#节点控制" class="headerlink" title="节点控制"></a>节点控制</h3><p>####样式 ng-style<br>可以使用一个结构直接表示当前节点的样式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-style="{width: 100 + 'px', height: 100 + 'px', backgroundColor: 'red'}"&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>同样地，绑定一个变量的话，威力大了</p>
<h4 id="类-ng-class"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#类-ng-class" class="headerlink" title="类 ng-class"></a>类 ng-class</h4><p>就是直接地设置当前节点的类，同样，配合数据绑定作用就大了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl" ng-class="cls"&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>ng-class-even 和 ng-class-odd 是和 ng-repeat 配合使用的：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul ng-init="l=[1,2,3,4]"&gt;</span><br><span class="line">    &lt;li ng-class-odd="'odd'" ng-class-even="'even'" ng-repeat="m in l"&gt;{{ m } }&lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>注意里面给的还是表示式，别少了引号。</p>
<h4 id="显示和隐藏-ng-show-ng-hide-ng-switch"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#显示和隐藏-ng-show-ng-hide-ng-switch" class="headerlink" title="显示和隐藏 ng-show ng-hide ng-switch"></a>显示和隐藏 ng-show ng-hide ng-switch</h4><p>前两个是控制 display 的指令：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-show="true"&gt;1&lt;/div&gt;</span><br><span class="line">&lt;div ng-show="false"&gt;2&lt;/div&gt;</span><br><span class="line">&lt;div ng-hide="true"&gt;3&lt;/div&gt;</span><br><span class="line">&lt;div ng-hide="false"&gt;4&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>后一个 ng-switch 是根据一个值来决定哪个节点显示，其它节点移除：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-init="a=2"&gt;</span><br><span class="line">    &lt;ul ng-switch on="a"&gt;</span><br><span class="line">      &lt;li ng-switch-when="1"&gt;1&lt;/li&gt;</span><br><span class="line">      &lt;li ng-switch-when="2"&gt;2&lt;/li&gt;</span><br><span class="line">      &lt;li ng-switch-default&gt;other&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>####其它属性控制<br>ng-src 控制 src 属性：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img ng-src="{{ 'h' + 'ead.png' } }" /&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>ng-href 控制 href 属性：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a ng-href="{{ '#' + '123' } }"&gt;here&lt;/a&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>总的来说：</p>
<ol>
<li>ng-src src属性</li>
<li>ng-href href属性</li>
<li>ng-checked 选中状态</li>
<li>ng-selected 被选择状态</li>
<li>ng-disabled 禁用状态</li>
<li>ng-multiple 多选状态</li>
<li>ng-readonly 只读状态<br>注意： 上面的这些只是单向绑定，即只是从数据到展示，不能反作用于数据。要双向绑定，还是要使用 ng-model</li>
</ol>
<h3 id="事件绑定"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><p>事件绑定是模板指令中很好用的一部分。我们可以把相关事件的处理函数直接写在 DOM 中，这样做的最大好处就是可以从 DOM 结构上看出业务处理的形式，你知道当你点击这个节点时哪个函数被执行了。</p>
<p>ng-change<br>ng-click<br>ng-blur<br>ng-dblclick<br>ng-mousedown<br>ng-mouseenter<br>ng-mouseleave<br>ng-mousemove<br>ng-mouseover<br>ng-mouseup<br>ng-submit<br>对于事件对象本身，在函数调用时可以直接使用 $event 进行传递：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p ng-click="click($event)"&gt;点击&lt;/p&gt;</span><br><span class="line"> &lt;p ng-click="click($event.target)"&gt;点击&lt;/p&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="表单控件"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#表单控件" class="headerlink" title="表单控件"></a>表单控件</h3><p>表单控件类的模板指令，最大的作用是它预定义了需要绑定的数据的格式。这样，就可以对于既定的数据进行既定的处理。</p>
<h4 id="form"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#form" class="headerlink" title="form"></a>form</h4><p>form 是核心的一个控件。 ng 对 form 这个标签作了包装。事实上， ng 自己的指令是叫 ng-form 的，区别在于， form 标签不能嵌套，而使用 ng-form 指令就可以做嵌套的表单了。</p>
<p>form 的行为中依赖它里面的各个输入控制的状态的，在这里，我们主要关心的是 form 自己的一些方法和属性。从 ng 的角度来说， form 标签，是一个模板指令，也创建了一个 FormController 的实例。这个实例就提供了相应的属性和方法。同时，它里面的控件也是一个 NgModelController 实例。</p>
<p>很重要的一点， form 的相关方法要生效，必须为 form 标签指定 name 和 ng-controller ，并且每个控件都要绑定一个变量。 form 和控件的名字，即是 $scope 中的相关实例的引用变量名。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;input type="text" name="a" required ng-model="a"  /&gt;</span><br><span class="line">    &lt;span ng-click="see()"&gt;{{ test_form.$valid } }&lt;/span&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line"></span><br><span class="line">    $scope.see = function(){</span><br><span class="line">      console.log($scope.test_form);</span><br><span class="line">      console.log($scope.test_form.a);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>除去对象的方法与属性， form 这个标签本身有一些动态类可以使用：<br><em>ng-valid</em> 当表单验证通过时的设置<br><em>ng-invalid</em> 当表单验证失败时的设置<br><em>ng-pristine</em> 表单的未被动之前拥有<br><em>ng-dirty</em> 表单被动过之后拥有<br>form 对象的属性有：<br>1.\$pristine 表单是否未被动过</p>
<ol>
<li>\$dirty 表单是否被动过</li>
<li>\$valid 表单是否验证通过<br>4.\$invalid 表单是否验证失败<br>5.\$error 表单的验证错误<br>其中的 $error 对象包含有所有字段的验证信息，及对相关字段的 NgModelController 实例的引用。它的结构是一个对象， key 是失败信息， required ， minlength 之类的， value 是对应的字段实例列表。</li>
</ol>
<p>注意，这里的失败信息是按序列取的一个。比如，如果一个字段既要求 required ，也要求 minlength ，那么当它为空时， $error 中只有 required 的失败信息。只输入一个字符之后， required 条件满足了，才可能有 minlength 这个失败信息。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;input type="text" name="a" required ng-model="a"  /&gt;</span><br><span class="line">  &lt;input type="text" name="b" required ng-model="b" ng-minlength="2" /&gt;</span><br><span class="line">  &lt;span ng-click="see()"&gt;{{ test_form.$error } }&lt;/span&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.see = function(){</span><br><span class="line">    console.log($scope.test_form.$error);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="input"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#input" class="headerlink" title="input"></a>input</h4><p>input 是数据的最主要入口。 ng 支持 HTML5 中的相关属性，同时对旧浏览器也做了兼容性处理。最重要的， input 的规则定义，是所属表单的相关行为的参照（比如表单是否验证成功）。</p>
<p>input 控件的相关可用属性为：</p>
<p>1.name 名字<br>2.ng-model 绑定的数据<br>3.required 是否必填<br>4.ng-required 是否必填<br>5.ng-minlength 最小长度<br>6.ng-maxlength 最大长度<br>7.ng-pattern 匹配模式<br>8.ng-change 值变化时的回调<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"&gt;</span><br><span class="line">   &lt;input type="text" name="a" ng-model="a" required ng-pattern="/abc/" /&gt;</span><br><span class="line">   &lt;span ng-click="see()"&gt;{{ test_form.$error } }&lt;/span&gt;</span><br><span class="line"> &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>input 控件，它还有一些扩展，这些扩展有些有自己的属性：</p>
<ol>
<li>input type=”number” 多了 number 错误类型，多了 max ， min 属性。</li>
<li>input type=”url” 多了 url 错误类型。</li>
<li>input type=”email” 多了 email 错误类型。<h4 id="checkbox"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#checkbox" class="headerlink" title="checkbox"></a>checkbox</h4>它也算是 input 的扩展，不过，它没有验证相关的东西，只有选中与不选中两个值：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;input type="checkbox" name="a" ng-model="a" ng-true-value="AA" ng-false-value="BB" /&gt;</span><br><span class="line">    &lt;span&gt;{{ a } }&lt;/span&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.a = 'AA';</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>两点：</p>
<p>1.controller 要初始化变量值。<br>2.controller 中的初始化值会关系到控件状态（双向绑定）。</p>
<h4 id="radio-textarea"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#radio-textarea" class="headerlink" title="radio,textarea"></a>radio,textarea</h4><p>也是 input 的扩展。和 checkbox 一样，但radio只有一个值了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;input type="radio" name="a" ng-model="a" value="AA" /&gt;</span><br><span class="line">    &lt;input type="radio" name="a" ng-model="a" value="BB" /&gt;</span><br><span class="line">    &lt;span&gt;{{ a } }&lt;/span&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>textarea同input</p>
<h4 id="select"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#select" class="headerlink" title="select"></a>select</h4><p>这是一个比较牛B的控件。它里面的一个叫做 ng-options 的属性用于数据呈现。</p>
<p>对于给定列表时的使用。</p>
<p>最简单的使用方法， x for x in list ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl" ng-init="o=[0,1,2,3]; a=o[1];"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="x for x in o" ng-change="show()"&gt;</span><br><span class="line">      &lt;option value=""&gt;可以加这个空值&lt;/option&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.show = function(){</span><br><span class="line">      console.log($scope.a);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  angular.bootstrap(document.documentElement);</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>在 $scope 中， select 绑定的变量，其值和普通的 value 无关，可以是一个对象：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">       ng-init="o=[{name: 'AA'}, {name: 'BB'}]; a=o[1];"&gt;</span><br><span class="line">   &lt;select ng-model="a" ng-options="x.name for x in o" ng-change="show()"&gt;</span><br><span class="line">   &lt;/select&gt;</span><br><span class="line"> &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>显示与值分别指定， x.v as x.name for x in o ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">        ng-init="o=[{name: 'AA', v: '00'}, {name: 'BB', v: '11'}]; a=o[1].v;"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="x.v as x.name for x in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>加入分组的， x.name group by x.g for x in o ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">        ng-init="o=[{name: 'AA', g: '00'}, {name: 'BB', g: '11'}, {name: 'CC', g: '00'}]; a=o[1];"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="x.name group by x.g for x in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>分组了还分别指定显示与值的， x.v as x.name group by x.g for x in o ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl" ng-init="o=[{name: 'AA', g: '00', v: '='}, {name: 'BB', g: '11', v: '+'}, {name: 'CC', g: '00', v: '!'}]; a=o[1].v;"&gt;</span><br><span class="line">   &lt;select ng-model="a" ng-options="x.v as x.name group by x.g for x in o" ng-change="show()"&gt;</span><br><span class="line">   &lt;/select&gt;</span><br><span class="line"> &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果参数是对象的话，基本也是一样的，只是把遍历的对象改成 (key, value) ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;form name="test_form" ng-controller="TestCtrl" ng-init="o={a: 0, b: 1}; a=o.a;"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="k for (k, v) in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">        ng-init="o={a: {name: 'AA', v: '00'}, b: {name: 'BB', v: '11'} }; a=o.a.v;"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="v.v as v.name for (k, v) in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">        ng-init="o={a: {name: 'AA', v: '00', g: '=='}, b: {name: 'BB', v: '11', g: '=='} }; a=o.a;"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="v.name group by v.g for (k, v) in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form name="test_form" ng-controller="TestCtrl"</span><br><span class="line">        ng-init="o={a: {name: 'AA', v: '00', g: '=='}, b: {name: 'BB', v: '11', g: '=='} }; a=o.a.v;"&gt;</span><br><span class="line">    &lt;select ng-model="a" ng-options="v.v as v.name group by v.g for (k, v) in o" ng-change="show()"&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="模板中的过滤器"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板中的过滤器" class="headerlink" title="模板中的过滤器"></a>模板中的过滤器</h3><p>这里说的过滤器，是用于对数据的格式化，或者筛选的函数。它们可以直接在模板中通过一种语法使用。对于常用功能来说，是很方便的一种机制。</p>
<p>多个过滤器之间可以直接连续使用。</p>
<h4 id="排序orderBy"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#排序orderBy" class="headerlink" title="排序orderBy"></a>排序orderBy</h4><p>orderBy是一个排序用的过滤器标签。它可以像 sort 函数那样支持一个排序函数，也可以简单地指定一个属性名进行操作：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  {{ data \| orderBy: 'age' } } &lt;br /&gt;</span><br><span class="line">  {{ data \| orderBy: '-age' } } &lt;br /&gt;</span><br><span class="line">  {{ data \| orderBy: '-age' \| limitTo: 2 } } &lt;br /&gt;</span><br><span class="line">  {{ data \| orderBy: ['-age', 'name'] } } &lt;br /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.data = [</span><br><span class="line">    {name: 'B', age: 4},</span><br><span class="line">    {name: 'A', age: 1},</span><br><span class="line">    {name: 'D', age: 3},</span><br><span class="line">    {name: 'C', age: 3},</span><br><span class="line">  ];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="过滤列表-filter"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#过滤列表-filter" class="headerlink" title="过滤列表 filter"></a>过滤列表 filter</h4><p>filter 是一个过滤内容的标签。</p>
<p>如果参数是一个字符串，则列表成员中的任意属性值中有这个字符串，即为满足条件（忽略大小写）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  {{ data \| filter: 'b' } } &lt;br /&gt;</span><br><span class="line">  {{ data \| filter: '!B' } } &lt;br /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.data = [</span><br><span class="line">    {name: 'B', age: 4},</span><br><span class="line">    {name: 'A', age: 1},</span><br><span class="line">    {name: 'D', age: 3},</span><br><span class="line">    {name: 'C', age: 3},</span><br><span class="line">  ];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以使用对象，来指定属性名， $ 表示任意属性：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{{ data \| filter: {name: 'A'} } }</span><br><span class="line">{{ data \| filter: {$: '3'} } }</span><br><span class="line">{{ data \| filter: {$: '!3'} } }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>自定义的过滤函数也支持：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  {{ data \| filter: f } }</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.data = [</span><br><span class="line">    {name: 'B', age: 4},</span><br><span class="line">    {name: 'A', age: 1},</span><br><span class="line">    {name: 'D', age: 3},</span><br><span class="line">    {name: 'C', age: 3},</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  $scope.f = function(e){</span><br><span class="line">    return e.age &gt; 2;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="其它"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#其它" class="headerlink" title="其它"></a>其它</h4><p>时间戳格式化 date ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">{{ a \| date: 'yyyy-MM-dd HH:mm:ss' } }</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line">var TestCtrl = function($scope){</span><br><span class="line">  $scope.a = ((new Date().valueOf()));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document.documentElement);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>列表截取 limitTo ，支持正负数：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">{{ [1,2,3,4,5] \| limitTo: 2 } }</span><br><span class="line">{{ [1,2,3,4,5] \| limitTo: -3 } }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>大小写 lowercase ， uppercase ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">{{ 'abc' \| uppercase } }</span><br><span class="line">{{ 'Abc' \| lowercase } }</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="例子：表头排序"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#例子：表头排序" class="headerlink" title="例子：表头排序"></a>例子：表头排序</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">     &lt;table&gt;</span><br><span class="line">       &lt;tr&gt;</span><br><span class="line">         &lt;th ng-click="f='name'; rev=!rev"&gt;名字&lt;/th&gt;</span><br><span class="line">         &lt;th ng-click="f='age'; rev=!rev"&gt;年龄&lt;/th&gt;</span><br><span class="line">       &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">       &lt;tr ng-repeat="o in data \| orderBy: f : rev"&gt;</span><br><span class="line">         &lt;td&gt;{{ o.name } }&lt;/td&gt;</span><br><span class="line">         &lt;td&gt;{{ o.age } }&lt;/td&gt;</span><br><span class="line">       &lt;/tr&gt;</span><br><span class="line">     &lt;/table&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">   &lt;script type="text/javascript"&gt;</span><br><span class="line">   var TestCtrl = function($scope){</span><br><span class="line">     $scope.data = [</span><br><span class="line">       {name: 'B', age: 4},</span><br><span class="line">       {name: 'A', age: 1},</span><br><span class="line">       {name: 'D', age: 3},</span><br><span class="line">       {name: 'C', age: 3},</span><br><span class="line">     ];</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   angular.bootstrap(document.documentElement);</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="例子：搜索"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#例子：搜索" class="headerlink" title="例子：搜索"></a>例子：搜索</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl" ng-init="s=data[0].name; q=''"&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;span&gt;查找：&lt;/span&gt; &lt;input type="text" ng-model="q" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;select ng-multiple="true" ng-model="s"</span><br><span class="line">            ng-options="o.name as o.name + '(' + o.age + ')' for o in data \| filter: {name: q} \| orderBy: ['age', 'name'] "&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line">  var TestCtrl = function($scope){</span><br><span class="line">    $scope.data = [</span><br><span class="line">      {name: 'B', age: 4},</span><br><span class="line">      {name: 'A', age: 1},</span><br><span class="line">      {name: 'D', age: 3},</span><br><span class="line">      {name: 'C', age: 3},</span><br><span class="line">    ];</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  angular.bootstrap(document.documentElement);</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="锚点路由"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#锚点路由" class="headerlink" title="锚点路由"></a>锚点路由</h3><p>准确地说，这应该叫对 hashchange 事件的处理吧。</p>
<p>就是指 URL 中的锚点部分发生变化时，触发预先定义的业务逻辑。比如现在是 /test#/x ，锚点部分的值为 # 后的 /x ，它就对应了一组处理逻辑。当这部分变化时，比如变成了 /test#/t ，这时页面是不会刷新的，但是它可以触发另外一组处理逻辑，来做一些事，也可以让页面发生变化。</p>
<p>这种机制对于复杂的单页面来说，无疑是一种强大的业务切分手段。就算不是复杂的单页面应用，在普通页面上善用这种机制，也可以让业务逻辑更容易控制。</p>
<p>ng 提供了完善的锚点路由功能，虽然目前我觉得相当重要的一个功能还有待完善（后面会说），但目前这功能的几部分内容，已经让我思考了很多种可能性了。</p>
<p>ng 中的锚点路由功能是由几部分 API 共同完成的一整套方案。这其中包括了路由定义，参数定义，业务处理等。</p>
<h4 id="路由定义"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#路由定义" class="headerlink" title="路由定义"></a>路由定义</h4><p>要使用锚点路由功能，需要在先定义它。目前，对于定义的方法，我个人只发现在“初始化”阶段可以通过 $routeProvider 这个服务来定义。</p>
<p>在定义一个 app 时可以定义锚点路由：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;html ng-app="ngView"&gt;</span><br><span class="line">    ... ...</span><br><span class="line"></span><br><span class="line">  &lt;div ng-view&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">  angular.module('ngView', [],</span><br><span class="line">    function($routeProvider){</span><br><span class="line">      $routeProvider.when('/test',</span><br><span class="line">        {</span><br><span class="line">          template: 'test',</span><br><span class="line">        }</span><br><span class="line">      );</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>首先看 ng-view 这个 directive ，它是一个标记“锚点作用区”的指令。目前页面上只能有一个“锚点作用区”。有人已经提了，“多个可命名”的锚点作用区的代码到官方，但是目前官方还没有接受合并，我觉得多个作用区这个功能是很重要的，希望下个发布版中能有。</p>
<p>锚点作用区的功能，就是让锚点路由定义时的那些模板， controller 等，它们产生的 HTML 代码放在作用区内。</p>
<p>比如上面的代码，当你刚打开页面时，页面是空白的。你手动访问 /#/test 就可以看到页面上出现了 ‘test’ 的字样。</p>
<p>在 angular.bootstrap() 时也可以定义：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">angular.bootstrap(document.documentElement, [</span><br><span class="line">   function($routeProvider){</span><br><span class="line">     $routeProvider.when('/test',</span><br><span class="line">       {</span><br><span class="line">         template: 'test'</span><br><span class="line">       }</span><br><span class="line">     );</span><br><span class="line">   }</span><br><span class="line"> ]);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="参数定义"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#参数定义" class="headerlink" title="参数定义"></a>参数定义</h4><p>在作路由定义时，可以匹配一个规则，规则中可以定义路径中的某些部分作为参数之用，然后使用 $routeParams 服务获取到指定参数。比如 /#/book/test 中， test 作为参数传入到 controller 中：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-view&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">angular.module('ngView', [],</span><br><span class="line">  function($routeProvider){</span><br><span class="line">    $routeProvider.when('/book/:title',</span><br><span class="line">      {</span><br><span class="line">        template: '{{ title } }',</span><br><span class="line">        controller: function($scope, $routeParams){</span><br><span class="line">          $scope.title = $routeParams.title;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>访问： /#/book/test</p>
<p>不需要预定义模式，也可以像普通 GET 请求那样获取到相关参数：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">angular.module('ngView', [],</span><br><span class="line">  function($routeProvider){</span><br><span class="line">    $routeProvider.when('/book',</span><br><span class="line">      {</span><br><span class="line">        template: '{{ title } }',</span><br><span class="line">        controller: function($scope, $routeParams){</span><br><span class="line">          $scope.title = $routeParams.title;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>访问： /#/book?title=test</p>
<h4 id="业务处理"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#业务处理" class="headerlink" title="业务处理"></a>业务处理</h4><p>简单来说，当一个锚点路由定义被匹配时，会根据模板生成一个 \$scope ，同时相应的一个 controller 就会被触发。最后模板的结果会被填充到 ng-view 中去。</p>
<p>从上面的例子中可以看到，最直接的方式，我们可以在模板中双向绑定数据，而数据的来源，在 controller 中控制。在 controller 中，又可以使用到像 \$scope ， \$routeParams 这些服务。</p>
<p>这里先提一下另外一种与锚点路由相关的服务， \$route 。这个服务里锚点路由在定义时，及匹配过程中的信息。比如我们搞怪一下：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">angular.module('ngView', [],</span><br><span class="line">  function($routeProvider){</span><br><span class="line">    $routeProvider.when('/a',</span><br><span class="line">      {</span><br><span class="line">        template: '{{ title } }',</span><br><span class="line">        controller: function($scope){</span><br><span class="line">          $scope.title = 'a';</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    $routeProvider.when('/b',</span><br><span class="line">      {</span><br><span class="line">        template: '{{ title } }',</span><br><span class="line">        controller: function($scope, $route){</span><br><span class="line">          console.log($route);</span><br><span class="line">          $route.routes['/a'].controller($scope);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>回到锚点定义的业务处理中来。我们可以以字符串形式写模板，也可以直接引用外部文件作为模板：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">angular.module('ngView', [],</span><br><span class="line">  function($routeProvider){</span><br><span class="line">    $routeProvider.when('/test',</span><br><span class="line">      {</span><br><span class="line">        templateUrl: 'tpl.html',</span><br><span class="line">        controller: function($scope){</span><br><span class="line">          $scope.title = 'a';</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>tpl.html 中的内容是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{{ title } }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这样的话，模板可以预定义，也可以很复杂了。</p>
<p>现在暂时忘了模板吧，因为前面提到的，当前 ng-view 不能有多个的限制，模板的渲染机制局限性还是很大的。不过，反正会触发一个 controller ，那么在函数当中我们可以尽量地干自己喜欢的事：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">angular.module('ngView', [],</span><br><span class="line">  function($routeProvider){</span><br><span class="line">    $routeProvider.when('/test',</span><br><span class="line">      {</span><br><span class="line">        template: '{{}}',</span><br><span class="line">        controller: function(){</span><br><span class="line">          $('div').first().html('&lt;b&gt;OK&lt;/b&gt;');</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>那个空的 template 不能省，否则 controller 不会被触发。</p>
<h3 id="定义模板变量标识标签"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#定义模板变量标识标签" class="headerlink" title="定义模板变量标识标签"></a>定义模板变量标识标签</h3><p>由于下面涉及动态内容，所以我打算起一个后端服务来做。但是我发现我使用的 Tornado 框架的模板系统，与 ng 的模板系统，都是使用 双花括号 这对符号来定义模板表达式的，这太悲剧了，不过幸好 ng 已经提供了修改方法：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.bootstrap(document.documentElement,</span><br><span class="line">  [function($interpolateProvider){</span><br><span class="line">    $interpolateProvider.startSymbol('[[');</span><br><span class="line">    $interpolateProvider.endSymbol(']]');</span><br><span class="line">  }]);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>使用 $interpolateProvider 服务即可。</p>
<h3 id="AJAX"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><p>ng 提供了基本的 AJAX 封装，你直接面对 promise 对象，使用起来还是很方便的。</p>
<h4 id="HTTP请求"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h4><p>基本的操作由 $http 服务提供。它的使用很简单，提供一些描述请求的参数，请求就出去了，然后返回一个扩充了 success 方法和 error 方法的 promise 对象（下节介绍），你可以在这个对象中添加需要的回调函数。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($scope, $http){</span><br><span class="line">  var p = $http({</span><br><span class="line">    method: 'GET',</span><br><span class="line">    url: '/json'</span><br><span class="line">  });</span><br><span class="line">  p.success(function(response, status, headers, config){</span><br><span class="line">      $scope.name = response.name;</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$http 接受的配置项有：</p>
<p>method 方法<br>url 路径<br>params GET请求的参数<br>data post请求的参数<br>headers 头<br>transformRequest 请求预处理函数<br>transformResponse 响应预处理函数<br>cache 缓存<br>timeout 超时毫秒，超时的请求会被取消<br>withCredentials 跨域安全策略的一个东西<br>其中的 transformRequest 和 transformResponse 及 headers 已经有定义的，如果自定义则会覆盖默认定义：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var $config = this.defaults = {</span><br><span class="line">     // transform incoming response data</span><br><span class="line">     transformResponse: [function(data) {</span><br><span class="line">       if (isString(data)) {</span><br><span class="line">         // strip json vulnerability protection prefix</span><br><span class="line">         data = data.replace(PROTECTION_PREFIX, '');</span><br><span class="line">         if (JSON_START.test(data) &amp;&amp; JSON_END.test(data))</span><br><span class="line">           data = fromJson(data, true);</span><br><span class="line">       }</span><br><span class="line">       return data;</span><br><span class="line">     }],</span><br><span class="line"></span><br><span class="line">     // transform outgoing request data</span><br><span class="line">     transformRequest: [function(d) {</span><br><span class="line">       return isObject(d) &amp;&amp; !isFile(d) ? toJson(d) : d;</span><br><span class="line">     }],</span><br><span class="line"></span><br><span class="line">     // default headers</span><br><span class="line">     headers: {</span><br><span class="line">       common: {</span><br><span class="line">         'Accept': 'application/json, text/plain, */*',</span><br><span class="line">         'X-Requested-With': 'XMLHttpRequest'</span><br><span class="line">       },</span><br><span class="line">       post: {'Content-Type': 'application/json;charset=utf-8'},</span><br><span class="line">       put:  {'Content-Type': 'application/json;charset=utf-8'}</span><br><span class="line">     }</span><br><span class="line">   };</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>注意它默认的 POST 方法出去的 Content-Type</p>
<p>对于几个标准的 HTTP 方法，有对应的 shortcut ：</p>
<ol>
<li>\$http.delete(url, config)</li>
<li>\$http.get(url, config)</li>
<li>\$http.head(url, config)</li>
<li>\$http.jsonp(url, config)</li>
<li>\$http.post(url, data, config)</li>
<li>\$http.put(url, data, config)<br>注意其中的 JSONP 方法，在实现上会在页面中添加一个 script 标签，然后放出一个 GET 请求。你自己定义的，匿名回调函数，会被 ng 自已给一个全局变量。在定义请求，作为 GET 参数，你可以使用 JSON_CALLBACK 这个字符串来暂时代替回调函数名，之后 ng 会为你替换成真正的函数名：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var p = $http({</span><br><span class="line">   method: 'JSONP',</span><br><span class="line">   url: '/json',</span><br><span class="line">   params: {callback: 'JSON_CALLBACK'}</span><br><span class="line"> });</span><br><span class="line"> p.success(function(response, status, headers, config){</span><br><span class="line">     console.log(response);</span><br><span class="line">     $scope.name = response.name;</span><br><span class="line"> });</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>$http 有两个属性：</p>
<p>defaults 请求的全局配置<br>pendingRequests 当前的请求队列状态<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$http.defaults.transformRequest = function(data){console.log('here'); return data;}</span><br><span class="line">console.log($http.pendingRequests);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>####广义回调管理</p>
<p>和其它框架一样， ng 提供了广义的异步回调管理的机制。 \$http 服务是在其之上封装出来的。这个机制就是 ng 的 \$q 服务。</p>
<p>不过 ng 的这套机制总的来说实现得比较简单，按官方的说法，够用了。</p>
<p>使用的方法，基本上是：</p>
<p>通过 \$q 服务得到一个 deferred 实例<br>通过 deferred 实例的 promise 属性得到一个 promise 对象<br>promise 对象负责定义回调函数<br>deferred 实例负责触发回调,<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($q){</span><br><span class="line">  var defer = $q.defer();</span><br><span class="line">  var promise = defer.promise;</span><br><span class="line">  promise.then(function(data){console.log('ok, ' + data)},</span><br><span class="line">               function(data){console.log('error, ' + data)});</span><br><span class="line">  //defer.reject('xx');</span><br><span class="line">  defer.resolve('xx');</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>了解了上面的东西，再分别看 \$q ， deferred ， promise 这三个东西。</p>
<h4 id="q"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#q" class="headerlink" title="\$q"></a>\$q</h4><p>\$q 有四个方法：</p>
<p>\$q.all() 合并多个 promise ，得到一个新的 promise<br>\$q.defer() 返回一个 deferred 对象<br>\$q.reject() 包装一个错误，以使回调链能正确处理下去<br>\$q.when() 返回一个 promise 对象<br>\$q.all() 方法适用于并发场景很合适：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($q, $http){</span><br><span class="line">  var p = $http.get('/json', {params: {a: 1} });</span><br><span class="line">  var p2 = $http.get('/json', {params: {a: 2} });</span><br><span class="line">  var all = $q.all([p, p2]);</span><br><span class="line">  p.success(function(res){console.log('here')});</span><br><span class="line">  all.then(function(res){console.log(res[0])});</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$q.reject() 方法是在你捕捉异常之后，又要把这个异常在回调链中传下去时使用：</p>
<p>要理解这东西，先看看 promise 的链式回调是如何运作的，看下面两段代码的区别：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var defer = $q.defer();</span><br><span class="line">var p = defer.promise;</span><br><span class="line">p.then(</span><br><span class="line">  function(data){return 'xxx'}</span><br><span class="line">);</span><br><span class="line">p.then(</span><br><span class="line">  function(data){console.log(data)}</span><br><span class="line">);</span><br><span class="line">defer.resolve('123');</span><br><span class="line">var defer = $q.defer();</span><br><span class="line">var p = defer.promise;</span><br><span class="line">var p2 = p.then(</span><br><span class="line">  function(data){return 'xxx'}</span><br><span class="line">);</span><br><span class="line">p2.then(</span><br><span class="line">  function(data){console.log(data)}</span><br><span class="line">);</span><br><span class="line">defer.resolve('123');</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>从模型上看，前者是“并发”，后者才是“链式”。</p>
<p>而 \$q.reject() 的作用就是触发后链的 error 回调：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var defer = $q.defer();</span><br><span class="line">var p = defer.promise;</span><br><span class="line">p.then(</span><br><span class="line">  function(data){return data},</span><br><span class="line">  function(data){return $q.reject(data)}</span><br><span class="line">).</span><br><span class="line">then(</span><br><span class="line">  function(data){console.log('ok, ' + data)},</span><br><span class="line">  function(data){console.log('error, ' + data)}</span><br><span class="line">)</span><br><span class="line">defer.reject('123');</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>最后的 \$q.when() 是把数据封装成 promise 对象：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var p = $q.when(0, function(data){return data},</span><br><span class="line">                   function(data){return data});</span><br><span class="line">p.then(</span><br><span class="line">  function(data){console.log('ok, ' + data)},</span><br><span class="line">  function(data){console.log('error, ' + data)}</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="deferred"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#deferred" class="headerlink" title="deferred"></a>deferred</h4><p>deferred 对象有两个方法一个属性。</p>
<p>promise 属性就是返回一个 promise 对象的。<br>resolve() 成功回调<br>reject() 失败回调<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var defer = $q.defer();</span><br><span class="line">var promise = defer.promise;</span><br><span class="line">promise.then(function(data){console.log('ok, ' + data)},</span><br><span class="line">             function(data){console.log('error, ' + data)});</span><br><span class="line">//defer.reject('xx');</span><br><span class="line">defer.resolve('xx');</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="promise"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#promise" class="headerlink" title="promise"></a>promise</h4><p>promise 对象只有 then() 一个方法，注册成功回调函数和失败回调函数，再返回一个 promise 对象，以用于链式调用。</p>
<h3 id="工具函数"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#工具函数" class="headerlink" title="工具函数"></a>工具函数</h3><h4 id="上下文绑定"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#上下文绑定" class="headerlink" title="上下文绑定"></a>上下文绑定</h4><p>angular.bind 是用来进行上下文绑定，参数动态绑定的工具函数。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var f = angular.bind({a: 'xx'},</span><br><span class="line">  function(){</span><br><span class="line">    console.log(this.a);</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line">f();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>参数动态绑定：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var f = function(x){console.log(x)}</span><br><span class="line">angular.bind({}, f, 'x')();</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="对象处理"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#对象处理" class="headerlink" title="对象处理"></a>对象处理</h4><p>对象复制： angular.copy()<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = {'x': '123'};</span><br><span class="line">var b = angular.copy(a);</span><br><span class="line">a.x = '456';</span><br><span class="line">console.log(b);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>对象聚合： angular.extend()<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = {'x': '123'};</span><br><span class="line">var b = {'xx': '456'};</span><br><span class="line">angular.extend(b, a);</span><br><span class="line">console.log(b);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>空函数： angular.noop()</p>
<p>大小写转换： angular.lowercase() 和 angular.uppercase()</p>
<p>JSON转换： angular.fromJson() 和 angular.toJson()</p>
<p>遍历： angular.forEach() ，支持列表和对象：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var l = {a: '1', b: '2'};</span><br><span class="line">angular.forEach(l, function(v, k){console.log(k + ': ' + v)});</span><br><span class="line"></span><br><span class="line">var l = ['a', 'b', 'c'];</span><br><span class="line">angular.forEach(l, function(v, i, o){console.log(v)});</span><br><span class="line"></span><br><span class="line">var context = {'t': 'xx'};</span><br><span class="line">angular.forEach(l, function(v, i, o){console.log(this.t)}, context);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="类型判定"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#类型判定" class="headerlink" title="类型判定"></a>类型判定</h4><p>angular.isArray<br>angular.isDate<br>angular.isDefined<br>angular.isElement<br>angular.isFunction<br>angular.isNumber<br>angular.isObject<br>angular.isString<br>angular.isUndefined</p>
<h3 id="其它服务"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#其它服务" class="headerlink" title="其它服务"></a>其它服务</h3><h4 id="日志"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#日志" class="headerlink" title="日志"></a>日志</h4><p>ng 提供 \$log 这个服务用于向终端输出相关信息：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error()</span><br><span class="line">info()</span><br><span class="line">log()</span><br><span class="line">warn()</span><br><span class="line">  var TestCtrl = function($log){</span><br><span class="line">    $log.error('error');</span><br><span class="line">    $log.info('info');</span><br><span class="line">    $log.log('log');</span><br><span class="line">    $log.warn('warn');</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="缓存"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#缓存" class="headerlink" title="缓存"></a>缓存</h4><p>ng 提供了一个简单封装了缓存机制 \$cacheFactory ，可以用来作为数据容器：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($scope, $cacheFactory){</span><br><span class="line">  $scope.cache = $cacheFactory('s_' + $scope.$id, {capacity: 3});</span><br><span class="line"></span><br><span class="line">  $scope.show = function(){</span><br><span class="line">    console.log($scope.cache.get('a'));</span><br><span class="line">    console.log($scope.cache.info());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  $scope.set = function(){</span><br><span class="line">    $scope.cache.put((new Date()).valueOf(), 'ok');</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>调用时，第一个参数是 id ，第二个参数是配置项，目前支持 capacity 参数，用以设置缓存能容留的最大条目数。超过这个个数，则自动清除较旧的条目。</p>
<p>缓存实例的方法：</p>
<p>info() 获取 id , size 信息<br>put(k, v) 设置新条目<br>get(k) 获取条目<br>remove(k) 删除条目<br>removeAll() 删除所有条目<br>destroy() 删除对本实例的引用<br>\$http 的调用当中，有一个 cache 参数，值为 true 时为自动维护的缓存。值也可以设置为一个 cache 实例。</p>
<h4 id="计时器"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#计时器" class="headerlink" title="计时器"></a>计时器</h4><p>\$timeout 服务是 ng 对 window.setTimeout() 的封装，它使用 promise 统一了计时器的回调行为：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($timeout){</span><br><span class="line">  var p = $timeout(function(){console.log('haha')}, 5000);</span><br><span class="line">  p.then(function(){console.log('x')});</span><br><span class="line">  //$timeout.cancel(p);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>使用 \$timeout.cancel() 可以取消计时器。</p>
<h4 id="表达式函数化"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#表达式函数化" class="headerlink" title="表达式函数化"></a>表达式函数化</h4><p>\$parse 这个服务，为 js 提供了类似于 Python 中 @property 的能力：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($scope, $parse){</span><br><span class="line">  $scope.get_name = $parse('name');</span><br><span class="line">  $scope.show = function(){console.log($scope.get_name($scope))}</span><br><span class="line">  $scope.set = function(){$scope.name = '123'}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$parse 返回一个函数，调用这个函数时，可以传两个参数，第一个作用域，第二个是变量集，后者常用于覆盖前者的变量：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var get_name = $parse('name');</span><br><span class="line">var r = get_name({name: 'xx'}, {name: 'abc'});</span><br><span class="line">console.log(r);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$parse 返回的函数，也提供了相应的 assign 功能，可以为表达式赋值（如果可以的话）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var get_name = $parse('name');</span><br><span class="line">var set_name = get_name.assign;</span><br><span class="line">var r = get_name({name: 'xx'}, {name: 'abc'});</span><br><span class="line">console.log(r);</span><br><span class="line"></span><br><span class="line">var s = {}</span><br><span class="line">set_name(s, '123');</span><br><span class="line">var r = get_name(s);</span><br><span class="line">console.log(r);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="模板单独使用"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板单独使用" class="headerlink" title="模板单独使用"></a>模板单独使用</h4><p>ng 中的模板是很重要，也很强大的一个机制，自然少不了单独运用它的方法。不过，即使是单独使用，也是和 DOM 紧密相关的程度：</p>
<p>定义时必须是有 HTML 标签包裹的，这样才能创建 DOM 节点<br>渲染时必须传入 \$scope<br>之后使用 \$compile 就可以得到一个渲染好的节点对象了。当然， \$compile 还要做其它一些工作，指令处理什么的。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var TestCtrl = function($scope, $element,$compile){</span><br><span class="line">  $scope.a = '123';</span><br><span class="line">  $scope.set = function(){</span><br><span class="line">    var tpl = $compile('&lt;p&gt;hello {{ a } }&lt;/p&gt;');</span><br><span class="line">    var e = tpl($scope);</span><br><span class="line">    $element.append(e);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="自定义模块和服务"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义模块和服务" class="headerlink" title="自定义模块和服务"></a>自定义模块和服务</h3><h4 id="模块和服务的概念与关系"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模块和服务的概念与关系" class="headerlink" title="模块和服务的概念与关系"></a>模块和服务的概念与关系</h4><p>总的来说，模块是组织业务的一个框框，在一个模块当中定义多个服务。当你引入了一个模块的时候，就可以使用这个模块提供的一种或多种服务了。</p>
<p>比如 AngularJS 本身的一个默认模块叫做 ng ，它提供了 \$http ， \$q 等等服务。</p>
<p>服务只是模块提供的多种机制中的一种，其它的还有命令（ directive ），过滤器（ filter ），及其它配置信息。</p>
<p>然后在额外的 js 文件中有一个附加的模块叫做 ngResource ， 它提供了一个 \$resource 服务。</p>
<p>定义时，我们可以在已有的模块中新定义一个服务，也可以先新定义一个模块，然后在新模块中定义新服务。</p>
<p>使用时，模块是需要显式地的声明依赖（引入）关系的，而服务则可以让 ng 自动地做注入，然后直接使用。</p>
<p>####定义模块<br>定义模块的方法是使用 angular.module 。调用时声明了对其它模块的依赖，并定义了“初始化”函数。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var my_module = angular.module('MyModule', [], function(){</span><br><span class="line">    console.log('here');</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这段代码定义了一个叫做 MyModule 的模块， my_module 这个引用可以在接下来做其它的一些事，比如定义服务。</p>
<p>####定义服务<br>服务本身是一个任意的对象。但是 ng 提供服务的过程涉及它的依赖注入机制。在这里呢，就要先介绍一下叫 provider 的东西。</p>
<p>简单来说， provider 是被“注入控制器”使用的一个对象，注入机制通过调用一个 provider 的 \$get() 方法，把得到的东西作为参数进行相关调用（比如把得到的服务作为一个 Controller 的参数）。</p>
<p>在这里“服务”的概念就比较不明确，对使用而言，服务仅指 \$get() 方法返回的东西，但是在整体机制上，服务又要指提供了 \$get() 方法的整个对象。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//这是一个provider</span><br><span class="line">var pp = function(){</span><br><span class="line">  this.$get = function(){</span><br><span class="line">    return {'haha': '123'};</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//我在模块的初始化过程当中, 定义了一个叫 PP 的服务</span><br><span class="line">var app = angular.module('Demo', [], function($provide){</span><br><span class="line">  $provide.provider('PP', pp);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">//PP服务实际上就是 pp 这个 provider 的 $get() 方法返回的东西</span><br><span class="line">app.controller('TestCtrl',</span><br><span class="line">  function($scope, PP){</span><br><span class="line">    console.log(PP);</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面的代码是一种定义服务的方法，当然， ng 还有相关的 shortcut， ng 总有很多 shortcut 。</p>
<p>第一个是 factory 方法，由 \$provide 提供， module 的 factory 是一个引用，作用一样。这个方法直接把一个函数当成是一个对象的 \$get() 方法，这样你就不用显式地定义一个 provider 了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], function($provide){</span><br><span class="line">   $provide.factory('PP', function(){</span><br><span class="line">     return {'hello': '123'};</span><br><span class="line">   });</span><br><span class="line"> });</span><br><span class="line"> app.controller('TestCtrl', function($scope, PP){ console.log(PP) });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>在 module 中使用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], function(){ });</span><br><span class="line">app.factory('PP', function(){return {'abc': '123'} });</span><br><span class="line">app.controller('TestCtrl', function($scope, PP){ console.log(PP) });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>第二个是 service 方法，也是由 \$provide 提供， module 中有对它的同名引用。 service 和 factory 的区别在于，前者是要求提供一个“构造方法”，后者是要求提供 \$get() 方法。意思就是，前者一定是得到一个 object ，后者可以是一个数字或字符串。它们的关系大概是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], function(){ });</span><br><span class="line">app.service = function(name, constructor){</span><br><span class="line">  app.factory(name, function(){</span><br><span class="line">    return (new constructor());</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里插一句，js 中 new 的作用，以 new a() 为例，过程相当于：</p>
<p>1.创建一个空对象 obj<br>2.把 obj 绑定到 a 函数的上下文当中（即 a 中的 this 现在指向 obj ）<br>3.执行 a 函数<br>4.返回 obj<br>service 方法的使用就很简单了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], function(){ });</span><br><span class="line">app.service('PP', function(){</span><br><span class="line">  this.abc = '123';</span><br><span class="line">});</span><br><span class="line">app.controller('TestCtrl', function($scope, PP){ console.log(PP) });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>####引入模块并使用服务<br>结合上面的“定义模块”和“定义服务”，我们可以方便地组织自己的额外代码：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">angular.module('MyModule', [], function($provide){</span><br><span class="line">  $provide.factory('S1', function(){</span><br><span class="line">    return 'I am S1';</span><br><span class="line">  });</span><br><span class="line">  $provide.factory('S2', function(){</span><br><span class="line">    return {see: function(){return 'I am S2'} }</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">var app = angular.module('Demo', ['MyModule'], angular.noop);</span><br><span class="line">app.controller('TestCtrl', function($scope, S1, S2){</span><br><span class="line">  console.log(S1)</span><br><span class="line">  console.log(S2.see())</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="附加模块-ngResource"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#附加模块-ngResource" class="headerlink" title="附加模块 ngResource"></a>附加模块 ngResource</h3><h4 id="使用引入与整体概念"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#使用引入与整体概念" class="headerlink" title="使用引入与整体概念"></a>使用引入与整体概念</h4><p>ngResource 这个是 ng 官方提供的一个附加模块。附加的意思就是，如果你打算用它，那么你需要引入一个单独的 js 文件，然后在声明“根模块”时注明依赖的 ngResource 模块，接着就可以使用它提供的 \$resource 服务了。完整的过程形如：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html ng-app="Demo"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset="utf-8" /&gt;</span><br><span class="line">&lt;title&gt;AngularJS&lt;/title&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular-resource.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div ng-controller="TestCtrl"&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript" charset="utf-8"&gt;</span><br><span class="line"></span><br><span class="line">var app = angular.module('Demo', ['ngResource'], angular.noop);</span><br><span class="line">app.controller('TestCtrl', function($scope, $resource){</span><br><span class="line">  console.log($resource);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$resource 服务，整体上来说，比较像是使用类似 ORM 的方式来包装了 AJAX 调用。区别就是 ORM 是操作数据库，即拼出 SQL 语句之后，作 execute 方法调用。而 \$resource 的方式是构造出 AJAX 请求，然后发出请求。同时，AJAX 请求是需要回调处理的，这方面， \$resource 的机制可以使你在一些时候省掉回调处理，当然，是否作回调处理在于业务情形及容错需求了。</p>
<p>使用上 \$resource 分成了“类”与“实例”这两个层面。一般地，类的方法调用就是直观的调用形式，通常会返回一个对象，这个对象即为“实例”。</p>
<p>“实例”贯穿整个服务的使用过程。“实例”的数据是填充方式，即因为异步关系，回调函数没有执行时，实例已经存在，只是可能它还没有相关数据，回调执行之后，相关数据被填充到实例对象当中。实例的方法一般就是在类方法名前加一个 \$ ，调用上，根据定义，实例数据可能会做一些自动的参数填充，这点是区别实例与类的调用上的不同。</p>
<p>好吧，上面这些话可能需要在看了接下来的内容之后再回过来理解。</p>
<h4 id="基本定义"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#基本定义" class="headerlink" title="基本定义"></a>基本定义</h4><p>就像使用 ORM 一般要先定义 Model 一样，使用 \$resource 需要先定义“资源”，也就是先定义一些 HTTP 请求。</p>
<p>在业务场景上，我们假设为，我们需要操作“书”这个实体，包括创建create，获取详情read，修改update，删除delete，批量获取multi，共五个操作方法。实体属性有：唯一标识id，标题title，作者author。</p>
<p>我们把这些操作定义成 \$resource 的资源：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', ['ngResource'], angular.noop);</span><br><span class="line">app.controller('BookCtrl', function($scope, $resource){</span><br><span class="line">  var actions = {</span><br><span class="line">    create: {method: 'POST', params: {_method: 'create'} },</span><br><span class="line">    read: {method: 'POST', params: {_method: 'read'} },</span><br><span class="line">    update: {method: 'POST', params: {_method: 'update'} },</span><br><span class="line">    delete: {method: 'POST', params: {_method: 'delete'} },</span><br><span class="line">    multi: {method: 'POST', params: {_method: 'multi'} }</span><br><span class="line">  }</span><br><span class="line">  var Book = $resource('/book', {}, actions);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>定义是使用使用 \$resource 这个函数就可以了，它接受三个参数：</p>
<p>1.url<br>2.默认的params（这里的 params 即是 GET 请求的参数，POST 的参数单独叫做“postData”）<br>3.方法映射</p>
<p>方法映射是以方法名为 key ，以一个对象为 value ，这个 value 可以有三个成员：</p>
<p>1.method, 请求方法，’GET’, ‘POST’, ‘PUT’, ‘DELETE’ 这些<br>2.params, 默认的 GET 参数<br>3.isArray, 返回的数据是不是一个列表</p>
<h4 id="基本使用"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>在定义了资源之后，我们看如果使用这些资源，发出请求：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var book = Book.read({id: '123'}, function(response){</span><br><span class="line">  console.log(response);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里我们进行 Book 的“类”方法调用。在方法的使用上，根据官方文档：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP GET "class" actions: Resource.action([parameters], [success], [error])</span><br><span class="line">non-GET "class" actions: Resource.action([parameters], postData, [success], [error])</span><br><span class="line">non-GET instance actions: instance.$action([parameters], [success], [error])</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>我们这里是第二种形式，即类方法的非 GET 请求。我们给的参数会作为 postData 传递。如果我们需要 GET 参数，并且还需要一个错误回调，那么：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var book = Book.read({get: 'haha'}, {id: '123'},</span><br><span class="line">  function(response){</span><br><span class="line">    console.log(response);</span><br><span class="line">  },</span><br><span class="line">  function(error){</span><br><span class="line">    console.log(error);</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>调用之后，我们会立即得到的 book ，它是 Book 类的一个实例。这里所谓的实例，实际上就是先把所有的 action 加一个 \$ 前缀放到一个空对象里，然后把发出的参数填充进去。等请求返回了，把除 action 以外的成员删除掉，再把请求返回的数据填充到这个对象当中。所以，如果我们这样：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var book = Book.read({id: '123'}, function(response){</span><br><span class="line">  console.log(book);</span><br><span class="line">});</span><br><span class="line">console.log(book)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>就能看到 book 实例的变化过程了。</p>
<p>现在我们得到一个真实的实例，看一下实例的调用过程：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//响应的数据是 {result: 0, msg: '', obj: {id: 'xxx'} }</span><br><span class="line">var book = Book.create({title: '测试标题', author: '测试作者'}, function(response){</span><br><span class="line">  console.log(book);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以看到，在请求回调之后， book 这个实例的成员已经被响应内容填充了。但是这里有一个问题，我们返回的数据，并不适合一个 book 实例。格式先不说，它把 title 和 author 这些信息都丢了（因为响应只返回了 id ）。</p>
<p>如果仅仅是格式问题，我们可以通过配置 \$http 服务来解决（ AJAX 请求都要使用 $http 服务的）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$http.defaults.transformResponse = function(data){return angular.fromJson(data).obj};</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>当然，我们也可以自己来解决一下丢信息的问题：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var p = {title: '测试标题', author: '测试作者'};</span><br><span class="line">var book = Book.create(p, function(response){</span><br><span class="line">  angular.extend(book, p);</span><br><span class="line">  console.log(book);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>不过，始终会有一些不方便了。比较正统的方式应该是调节服务器端的响应，让服务器端也具有和前端一样的实例概念，返回的是完整的实例信息。即使这样，你也还要考虑格式的事。</p>
<p>现在我们得到了一个真实的 book 实例了，带有 id 信息。我们尝试一下实例的方法调用，先回过去头看一下那三种调用形式，对于实例只有第三种形式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">non-GET instance actions: instance.$action([parameters], [success], [error])</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>首先解决一个疑问，如果一个实例是进行一个 GET 的调用会怎么样？没有任何问题，这当然没有任何问题的，形式和上面一样。</p>
<p>如何实例是做 POST 请求的话，从形式上看，我们无法控制请求的 postData ？是的，所有的 POST 请求，其 postData 都会被实例数据自动填充，形式上我们只能控制 params 。</p>
<p>所以，如果是在做修改调用的话：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book.$update({title: '新标题', author: '测试作者'}, function(response){</span><br><span class="line">  console.log(book);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这样是没有意义的并且错误的。因为要修改的数据只是作为 GET 参数传递了，而 postData 传递的数据就是当前实例的数据，并没有任何修改。</p>
<p>正确的做法：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book.title = '新标题'</span><br><span class="line">book.$update(function(response){</span><br><span class="line">  console.log(book);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>显然，这种情况下，回调都可以省了：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book.title = '新标题'</span><br><span class="line">book.$update();</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="定义和使用时的占位量"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#定义和使用时的占位量" class="headerlink" title="定义和使用时的占位量"></a>定义和使用时的占位量</h4><p>两方面。一是在定义时，在其 URL 中可以使用变量引用的形式（类型于定义锚点路由时那样）。第二时定义默认 params ，即 GET 参数时，可以定义为引用 postData 中的某变量。比如我们这样改一下：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Book = $resource('/book/:id', {}, actions);</span><br><span class="line">var book = Book.read({id: '123'}, {}, function(response){</span><br><span class="line">  console.log(response);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>在 URL 中有一个 :id ，表示对 params 中 id 这个变量的引用。因为 read 是一个 POST 请求，根据调用形式，第一个参数是 params ，第二个参数是 postData 。这样的调用结果就是，我们会发一个 POST 请求到如下地址， postData 为空：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/book/123?_method=read</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>再看默认的 params 中引用 postData 变量的形式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Book = $resource('/book', {id: '@id'}, actions);</span><br><span class="line">var book = Book.read({title: 'xx'}, {id: '123'}, function(response){</span><br><span class="line">  console.log(response);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这样会出一个 POST 请求， postData 内容中有一个 id 数据，访问的 URL 是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/book?_method=read&amp;id=123&amp;title=xx</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这两个机制也可以联合使用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Book = $resource('/book/:id', {id: '@id'}, actions);</span><br><span class="line">var book = Book.read({title: 'xx'}, {id: '123'}, function(response){</span><br><span class="line">  console.log(response);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>结果就是出一个 POST 请求， postData 内容中有一个 id 数据，访问的 URL 是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/book/123?_method=read&amp;title=xx</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="实例"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#实例" class="headerlink" title="实例"></a>实例</h4><p>ngResource 要举一个实例是比较麻烦的事。因为它必须要一个后端来支持，这里如果我用 Python 写一个简单的后端，估计要让这个后端跑起来对很多人来说都是问题。所以，我在几套公共服务的 API 中纠结考察了一番，最后使用 www.rememberthemilk.com 的 API 来做了一个简单的，可用的例子。</p>
<p>例子见： <a href="http://zouyesheng.com/demo/ng-resource-demo.html" target="_blank" rel="external">http://zouyesheng.com/demo/ng-resource-demo.html</a> (可以直接下载看源码)</p>
<p>先说一下 API 的情况。这里的请求调用全是跨域的，所以交互上全部是使用了 JSONP 的形式。 API 的使用有使用签名认证机制，嗯， js 中直接算 md5 是可行的，我用了一个现成的库（但是好像不能处理中文吧）。</p>
<p>这个例子中的 LoginCtrl 大家就不用太关心了，参见官方的文档，走完流程拿到 token 完事。与 ngResource 相关的是 MainCtrl 中的东西。</p>
<p>其实从这个例子中就可以看出，目前 ngResource 的机制对于服务端返回的数据的格式是严重依赖的，同时也可以反映出 \$http 对一些场景根本无法应对的局限。所以，我现在的想法是理解 ngResource 的思想，真正需要的人自己使用 jQuery 重新实现一遍也许更好。这应该也花不了多少时间， ngResource 的代码本来不多。</p>
<p>我为什么说 \$http 在一些场景中有局限呢。在这个例子当中，所有的请求都需要带一个签名，签名值是由请求中带的参数根据规则使用 md5 方法计算出的值。我找不到一个 hook 可以让我在请求出去之前修改这个请求（添加上签名）。所以在这个例子当中，我的做法是根据 ngResource 的请求最后会使用 $httpBackend 这个底层服务，在 module 定义时我自己复制官方的相关代码，重新定义 $httpBackend 服务，在需要的地方做我自己的修改：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script.src = sign_url(url);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>不错，我就改了这一句，但我不得不复制了 50 行官方源码到我的例子中。</p>
<p>另外一个需要说的是对返回数据的处理。因为 ngResource 会使用返回的数据直接填充实例，所以这个数据格式就很重要。</p>
<p>首先，我们可以使用 \$http.defaults.transformResponse 来统一处理一下返回的数据，但是这并不能解决所有问题，可目前 ngResource 并不提供对每一个 action 的单独的后处理回调函数项。除非你的服务端是经过专门的适应性设计的，否则你用 ngResource 不可能爽。例子中，我为了获取当前列表的结果，我不得不自己去封装结果：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var list_list = List.getList(function(){</span><br><span class="line">  var res = list_list[1];</span><br><span class="line">  while(list_list.length &gt; 0){list_list.pop()};</span><br><span class="line">  angular.forEach(res.list, function(v){</span><br><span class="line">    list_list.push(new List({list: v}));</span><br><span class="line">  });</span><br><span class="line">  $scope.list_list = list_list;</span><br><span class="line">  $scope.show_add = true;</span><br><span class="line">  return;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="AngularJS与其它框架的混用"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AngularJS与其它框架的混用" class="headerlink" title="AngularJS与其它框架的混用"></a>AngularJS与其它框架的混用</h3><p>这个问题似乎很多人都关心，但是事实是，如果了解了 ng 的工作方式，这本来就不是一个问题了。</p>
<p>在我自己使用 ng 的过程当中，一直是混用 jQuery 的，以前还要加上一个 Dojo 。只要了解每种框架的工作方式，在具体的代码中每个框架都做了什么事，那么整体上控制起来就不会有问题。</p>
<p>回到 ng 上来看，首先对于 jQuery 来说，最开始说提到过，在 DOM 操作部分， ng 与 jQuery 是兼容的，如果没有 jQuery ， ng 自己也实现了兼容的部分 API 。</p>
<p>同时，最开始也提到过， ng 的使用最忌讳的一点就是修改 DOM 结构——你应该使用 ng 的模板机制进行数据绑定，以此来控制 DOM 结构，而不是直接操作。换句话来说，在不动 DOM 结构的这个前提之下，你的数据随便怎么改，随便使用哪个框架来控制都是没问题的，到时如有必要使用 \$scope.$digest() 来通知 ng 一下即可。</p>
<p>下面这个例子，我们使用了 jQuery 中的 Deferred ( \$.ajax 就是返回一个 Deferred )，还使用了 ng 的 \$timeout ，当然是在 ng 的结构之下：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  &lt;html ng-app="Demo"&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line"> &lt;meta charset="utf-8" /&gt;</span><br><span class="line">  &lt;title&gt;AngularJS&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;span ng-click="go()"&gt;{{ a } }&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"</span><br><span class="line">    src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"&gt;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;script type="text/javascript"</span><br><span class="line">    src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js"&gt;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script type="text/javascript"&gt;</span><br><span class="line">  var app = angular.module('Demo', [], angular.noop);</span><br><span class="line">  app.controller('TestCtrl', function($scope, $timeout){</span><br><span class="line">    $scope.a = '点击我开始';</span><br><span class="line"></span><br><span class="line">  var defer = $.Deferred();</span><br><span class="line">    var f = function(){</span><br><span class="line">      if($scope.a == ''){$scope.a = '已停止'; return}</span><br><span class="line">      defer.done(function(){</span><br><span class="line">        $scope.a.length &lt; 10 ? $scope.a += '&gt;' : $scope.a = '&gt;';</span><br><span class="line">        $timeout(f, 100);</span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line">    defer.done(function(){$scope.a = '&gt;'; f()});</span><br><span class="line"></span><br><span class="line">    $scope.go = function(){</span><br><span class="line">      defer.resolve();</span><br><span class="line">      $timeout(function(){$scope.a = ''}, 5000);</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>再把 Dojo 加进来看与 DOM 结构相关的例子。之前说过，使用 ng 就最好不要手动修改 DOM 结构，但这里说两点：</p>
<p>对于整个页面，你可以只在局部使用 ng ，不使用 ng 的地方你可以随意控制 DOM 。<br>如果 DOM 结构有变动，你可以在 DOM 结构定下来之后再初始化 ng 。</p>
<h3 id="自定义过滤器"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><p>先来回顾一下 ng 中的一些概念：</p>
<ol>
<li>module ，代码的组织单元，其它东西都是在定义在具体的模块中的。</li>
<li>app ，业务概念，可能会用到多个模块。</li>
<li>service ，仅在数据层面实现特定业务功能的代码封装。</li>
<li>controller ，与 DOM 结构相关联的东西，即是一种业务封装概念，又体现了项目组织的层级结构。</li>
<li>filter ，改变输入数据的一种机制。</li>
<li>directive ，与 DOM 结构相关联的，特定功能的封装形式。</li>
</ol>
<p>上面的这几个概念基本上就是 ng 的全部。每一部分都可以自由定义，使用时通过各要素的相互配合来实现我们的业务需求。</p>
<p>我们从最开始一致打交道的东西基本上都是 controller 层面的东西。在前面，也介绍了 module 和 service 的自定义。剩下的会介绍 filter 和 directive 的定义。基本上这几部分的定义形式都是一样的，原理上是通过 provider 来做注入形式的声明，在实际操作过程中，又有很多 shortcut 式的声明方式。</p>
<p>过滤器的自定义是最简单的，就是一个函数，接受输入，然后返回结果。在考虑过滤器时，我觉得很重要的一点： 无状态 。</p>
<p>具体来说，过滤器就是一个函数，函数的本质含义就是确定的输入一定得到确定的输出。虽然 filter 是定义在 module 当中的，而且 filter 又是在 controller 的 DOM 范围内使用的，但是，它和具体的 module ， controller ， scope 这些概念都没有关系（虽然在这里你可以使用 js 的闭包机制玩些花样），它仅仅是一个函数，而已。换句话说，它没有任何上下文关联的能力。</p>
<p>过滤器基本的定义方式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line">app.filter('map', function(){</span><br><span class="line">  var filter = function(input){</span><br><span class="line">    return input + '...';</span><br><span class="line">  };</span><br><span class="line">  return filter;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面的代码定义了一个叫做 map 的过滤器。使用时：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;示例数据: {{ a\|map } }&lt;/p&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>过滤器也可以带参数，多个参数之间使用 : 分割，看一个完整的例子：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">   &lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">   &lt;p&gt;示例数据: {{ a\|map:map_value:'&gt;&gt;':'(no)' } }&lt;/p&gt;</span><br><span class="line">   &lt;p&gt;示例数据: {{ b\|map:map_value:'&gt;&gt;':'(no)' } }&lt;/p&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">   var app = angular.module('Demo', [], angular.noop);</span><br><span class="line">   app.controller('TestCtrl', function($scope){</span><br><span class="line">     $scope.map_value = {</span><br><span class="line">       a: '一',</span><br><span class="line">3       b: '二',</span><br><span class="line">       c: '三'</span><br><span class="line">     }</span><br><span class="line">     $scope.a = 'a';</span><br><span class="line">   });</span><br><span class="line"></span><br><span class="line">   app.filter('map', function(){</span><br><span class="line">     var filter = function(input, map_value, append, default_value){</span><br><span class="line">       var r = map_value[input];</span><br><span class="line">       if(r === undefined){ return default_value + append }</span><br><span class="line">       else { return r + append }</span><br><span class="line">     };</span><br><span class="line">     return filter;</span><br><span class="line">   });</span><br><span class="line"></span><br><span class="line">   angular.bootstrap(document, ['Demo']);</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="自定义指令directive"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义指令directive" class="headerlink" title="自定义指令directive"></a>自定义指令directive</h3><p>这是 ng 最强大的一部分，也是最复杂最让人头疼的部分。</p>
<p>目前我们看到的所谓“模板”系统，只不过是官方实现的几个指令而已。这意味着，通过自定义各种指令，我们不但可以完全定义一套“模板”系统，更可以把 HTML 页面直接打造成为一种 DSL （领域特定语言）。</p>
<h4 id="指令的使用"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#指令的使用" class="headerlink" title="指令的使用"></a>指令的使用</h4><p>使用指令时，它的名字可以有多种形式，把指令放在什么地方也有多种选择。</p>
<p>通常，指令的定义名是形如 ngBind 这样的 “camel cased” 形式。在使用时，它的引用名可以是：</p>
<ol>
<li>ng:bind</li>
<li>ng_bind</li>
<li>ng-bind</li>
<li>x-ng-bind</li>
<li>data-ng-bind<br>你可以根据你自己是否有 “HTML validator” 洁癖来选择。</li>
</ol>
<p>指令可以放在多个地方，它们的作用相同：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;span my-dir="exp"&gt;&lt;/span&gt; 作为标签的属性</span><br><span class="line">&lt;span class="my-dir: exp;"&gt;&lt;/span&gt; 作为标签类属性的值</span><br><span class="line">&lt;my-dir&gt;&lt;/my-dir&gt; 作为标签</span><br><span class="line">&lt;!-- directive: my-dir exp --&gt; 作为注释</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这些方式可以使用指令定义中的 restrict 属性来控制。</p>
<p>可以看出，指令即可以作为标签使用，也可以作为属性使用。仔细考虑一下，这在类 XML 的结构当中真算得上是一种神奇的机制。</p>
<h4 id="指令的执行过程"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#指令的执行过程" class="headerlink" title="指令的执行过程"></a>指令的执行过程</h4><p>ng 中对指令的解析与执行过程是这样的：</p>
<ol>
<li>浏览器得到 HTML 字符串内容，解析得到 DOM 结构。</li>
<li>ng 引入，把 DOM 结构扔给 $compile 函数处理：<br> 找出 DOM 结构中有变量占位符<br> 匹配找出 DOM 中包含的所有指令引用<br> 把指令关联到 DOM<br> 关联到 DOM 的多个指令按权重排列<br> 执行指令中的 compile 函数（改变 DOM 结构，返回 link 函数）<br> 得到的所有 link 函数组成一个列表作为 $compile 函数的返回</li>
<li>执行 link 函数（连接模板的 scope）。</li>
</ol>
<h4 id="基本的自定义方法"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#基本的自定义方法" class="headerlink" title="基本的自定义方法"></a>基本的自定义方法</h4><p>自定义一个指令可以非常非常的复杂，但是其基本的调用形式，同自定义服务大概是相同的：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;p show style="font-size: 12px;"&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('show', function(){</span><br><span class="line">  var func = function($scope, $element, $attrs){</span><br><span class="line">    console.log($scope);</span><br><span class="line">    console.log($element);</span><br><span class="line">    console.log($attrs);</span><br><span class="line">  }</span><br><span class="line">  return func;</span><br><span class="line">  //return {compile: function(){return func} }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果在 directive 中直接返回一个函数，则这个函数会作为 compile 的返回值，也即是作为 link 函数使用。这里说的 compile 和 link 都是一个指令的组成部分，一个完整的定义应该返回一个对象，这个对象包括了多个属性：</p>
<p>+name<br>+priority<br>+terminal<br>+scope<br>+controller<br>+require<br>+restrict<br>+template<br>+templateUrl<br>+replace<br>+transclude<br>+compile<br>+link<br>上面的每一个属性，都可以单独探讨的。</p>
<p>下面是一个完整的基本的指令定义例子：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;code lines&gt;</span><br><span class="line">//失去焦点使用 jQuery 的扩展支持冒泡</span><br><span class="line">app.directive('ngBlur', function($parse){</span><br><span class="line">  return function($scope, $element, $attr){</span><br><span class="line">    var fn = $parse($attr['ngBlur']);</span><br><span class="line">    $element.on('focusout', function(event){</span><br><span class="line">      fn($scope, {$event: event});</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line">&lt;/code&gt;</span><br><span class="line"></span><br><span class="line">&lt;div code lines&gt;</span><br><span class="line">//失去焦点使用 jQuery 的扩展支持冒泡</span><br><span class="line">app.directive('ngBlur', function($parse){</span><br><span class="line">  return function($scope, $element, $attr){</span><br><span class="line">    var fn = $parse($attr['ngBlur']);</span><br><span class="line">    $element.on('focusout', function(event){</span><br><span class="line">      fn($scope, {$event: event});</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('code', function(){</span><br><span class="line">   var func = function($scope, $element, $attrs){</span><br><span class="line"></span><br><span class="line">     var html = $element.text();</span><br><span class="line">     var lines = html.split('\n');</span><br><span class="line"></span><br><span class="line">     //处理首尾空白</span><br><span class="line">     if(lines[0] == ''){lines = lines.slice(1, lines.length - 1)}</span><br><span class="line">     if(lines[lines.length-1] == ''){lines = lines.slice(0, lines.length - 1)}</span><br><span class="line"></span><br><span class="line">     $element.empty();</span><br><span class="line"></span><br><span class="line">     //处理外框</span><br><span class="line">     (function(){</span><br><span class="line">       $element.css('clear', 'both');</span><br><span class="line">       $element.css('display', 'block');</span><br><span class="line">       $element.css('line-height', '20px');</span><br><span class="line">       $element.css('height', '200px');</span><br><span class="line">     })();</span><br><span class="line"></span><br><span class="line">     //是否显示行号的选项</span><br><span class="line">     if('lines' in $attrs){</span><br><span class="line">       //处理行号</span><br><span class="line">       (function(){</span><br><span class="line">         var div = $('&lt;div style="width: %spx; background-color: gray; float: left; text-align: right; padding-right: 5px; margin-right: 10px;"&gt;&lt;/div&gt;'</span><br><span class="line">                     .replace('%s', String(lines.length).length * 10));</span><br><span class="line">         var s = '';</span><br><span class="line">         angular.forEach(lines, function(_, i){</span><br><span class="line">           s += '&lt;pre style="margin: 0;"&gt;%s&lt;/pre&gt;\n'.replace('%s', i + 1);</span><br><span class="line">         });</span><br><span class="line">         div.html(s);</span><br><span class="line">         $element.append(div);</span><br><span class="line">       })();</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     //处理内容</span><br><span class="line">     (function(){</span><br><span class="line">       var div = $('&lt;div style="float: left;"&gt;&lt;/div&gt;');</span><br><span class="line">       var s = '';</span><br><span class="line">       angular.forEach(lines, function(l){</span><br><span class="line">         s += '&lt;span style="margin: 0;"&gt;%s&lt;/span&gt;&lt;br /&gt;\n'.replace('%s', l.replace(/\s/g, '&lt;span&gt;&amp;nbsp;&lt;/span&gt;'));</span><br><span class="line">       });</span><br><span class="line">       div.html(s);</span><br><span class="line">       $element.append(div);</span><br><span class="line">     })();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {link: func,</span><br><span class="line">           restrict: 'AE'}; //以元素或属性的形式使用命令</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面这个自定义的指令，做的事情就是解析节点中的文本内容，然后修改它，再把生成的新内容填充到节点当中去。其间还涉及了节点属性值 lines 的处理。这算是指令中最简单的一种形式。因为它是“一次性使用”，中间没有变量的处理。比如如果节点原来的文本内容是一个变量引用，类似于<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{{code}}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>，那上面的代码就不行了。这种情况麻烦得多。后面会讨论。</p>
<h4 id="属性值类型的自定义"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#属性值类型的自定义" class="headerlink" title="属性值类型的自定义"></a>属性值类型的自定义</h4><p>官方代码中的 ng-show 等算是我说的这种类型。使用时主要是在节点加添加一个属性值以附加额外的功能。看一个简单的例子：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;p color="red"&gt;有颜色的文本&lt;/p&gt;</span><br><span class="line">&lt;color color="red"&gt;有颜色的文本&lt;/color&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('color', function(){</span><br><span class="line">  var link = function($scope, $element, $attrs){</span><br><span class="line">    $element.css('color', $attrs.color);</span><br><span class="line">  }</span><br><span class="line">  return {link: link,</span><br><span class="line">          restrict: 'AE'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>我们定义了一个叫 color 的指令，可以指定节点文本的颜色。但是这个例子还无法像 ng-show 那样工作的，这个例子只能渲染一次，然后就无法根据变量来重新改变显示了。要响应变化，我们需要手工使用 scope 的 \$watch 来处理：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;p color="color"&gt;有颜色的文本&lt;/p&gt;</span><br><span class="line">  &lt;p color="'blue'"&gt;有颜色的文本&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type="text/javascript"&gt;</span><br><span class="line"></span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('color', function(){</span><br><span class="line">  var link = function($scope, $element, $attrs){</span><br><span class="line">    $scope.$watch($attrs.color, function(new_v){</span><br><span class="line">      $element.css('color', new_v);</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line">  return link;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.color = 'red';</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="Compile的细节"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#Compile的细节" class="headerlink" title="Compile的细节"></a>Compile的细节</h4><p>指令的处理过程，是 ng 的 Compile 过程的一部分，它们也是紧密联系的。继续深入指令的定义方法，首先就要对 Compile 的过程做更细致的了解。</p>
<p>前面说过， ng 对页面的处理过程：</p>
<p>浏览器把 HTML 字符串解析成 DOM 结构。<br>ng 把 DOM 结构给 \$compile ，返回一个 link 函数。<br>传入具体的 scope 调用这个 link 函数。<br>得到处理后的 DOM ，这个 DOM 处理了指令，连接了数据。<br>\$compile 最基本的使用方式：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var link = $compile('&lt;p&gt;{{ text } }&lt;/p&gt;');</span><br><span class="line">var node = link($scope);</span><br><span class="line">console.log(node);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面的 \$compile 和 link 调用时都有额外参数来实现其它功能。先看 link 函数，它形如：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function(scope[, cloneAttachFn]</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>第二个参数 cloneAttachFn 的作用是，表明是否复制原始节点，及对复制节点需要做的处理，下面这个例子说明了它的作用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id="a"&gt;A {{ text } }&lt;/div&gt;</span><br><span class="line">&lt;div id="b"&gt;B &lt;/div&gt;</span><br><span class="line">app.controller('TestCtrl', function($scope, $compile){</span><br><span class="line">  var link = $compile($('#a'));</span><br><span class="line"></span><br><span class="line">  //true参数表示新建一个完全隔离的scope,而不是继承的child scope</span><br><span class="line">  var scope = $scope.$new(true);</span><br><span class="line">  scope.text = '12345';</span><br><span class="line"></span><br><span class="line">  //var node = link(scope, function(){});</span><br><span class="line">  var node = link(scope);</span><br><span class="line"></span><br><span class="line">  $('#b').append(node);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>cloneAttachFn 对节点的处理是有限制的，你可以添加 class ，但是不能做与数据绑定有关的其它修改（修改了也无效）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">app.controller('TestCtrl', function($scope, $compile){</span><br><span class="line">  var link = $compile($('#a'));</span><br><span class="line">  var scope = $scope.$new(true);</span><br><span class="line">  scope.text = '12345';</span><br><span class="line"></span><br><span class="line">  var node = link(scope, function(clone_element, scope){</span><br><span class="line">    clone_element.text(clone_element.text() + ' ...'); //无效</span><br><span class="line">    clone_element.text('{{ text2 } }'); //无效</span><br><span class="line">    clone_element.addClass('new_class');</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  $('#b').append(node);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>修改无效的原因是，像<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{{ text }}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> 这种所谓的 Interpolate 在 \$compile 中已经被处理过了，生成了相关函数（这里起作用的是 directive 中的一个 postLink 函数），后面执行 link 就是执行了 \$compile 生成的这些函数。当然，如果你的文本没有数据变量的引用，那修改是会有效果的。</p>
<p>前面在说自定义指令时说过， link 函数是由 compile 函数返回的，也就像前面说的，应该把改变 DOM 结构的逻辑放在 compile 函数中做。</p>
<p>\$compile 还有两个额外的参数：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$compile(element, transclude, maxPriority);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>maxPriority 是指令的权重限制，这个容易理解，后面再说。</p>
<p>transclude 是一个函数，这个函数会传递给 compile 期间找到的 directive 的 compile 函数（编译节点的过程中找到了指令，指令的 compile 函数会接受编译时传递的 transclude 函数作为其参数）。</p>
<p>但是在实际使用中，除我们手工在调用 \$compile 之外，初始化时的根节点 compile 是不会传递这个参数的。</p>
<p>在我们定义指令时，它的 compile 函数是这个样子的：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function compile(tElement, tAttrs, transclude) { ... }</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>事实上， transclude 的值，就是 directive 所在的 原始 节点，把原始节点重新做了编译之后得到的 link 函数（需要 directive 定义时使用 transclude 选项），后面会专门演示这个过程。所以，官方文档上也把 transclude 函数描述成 link 函数的样子（如果自定义的指令只用在自己手动 $compile 的环境中，那这个函数的形式是可以随意的）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{function(angular.Scope[, cloneAttachFn]}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>所以记住，定义指令时， compile 函数的第三个参数 transclude ，就是一个 link ，装入 scope 执行它你就得到了一个节点。</p>
<h4 id="transclude的细节"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#transclude的细节" class="headerlink" title="transclude的细节"></a>transclude的细节</h4><p>transclude 有两方面的东西，一个是使用 \$compile 时传入的函数，另一个是定义指令的 compile 函数时接受的一个参数。虽然这里的一出一进本来是相互对应的，但是实际使用中，因为大部分时候不会手动调用 \$compile ，所以，在“默认”情况下，指令接受的 transclude 又会是一个比较特殊的函数。</p>
<p>看一个基本的例子：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('more', function(){</span><br><span class="line">  var func = function(element, attrs, transclude){</span><br><span class="line">    var sum = transclude(1, 2);</span><br><span class="line">    console.log(sum);</span><br><span class="line">    console.log(element);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          restrict: 'E'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope, $compile, $element){</span><br><span class="line">  var s = '&lt;more&gt;123&lt;/more&gt;';</span><br><span class="line">  var link = $compile(s, function(a, b){return a + b});</span><br><span class="line">  var node = link($scope);</span><br><span class="line">  $element.append(node);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>我们定义了一个 more 指令，它的 compile 函数的第三个参数，就是我们手工 \$compile 时传入的。</p>
<p>如果不是手工 \$compile ，而是 ng 初始化时找出的指令，则 transclude 是一个 link 函数（指令定义需要设置 transclude 选项）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div more&gt;123&lt;/div&gt;</span><br><span class="line">app.directive('more', function($rootScope, $document){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line">    var node = link($rootScope);</span><br><span class="line">    node.removeAttr('more'); //不去掉就变死循环了</span><br><span class="line">    $('body', $document).append(node);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          transclude: 'element', // element是节点没,其它值是节点的内容没</span><br><span class="line">          restrict: 'A'};</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="把节点内容作为变量处理的类型"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#把节点内容作为变量处理的类型" class="headerlink" title="把节点内容作为变量处理的类型"></a>把节点内容作为变量处理的类型</h4><p>回顾最开始的那个代码显示的例子，那个例子只能处理一次节点内容。如果节点的内容是一个变量的话，需要用另外的思路来考虑。这里我们假设的例子是，定义一个指令 showLenght ，它的作用是在一段文本的开头显示出这段节点文本的长度，节点文本是一个变量。指令使用的形式是：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div show-length&gt;{{ text } }&lt;/div&gt;</span><br><span class="line">  &lt;button ng-click="text='xx'"&gt;改变&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>从上面的 HTML 代码中，大概清楚 ng 解析它的过程（只看 show-length 那一行）：</p>
<ol>
<li>解析 div 时发现了一个 show-length 的指令。</li>
<li>如果 show-length 指令设置了 transclude 属性，则 div 的节点内容被重新编译，得到的 link 函数作为指令 compile 函数的参数传入。</li>
<li>如果 show-length 指令没有设置 transclude 属性，则继续处理它的子节点（ TextNode ）。</li>
<li>不管是上面的哪种情况，都会继续处理到  这段文本。</li>
<li>发现  是一个 Interpolate ，于是自动在此节点中添加了一个指令，这个指令的 link 函数就是为 scope 添加了一个 \$watch ，实现的功能是是当 scope 作 \$digest 的时候，就更新节点文本。</li>
</ol>
<p>与处理  时添加的指令相同，我们实现 showLength 的思路，也就是：</p>
<ol>
<li>修改原来的 DOM 结构</li>
<li>为 scope 添加 \$watch ，当 \$digest 时修改指定节点的文本，其值为指定节点文本的长度。<br>代码如下：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.directive('showLength', function($rootScope, $document){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line"></span><br><span class="line">    return function(scope, ielement, iattrs, controller){</span><br><span class="line">      var node = link(scope);</span><br><span class="line">      ielement.append(node);</span><br><span class="line">      var lnode = $('&lt;span&gt;&lt;/span&gt;');</span><br><span class="line">      ielement.prepend(lnode);</span><br><span class="line"></span><br><span class="line">      scope.$watch(function(scope){</span><br><span class="line">        lnode.text(node.text().length);</span><br><span class="line">      });</span><br><span class="line">    };</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          transclude: true, // element是节点没,其它值是节点的内容没</span><br><span class="line">          restrict: 'A'};</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>上面代码中，因为设置了 transclude 属性，我们在 showLength 的 link 函数（就是 return 的那个函数）中，使用 func 的第三个函数来重塑了原来的文本节点，并放在我们需要的位置上。然后，我们添加自己的节点来显示长度值。最后给当前的 scope 添加 \$watch ，以更新这个长度值。</p>
<h4 id="指令定义时的参数"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#指令定义时的参数" class="headerlink" title="指令定义时的参数"></a>指令定义时的参数</h4><p>指令定义时的参数如下：</p>
<p>name<br>priority<br>terminal<br>scope<br>controller<br>require<br>restrict<br>template<br>templateUrl<br>replace<br>transclude<br>compile<br>link<br>现在我们开始一个一个地吃掉它们……，但是并不是按顺序讲的。</p>
<p><em>priority</em><br>这个值设置指令的权重，默认是 0 。当一个节点中有多个指令存在时，就按着权限从大到小的顺序依次执行它们的 compile 函数。相同权重顺序不定。<br><em>terminal</em><br>是否以当前指令的权重为结束界限。如果这值设置为 true ，则节点中权重小于当前指令的其它指令不会被执行。相同权重的会执行。<br><em>restrict</em><br>指令可以以哪些方式被使用，可以同时定义多种方式。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E 元素方式 &lt;my-directive&gt;&lt;/my-directive&gt;</span><br><span class="line">A 属性方式 &lt;div my-directive="exp"&gt; &lt;/div&gt;</span><br><span class="line">C 类方式 &lt;div class="my-directive: exp;"&gt;&lt;/div&gt;</span><br><span class="line">M 注释方式 &lt;!-- directive: my-directive exp --&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><em>transclude</em><br>前面已经讲过基本的用法了。可以是 ‘element’ 或 true 两种值。<br><em>compile</em><br>基本的定义函数。 function compile(tElement, tAttrs, transclude) { … }<br><em>link</em><br>前面介绍过了。大多数时候我们不需要单独定义它。只有 compile 未定义时 link 才会被尝试。 function link(scope, iElement, iAttrs, controller) { … }<br><em>scope</em><br>scope 的形式。 false 节点的 scope ， true 继承创建一个新的 scope ， {} 不继承创建一个新的隔离 scope 。 {@attr: ‘引用节点属性’, =attr: ‘把节点属性值引用成scope属性值’, &amp;attr: ‘把节点属性值包装成函数’}<br><em>controller</em><br>为指令定义一个 controller ， function controller($scope, $element, $attrs, $transclude) { … }<br><em>name</em><br>指令的 controller 的名字，方便其它指令引用。<br><em>require</em><br>要引用的其它指令 conroller 的名字， ?name 忽略不存在的错误， ^name 在父级查找。<br><em>template</em><br>模板内容。<br><em>templateUrl</em><br>从指定地址获取模板内容。<br><em>replace</em><br>是否使用模板内容替换掉整个节点， true 替换整个节点， false 替换节点内容。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;a b&gt;&lt;/a&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('a', function(){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line">    console.log('a');</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          priority: 1,</span><br><span class="line">          restrict: 'EA'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.directive('b', function(){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line">    console.log('b');</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          priority: 2,</span><br><span class="line">          //terminal: true,</span><br><span class="line">          restrict: 'A'};</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面几个参数值都是比较简单且容易理想的。</p>
<p>再看 scope 这个参数：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div a b&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('a', function(){</span><br><span class="line">   var func = function(element, attrs, link){</span><br><span class="line">     return function(scope){</span><br><span class="line">       console.log(scope);</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           scope: true,</span><br><span class="line">           restrict: 'A'};</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> app.directive('b', function(){</span><br><span class="line">   var func = function(element, attrs, link){</span><br><span class="line">     return function(scope){</span><br><span class="line">       console.log(scope);</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           restrict: 'A'};</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> app.controller('TestCtrl', function($scope){</span><br><span class="line">   $scope.a = '123';</span><br><span class="line">   console.log($scope);</span><br><span class="line"> });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>对于 scope ：</p>
<p>默认为 false ， link 函数接受的 scope 为节点所在的 scope 。<br>为 true 时，则 link 函数中第一个参数（还有 controller 参数中的 \$scope ）， scope 是节点所在的 scope 的 child scope ，并且如果节点中有多个指令，则只要其中一个指令是 true 的设置，其它所有指令都会受影响。<br>这个参数还有其它取值。当其为 {} 时，则 link 接受一个完全隔离（isolate）的 scope ，于 true 的区别就是不会继承其它 scope 的属性。但是这时，这个 scope 的属性却可以有很灵活的定义方式：</p>
<p>@attr 引用节点的属性。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div a abc="here" xx="{{ a } }" c="ccc"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('a', function(){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line">    return function(scope){</span><br><span class="line">      console.log(scope);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          scope: {a: '@abc', b: '@xx', c: '@'},</span><br><span class="line">          restrict: 'A'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.a = '123';</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>@abc 引用 div 节点的 abc 属性。<br>@xx 引用 div 节点的 xx 属性，而 xx 属性又是一个变量绑定，于是 scope 中 b 属性值就和 TestCtrl 的 a 变量绑定在一起了。<br>@ 没有写 attr name ，则默认取自己的值，这里是取 div 的 c 属性。<br>=attr 相似，只是它把节点的属性值当成节点 scope 的属性名来使用，作用相当于上面例子中的 @xx ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div a abc="here"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('a', function(){</span><br><span class="line">  var func = function(element, attrs, link){</span><br><span class="line">    return function(scope){</span><br><span class="line">      console.log(scope);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          scope: {a: '=abc'},</span><br><span class="line">          restrict: 'A'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.here = '123';</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&amp;attr 是包装一个函数出来，这个函数以节点所在的 scope 为上下文。来看一个很爽的例子：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;div a abc="here = here + 1" ng-click="show(here)"&gt;这里&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;{{ here } }&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('a', function(){</span><br><span class="line">   var func = function(element, attrs, link){</span><br><span class="line">     return function llink(scope){</span><br><span class="line">       console.log(scope);</span><br><span class="line">       scope.a();</span><br><span class="line">       scope.b();</span><br><span class="line"></span><br><span class="line">       scope.show = function(here){</span><br><span class="line">         console.log('Inner, ' + here);</span><br><span class="line">         scope.a({here: 5});</span><br><span class="line">       }</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           scope: {a: '&amp;abc', b: '&amp;ngClick'},</span><br><span class="line">           restrict: 'A'};</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> app.controller('TestCtrl', function($scope){</span><br><span class="line">   $scope.here = 123;</span><br><span class="line">   console.log($scope);</span><br><span class="line"></span><br><span class="line">   $scope.show = function(here){</span><br><span class="line">     console.log(here);</span><br><span class="line">   }</span><br><span class="line"> });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>scope.a 是 &amp;abc ，即：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scope.a = function(){here = here + 1}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>只是其中的 here 是 TestCtrl 的。</p>
<p>scope.b 是 &amp;ngClick ，即：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scope.b = function(){show(here)}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里的 show() 和 here 都是 TestCtrl 的，于是上面的代码最开始会在终端输出一个 124 。</p>
<p>当点击“这里”时，这时执行的 show(here) 就是 llink 中定义的那个函数了，与 TestCtrl 无关。但是，其间的 scope.a({here:5}) ，因为 a 执行时是 TestCtrl 的上下文，于是向 a 传递的一个对象，里面的所有属性 TestCtrl 就全收下了，接着执行 here=here+1 ，于是我们会在屏幕上看到 6 。</p>
<p>这里是一个上下文交错的环境，通过 \&amp; 这种机制，让指令的 scope 与节点的 scope 发生了互动。真是鬼斧神工的设计。而实现它，只用了几行代码：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case '&amp;': {</span><br><span class="line">  parentGet = $parse(attrs[attrName]);</span><br><span class="line">  scope[scopeName] = function(locals) {</span><br><span class="line">    return parentGet(parentScope, locals);</span><br><span class="line">  }</span><br><span class="line">  break;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>再看 controller 这个参数。这个参数的作用是提供一个 controller 的构造函数，它会在 compile 函数之后， link 函数之前被执行。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;haha&lt;/a&gt;</span><br><span class="line"> var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('a', function(){</span><br><span class="line">   var func = function(){</span><br><span class="line">     console.log('compile');</span><br><span class="line">     return function(){</span><br><span class="line">       console.log('link');</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   var controller = function($scope, $element, $attrs, $transclude){</span><br><span class="line">     console.log('controller');</span><br><span class="line">     console.log($scope);</span><br><span class="line"></span><br><span class="line">     var node = $transclude(function(clone_element, scope){</span><br><span class="line">       console.log(clone_element);</span><br><span class="line">       console.log('--');</span><br><span class="line">       console.log(scope);</span><br><span class="line">     });</span><br><span class="line">     console.log(node);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           controller: controller,</span><br><span class="line">           transclude: true,</span><br><span class="line">           restrict: 'E'}</span><br><span class="line"> });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>controller 的最后一个参数， \$transclude ，是一个只接受 cloneAttachFn 作为参数的一个函数。</p>
<p>按官方的说法，这个机制的设计目的是为了让各个指令之间可以互相通信。参考普通节点的处理方式，这里也是处理指令 scope 的合适位置。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> &lt;a b&gt;kk&lt;/a&gt;</span><br><span class="line">  var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">  app.directive('a', function(){</span><br><span class="line">    var func = function(){</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    var controller = function($scope, $element, $attrs, $transclude){</span><br><span class="line">      console.log('a');</span><br><span class="line">      this.a = 'xx';</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return {compile: func,</span><br><span class="line">          name: 'not_a',</span><br><span class="line">           controller: controller,</span><br><span class="line">            restrict: 'E'}</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">app.directive('b', function(){</span><br><span class="line">    var func = function(){</span><br><span class="line">      return function($scope, $element, $attrs, $controller){</span><br><span class="line">        console.log($controller);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    var controller = function($scope, $element, $attrs, $transclude){</span><br><span class="line">      console.log('b');</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return {compile: func,</span><br><span class="line">            controller: controller,</span><br><span class="line">           require: 'not_a',</span><br><span class="line">           restrict: 'EA'}</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>name 参数在这里可以用以为 controller 重起一个名字，以方便在 require 参数中引用。</p>
<p>require 参数可以带两种前缀（可以同时使用）：</p>
<ol>
<li>\? ，如果指定的 controller 不存在，则忽略错误。即：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require: '?not_b'</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>如果名为 not_b 的 controller 不存在时，不会直接抛出错误， link 函数中对应的 $controller 为 undefined 。</p>
<ol>
<li>\^ ，同时在父级节点中寻找指定的 controller ，把上面的例子小改一下：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;&lt;b&gt;kk&lt;/b&gt;&lt;/a&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>把 a 的 require 改成（否则就找不到 not_a 这个 controller ）：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require: '?^not_a'</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>还剩下几个模板参数：</p>
<p><em>template</em> 模板内容，这个内容会根据 replace 参数的设置替换节点或只替换节点内容。<br><em>templateUrl</em> 模板内容，获取方式是异步请求。<br><em>replace</em> 设置如何处理模板内容。为 true 时为替换掉指令节点，否则只替换到节点内容。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;h1 a&gt;原始内容&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('a', function(){</span><br><span class="line">  var func = function(){</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          template: '&lt;p&gt;标题 {{ name } } &lt;button ng-click="name=\'hahaha\'"&gt;修改&lt;/button&gt;&lt;/p&gt;',</span><br><span class="line">          //replace: true,</span><br><span class="line">          //controller: function($scope){$scope.name = 'xxx'},</span><br><span class="line">          //scope: {},</span><br><span class="line">          scope: true ,</span><br><span class="line">          controller: function($scope){console.log($scope)},</span><br><span class="line">          restrict: 'A'}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.name = '123';</span><br><span class="line">  console.log($scope);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>template 中可以包括变量引用的表达式，其 scope 遵寻 scope 参数的作用（可能受继承关系影响）。</p>
<p>templateUrl 是异步请求模板内容，并且是获取到内容之后才开始执行指令的 compile 函数。</p>
<p>最后说一个 compile 这个参数。它除了可以返回一个函数用为 link 函数之外，还可以返回一个对象，这个对象能包括两个成员，一个 pre ，一个 post 。实际上， link 函数是由两部分组成，所谓的 preLink 和 postLink 。区别在于执行顺序，特别是在指令层级嵌套的结构之下， postLink 是在所有的子级指令 link 完成之后才最后执行的。 compile 如果只返回一个函数，则这个函数被作为 postLink 使用：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;</span><br><span class="line"> var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('a', function(){</span><br><span class="line">   var func = function(){</span><br><span class="line">     console.log('a compile');</span><br><span class="line">     return {</span><br><span class="line">       pre: function(){console.log('a link pre')},</span><br><span class="line">       post: function(){console.log('a link post')},</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           restrict: 'E'}</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> app.directive('b', function(){</span><br><span class="line">   var func = function(){</span><br><span class="line">     console.log('b compile');</span><br><span class="line">     return {</span><br><span class="line">       pre: function(){console.log('b link pre')},</span><br><span class="line">       post: function(){console.log('b link post')},</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return {compile: func,</span><br><span class="line">           restrict: 'E'}</span><br><span class="line"> });</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="Attributes的细节"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#Attributes的细节" class="headerlink" title="Attributes的细节"></a>Attributes的细节</h4><p>节点属性被包装之后会传给 compile 和 link 函数。从这个操作中，我们可以得到节点的引用，可以操作节点属性，也可以为节点属性注册侦听事件。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;test a="1" b c="xxx"&gt;&lt;/test&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('test', function(){</span><br><span class="line">  var func = function($element, $attrs){</span><br><span class="line">    console.log($attrs);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          restrict: 'E'}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>整个 Attributes 对象是比较简单的，它的成员包括了：</p>
<ol>
<li>\$\$element 属性所在的节点。</li>
<li>\$attr 所有的属性值（类型是对象）。</li>
<li>\$normalize 一个名字标准化的工具函数，可以把 ng-click 变成 ngClick 。</li>
<li>\$observe 为属性注册侦听器的函数。</li>
<li>\$set 设置对象属性，及节点属性的工具。</li>
</ol>
<p>除了上面这些成员，对象的成员还包括所有属性的名字。</p>
<p>先看 \$observe 的使用，基本上相当于 \$scope 中的 \$watch ：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;test a="{{ a } }" b c="xxx"&gt;&lt;/test&gt;</span><br><span class="line">  &lt;button ng-click="a=a+1"&gt;修改&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('test', function(){</span><br><span class="line">  var func = function($element, $attrs){</span><br><span class="line">    console.log($attrs);</span><br><span class="line"></span><br><span class="line">    $attrs.$observe('a', function(new_v){</span><br><span class="line">      console.log(new_v);</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          restrict: 'E'}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.a = 123;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>\$set 方法的定义是： function(key, value, writeAttr, attrName) { … } 。</p>
<ol>
<li>key 对象的成员名。</li>
<li>value 需要设置的值。</li>
<li>writeAttr 是否同时修改 DOM 节点的属性（注意区别“节点”与“对象”），默认为 true 。</li>
<li>attrName 实际的属性名，与“标准化”之后的属性名有区别。<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;test a="1" ys-a="123" ng-click="show(1)"&gt;这里&lt;/test&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('test', function(){</span><br><span class="line">  var func = function($element, $attrs){</span><br><span class="line">    $attrs.$set('b', 'ooo');</span><br><span class="line">    $attrs.$set('a-b', '11');</span><br><span class="line">    $attrs.$set('c-d', '11', true, 'c_d');</span><br><span class="line">    console.log($attrs);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: func,</span><br><span class="line">          restrict: 'E'}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.show = function(v){console.log(v);}</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>从例子中可以看到，原始的节点属性值对，放到对象中之后，名字一定是“标准化”之后的。但是手动 \$set 的新属性，不会自动做标准化处理。</p>
<h4 id="预定义的-NgModelController"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#预定义的-NgModelController" class="headerlink" title="预定义的 NgModelController"></a>预定义的 NgModelController</h4><p>在前面讲 conroller 参数的时候，提到过可以为指令定义一个 conroller 。官方的实现中，有很多已定义的指令，这些指令当中，有两个已定义的 conroller ，它们是 NgModelController 和 FormController ，对应 ng-model 和 form 这两个指令（可以参照前面的“表单控件”一章）。</p>
<p>在使用中，除了可以通过 \$scope 来取得它们的引用之外，也可以在自定义指令中通过 require 参数直接引用，这样就可以在 link 函数中使用 controller 去实现一些功能。</p>
<p>先看 NgModelController 。这东西的作用有两个，一是控制 ViewValue 与 ModelValue 之间的转换关系（你可以实现看到的是一个值，但是存到变量里变成了另外一个值），二是与 FormController 配合做数据校验的相关逻辑。</p>
<p>先看两个应该是最有用的属性：</p>
<p><em>\$formatters</em> 是一个由函数组成的列表，串行执行，作用是把变量值变成显示的值。<br><em>\$parsers</em> 与上面的方向相反，把显示的值变成变量值。<br>假设我们在变量中要保存一个列表的类型，但是显示的东西只能是字符串，所以这两者之间需要一个转换：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;input type="text" ng-model="a" test /&gt;</span><br><span class="line">    &lt;button ng-click="show(a)"&gt;查看&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">   var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">   app.directive('test', function(){</span><br><span class="line">     var link = function($scope, $element, $attrs, $ctrl){</span><br><span class="line"></span><br><span class="line">       $ctrl.$formatters.push(function(value){</span><br><span class="line">         return value.join(',');</span><br><span class="line">       });</span><br><span class="line"></span><br><span class="line">       $ctrl.$parsers.push(function(value){</span><br><span class="line">         return value.split(',');</span><br><span class="line">       });</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     return {compile: function(){return link},</span><br><span class="line">             require: 'ngModel',</span><br><span class="line">             restrict: 'A'}</span><br><span class="line">   });</span><br><span class="line"></span><br><span class="line">   app.controller('TestCtrl', function($scope){</span><br><span class="line">     $scope.a = [];</span><br><span class="line">     //$scope.a = [1,2,3];</span><br><span class="line">     $scope.show = function(v){</span><br><span class="line">       console.log(v);</span><br><span class="line">     }</span><br><span class="line">   });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>上面在定义 test 这个指令， require 参数指定了 ngModel 。同时因为 DOM 结构， ng-model 是存在的。于是， link 函数中就可以获取到一个 NgModelController 的实例，即代码中的 \$ctrl 。</p>
<p>我们添加了需要的过滤函数：</p>
<ol>
<li>从变量( ModelValue )到显示值( ViewValue )的过程， \$formatters 属性，把一个列表变成一个字符串。</li>
<li>从显示值到变量的过程， \$parsers 属性，把一个字符串变成一个列表。<br>对于显示值和变量，还有其它的 API ，这里就不细说了。</li>
</ol>
<p>另一部分，是关于数据校验的，放到下一章同 FormController 一起讨论。</p>
<h4 id="预定义的-FormController"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#预定义的-FormController" class="headerlink" title="预定义的 FormController"></a>预定义的 FormController</h4><p>前面的“表单控制”那章，实际上讲的就是 FormController ，只是那里是从 scope 中获取到的引用。现在从指令定义的角度，来更清楚地了解 FormController 及 NgModelController 是如何配合工作的。</p>
<p>先说一下， form 和 ngForm 是官方定义的两个指令，但是它们其实是同一个东西。前者只允许以标签形式使用，而后者允许 EAC 的形式。DOM 结构中， form 标签不能嵌套，但是 ng 的指令没有这个限制。不管是 form 还是 ngForm ，它们的 controller 都被命名成了 form 。 所以 require 这个参数不要写错了。</p>
<p>FormController 的几个成员是很好理解的：</p>
<ol>
<li>\$pristine 表单是否被动过</li>
<li>\$dirty 表单是否没被动过</li>
<li>\$valid 表单是否检验通过</li>
<li>\$invalid 表单是否检验未通过</li>
<li>\$error 表单中的错误</li>
<li>\$setDirty() 直接设置 $dirty 及 $pristine<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;div ng-form test&gt;</span><br><span class="line">      &lt;input ng-model="a" type="email" /&gt;</span><br><span class="line">      &lt;button ng-click="do()"&gt;查看&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">  app.directive('test', function(){</span><br><span class="line">    var link = function($scope, $element, $attrs, $ctrl){</span><br><span class="line">      $scope.do = function(){</span><br><span class="line">        //$ctrl.$setDirty();</span><br><span class="line">        console.log($ctrl.$pristine); //form是否没被动过</span><br><span class="line">        console.log($ctrl.$dirty); //form是否被动过</span><br><span class="line">        console.log($ctrl.$valid); //form是否被检验通过</span><br><span class="line">        console.log($ctrl.$invalid); //form是否有错误</span><br><span class="line">        console.log($ctrl.$error); //form中有错误的字段</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return {compile: function(){return link},</span><br><span class="line">            require: 'form',</span><br><span class="line">            restrict: 'A'}</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  app.controller('TestCtrl', function($scope){</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>\$error 这个属性，是一个对象， key 是错误名， value 部分是一个列表，其成员是对应的 NgModelController 的实例。</p>
<p>FormController 可以自由增减它包含的那些，类似于 NgModelController 的实例。在 DOM 结构上，有 ng-model 的 input 节点的 NgMoelController 会被自动添加。</p>
<ol>
<li>\$addControl() 添加一个 conroller</li>
<li>\$removeControl() 删除一个 controller<br>这两个手动使用机会应该不会很多。被添加的实例也可以手动实现所有的 NgModelController 的方法<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">    &lt;bb /&gt;</span><br><span class="line">    &lt;div ng-form test&gt;</span><br><span class="line">      &lt;input ng-model="a" type="email" /&gt;</span><br><span class="line">      &lt;button ng-click="add()"&gt;添加&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">   var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">   app.directive('test', function(){</span><br><span class="line">     var link = function($scope, $element, $attrs, $ctrl){</span><br><span class="line">       $scope.add = function(){</span><br><span class="line">         $ctrl.$addControl($scope.bb);</span><br><span class="line">         console.log($ctrl);</span><br><span class="line">       }</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     return {compile: function(){return link},</span><br><span class="line">             require: 'form',</span><br><span class="line">             restrict: 'A'}</span><br><span class="line">   });</span><br><span class="line"></span><br><span class="line">   app.directive('bb', function(){</span><br><span class="line">     var controller = function($scope, $element, $attrs, $transclude){</span><br><span class="line">       $scope.bb = this;</span><br><span class="line">       this.$name = 'bb';</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     return {compile: angular.noop,</span><br><span class="line">             restrict: 'E',</span><br><span class="line">             controller: controller}</span><br><span class="line">   });</span><br><span class="line"></span><br><span class="line">   app.controller('TestCtrl', function($scope){</span><br><span class="line">   });</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>整合 FormController 和 NgModelController 就很容易扩展各种类型的字段:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">   &lt;form name="f"&gt;</span><br><span class="line">     &lt;input type="my" ng-model="a" /&gt;</span><br><span class="line">     &lt;button ng-click="show()"&gt;查看&lt;/button&gt;</span><br><span class="line">   &lt;/form&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">  var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">  app.directive('input', function(){</span><br><span class="line">    var link = function($scope, $element, $attrs, $ctrl){</span><br><span class="line">      console.log($attrs.type);</span><br><span class="line">      var validator = function(v){</span><br><span class="line">        if(v == '123'){</span><br><span class="line">          $ctrl.$setValidity('my', true);</span><br><span class="line">          return v;</span><br><span class="line">        } else {</span><br><span class="line">          $ctrl.$setValidity('my', false);</span><br><span class="line">          return undefined;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      $ctrl.$formatters.push(validator);</span><br><span class="line">      $ctrl.$parsers.push(validator);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return {compile: function(){return link},</span><br><span class="line">            require: 'ngModel',</span><br><span class="line">            restrict: 'E'}</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  app.controller('TestCtrl', function($scope){</span><br><span class="line">      $scope.show = function(){</span><br><span class="line">        console.log($scope.f);</span><br><span class="line">      }</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>虽然官方原来定义了几种 type ，但这不妨碍我们继续扩展新的类型。如果新的 type 参数值不在官方的定义列表里，那会按 text 类型先做处理，这其实什么影响都没有。剩下的，就是写我们自己的验证逻辑就行了。</p>
<p>上面的代码是参见官方的做法，使用格式化的过程，同时在里面做有效性检查。</p>
<h4 id="示例：文本框"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#示例：文本框" class="headerlink" title="示例：文本框"></a>示例：文本框</h4><p>这个例子与官网上的那个例子相似。最终是要显示一个文本框，这个文本框由标题和内容两部分组成。而且标题和内容则是引用 controller 中的变量值。</p>
<p>HTML 部分的代码：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">   &lt;ys-block title="title" text="text"&gt;&lt;/ys-block&gt;</span><br><span class="line">   &lt;p&gt;标题: &lt;input ng-model="title" /&gt;&lt;/p&gt;</span><br><span class="line">   &lt;p&gt;内容: &lt;input ng-model="text" /&gt;&lt;/p&gt;</span><br><span class="line">   &lt;ys-block title="title" text="text"&gt;&lt;/ys-block&gt;</span><br><span class="line"> &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>从这个期望实现效果的 HTML 代码中，我们可以考虑设计指令的实现方式：</p>
<ol>
<li>这个指令的使用方式是“标签”， 即 restrict 这个参数应该设置为 E 。</li>
<li>节点的属性值是对 controller 变量的引用，那么我们应该在指令的 scope 中使用 = 的方式来指定成员值。</li>
<li>最终的效果显示需要进行 DOM 结构的重构，那直接使用 template 就好了。</li>
<li>自定义的标签在最终效果中是多余的，所有 replace 应该设置为 true 。<br>JS 部分的代码：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line"> app.directive('ysBlock', function(){</span><br><span class="line">   return {compile: angular.noop,</span><br><span class="line">           template: '&lt;div style="width: 200px; border: 1px solid black;"&gt;&lt;h1 style="background-color: gray; color: white; font-size: 22px;"&gt;{{ title } }&lt;/h1&gt;&lt;div&gt;{{ text } }&lt;/div&gt;&lt;/div&gt;',</span><br><span class="line">           replace: true,</span><br><span class="line">           scope: {title: '=title', text: '=text'},</span><br><span class="line">           restrict: 'E'};</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> app.controller('TestCtrl', function($scope){</span><br><span class="line">   $scope.title = '标题在这里';</span><br><span class="line">   $scope.text = '内容在这里';</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>可以看到，这种简单的组件式指令，只需要作 DOM 结构的变换即可实现，连 compile 函数都不需要写</p>
<h4 id="示例：模板控制语句-for"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#示例：模板控制语句-for" class="headerlink" title="示例：模板控制语句 for"></a>示例：模板控制语句 for</h4><p>这个示例尝试实现一个重复语句，功能同官方的 ngRepeat ，但是使用方式类似于我们通常编程语言中的 for 语句：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl" ng-init="obj_list=[1,2,3,4]; name='name'"&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;for o in obj_list&gt;</span><br><span class="line">        &lt;li&gt;{{ o } }, {{ name } }&lt;/li&gt;</span><br><span class="line">      &lt;/for&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;button ng-click="obj_list=[1,2]; name='o?'"&gt;修改&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>同样，我们从上面的使用方式去考虑这个指令的实现：</p>
<ol>
<li>这是一个完全的控制指令，所以单个节点应该只有它一个指令起作用就好了，于是权重要比较高，并且“到此为止”—— priority 设置为 1000 ， terminal 设置为 true 。</li>
<li>使用时的语法问题。事实上浏览器会把 for 节点补充成一个正确的 HTML 结构，即里面的属性都会变成类似 o=”” 这样。我们通过节点的 outerHTML 属性取到字符串并解析取得需要的信息。</li>
<li>我们把 for 节点之间的内容作为一个模板，并且通过循环多次渲染该模板之后把结果填充到合适的位置。</li>
<li>在处理上面的那个模板时，需要不断地创建新 scope 的，并且 o 这个成员需要单独赋值。</li>
</ol>
<p>注意：这里只是简单实现功能。官方的那个 ngRepeat 比较复杂，是做了专门的算法优化的。当然，这里的实现也可以是简单把 DOM 结构变成使用 ngRepeat 的形式 :)</p>
<p>JS 部分代码：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('for', function($compile){</span><br><span class="line">  var compile = function($element, $attrs, $link){</span><br><span class="line">    var match = $element[0].outerHTML.match('&lt;for (.*?)=.*? in=.*? (.*?)=.*?&gt;');</span><br><span class="line">    if(!match \|\| match.length != 3){throw Error('syntax: &lt;for o in obj_list&gt;')}</span><br><span class="line">    var iter = match[1];</span><br><span class="line">    var list = match[2];</span><br><span class="line">    var tpl = $compile($.trim($element.html()));</span><br><span class="line">    $element.empty();</span><br><span class="line"></span><br><span class="line">    var link = function($scope, $ielement, $iattrs, $controller){</span><br><span class="line"></span><br><span class="line">    var new_node = [];</span><br><span class="line"></span><br><span class="line">      $scope.$watch(list, function(list){</span><br><span class="line">        angular.forEach(new_node, function(n){n.remove()});</span><br><span class="line">        var scp, inode;</span><br><span class="line">        for(var i = 0, ii = list.length; i &lt; ii; i++){</span><br><span class="line">          scp = $scope.$new();</span><br><span class="line">          scp[iter] = list[i];</span><br><span class="line">          inode = tpl(scp, angular.noop);</span><br><span class="line">          $ielement.before(inode);</span><br><span class="line">          new_node.push(inode);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return link;</span><br><span class="line">  }</span><br><span class="line">  return {compile: compile,</span><br><span class="line">          priority: 1000,</span><br><span class="line">          terminal: true,</span><br><span class="line">          restrict: 'E'};</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', angular.noop);</span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="示例：模板控制语句-if-else"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#示例：模板控制语句-if-else" class="headerlink" title="示例：模板控制语句 if/else"></a>示例：模板控制语句 if/else</h4><p>这个示例是尝试实现：<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ng-controller="TestCtrl"&gt;</span><br><span class="line">  &lt;if true="a == 1"&gt;</span><br><span class="line">      &lt;p&gt;判断为真, {{ name } }&lt;/p&gt;</span><br><span class="line">    &lt;else&gt;</span><br><span class="line">      &lt;p&gt;判断为假, {{ name } }&lt;/p&gt;</span><br><span class="line">    &lt;/else&gt;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;a: &lt;input ng-model="a" /&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;name: &lt;input ng-model="name" /&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>考虑实现的思路：</p>
<ol>
<li>else 与 if 是两个指令，它们是父子关系。通过 scope 可以联系起来。至于 scope 是在 link 中处理还是 controller 中处理并不重要。</li>
<li>true 属性的条件判断通过 $parse 服务很容易实现。</li>
<li>如果最终效果要去掉 if 节点，我们可以使用注释节点来“占位”。<br>JS 代码：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">var app = angular.module('Demo', [], angular.noop);</span><br><span class="line"></span><br><span class="line">app.directive('if', function($parse, $compile){</span><br><span class="line">  var compile = function($element, $attrs){</span><br><span class="line">    var cond = $parse($attrs.true);</span><br><span class="line"></span><br><span class="line">    var link = function($scope, $ielement, $iattrs, $controller){</span><br><span class="line">      $scope.if_node = $compile($.trim($ielement.html()))($scope, angular.noop);</span><br><span class="line">      $ielement.empty();</span><br><span class="line">      var mark = $('&lt;!-- IF/ELSE --&gt;');</span><br><span class="line">      $element.before(mark);</span><br><span class="line">      $element.remove();</span><br><span class="line"></span><br><span class="line">      $scope.$watch(function(scope){</span><br><span class="line">        if(cond(scope)){</span><br><span class="line">          mark.after($scope.if_node);</span><br><span class="line">          $scope.else_node.detach();</span><br><span class="line">        } else {</span><br><span class="line">          if($scope.else_node !== undefined){</span><br><span class="line">            mark.after($scope.else_node);</span><br><span class="line">            $scope.if_node.detach();</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line">    return link;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: compile,</span><br><span class="line">          scope: true,</span><br><span class="line">          restrict: 'E'}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.directive('else', function($compile){</span><br><span class="line">  var compile = function($element, $attrs){</span><br><span class="line"></span><br><span class="line">    var link = function($scope, $ielement, $iattrs, $controller){</span><br><span class="line">      $scope.else_node = $compile($.trim($ielement.html()))($scope, angular.noop);</span><br><span class="line">      $element.remove();</span><br><span class="line">    }</span><br><span class="line">    return link;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return {compile: compile,</span><br><span class="line">          restrict: 'E'}</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.controller('TestCtrl', function($scope){</span><br><span class="line">  $scope.a = 1;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">angular.bootstrap(document, ['Demo']);</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>代码中注意一点，就是 if_node 在得到之时，就已经是做了变量绑定的了。错误的思路是，在 $watch 中再去不断地得到新的 if_node 。</p>
<h3 id="谢谢！"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#谢谢！" class="headerlink" title="谢谢！"></a>谢谢！</h3><p>转载请注明出处：<a href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子.html" target="_blank" rel="external">http://www.haomou.net/2014/09/12/2014_angularjs_2/</a></p>
<p>有问题请留言。T_T  皓眸大前端开发学习  T_T</p>

      </div>
      <footer class="article-footer">
        <a data-url="http://haomou.net/2014/09/12/2014_angularjs_2/" data-id="cio2a311z00jbgskpv3nsoj6a" class="article-share-link">Share</a>
        
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="http://www.haomou.net/tags/AngularJS/">AngularJS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="http://www.haomou.net/tags/%E7%AC%94%E8%AE%B0/">笔记</a></li></ul>

      </footer>
<!-- 添加的分享 -->
      <div class="bdsharebuttonbox bdshare-button-style0-32" data-bd-bind="1463015117559"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_more" data-cmd="more"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a></div>
      <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin","sqq","youdao"],"viewText":"分享到：","viewSize":"24"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin","sqq","youdao"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

    </div>
  </article>
  
  
    <section id="comments">
      <!-- 多说评论框 start -->
      <div class="ds-thread" data-thread-key="post-2014_angularjs_2" data-title="AngularJS笔记-详细使用" data-url="http://haomou.net/2014/09/12/2014_angularjs_2/" id="ds-thread"><div id="ds-reset"><div class="ds-meta" style="display: none;"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">喜欢</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div><div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">最新</a><a class="ds-order-asc ds-current">最早</a><a class="ds-order-hot">最热</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"><span class="ds-highlight">1</span>条评论</a></li>  </ul></div><ul class="ds-comments"><li class="ds-post" data-post-id="1331012701492609288"><div class="ds-post-self" data-post-id="1331012701492609288" data-thread-id="1331012701492609136" data-root-id="0" data-source="duoshuo"><div class="ds-avatar"><img src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/noavatar_default.png" alt="stephen"></div><div class="ds-comment-body"><div class="ds-comment-header"><span class="ds-user-name" data-qqt-account="">stephen</span></div><p>写的很好的一篇文章，竟然没有人回复！支持一下~<br>
思路很流程，我竟然四个小时一口气看下来了~~弄明白很多很多概念~谢谢~</p><div class="ds-comment-footer ds-comment-actions"><span class="ds-time" datetime="2015-10-11T04:17:48+08:00" title="2015年10月11日 上午4:17:48">2015年10月11日</span><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>回复</a><a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>顶</a><a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>转发</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>举报</a></div></div></div></li></ul><div class="ds-paginator" style="display: none;"><div class="ds-border"></div><a data-page="1" href="javascript:void(0);" class="ds-current">1</a></div><a name="respond"></a><div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list"><li><a href="http://haomou.duoshuo.com/login/weixin/" rel="nofollow" class="ds-service-link ds-weixin">微信</a></li><li><a href="http://haomou.duoshuo.com/login/weibo/" rel="nofollow" class="ds-service-link ds-weibo">微博</a></li><li><a href="http://haomou.duoshuo.com/login/qq/" rel="nofollow" class="ds-service-link ds-qq">QQ</a></li><li><a href="http://haomou.duoshuo.com/login/renren/" rel="nofollow" class="ds-service-link ds-renren">人人</a></li><li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services"><li><a href="http://haomou.duoshuo.com/login/douban/" rel="nofollow" class="ds-service-link ds-douban">豆瓣</a></li><li><a href="http://haomou.duoshuo.com/login/kaixin/" rel="nofollow" class="ds-service-link ds-kaixin">开心</a></li><li><a href="http://haomou.duoshuo.com/login/baidu/" rel="nofollow" class="ds-service-link ds-baidu">百度</a></li><li><a href="http://haomou.duoshuo.com/login/google/" rel="nofollow" class="ds-service-link ds-google">谷歌</a></li></ul></div></div><div class="ds-replybox"><a class="ds-avatar" href="javascript:void(0);" onclick="return false"><img src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/noavatar_default.png" alt=""></a><form method="post"><input type="hidden" name="thread_id" value="1331012701492609136">
<input type="hidden" name="parent_id" value="">
<input type="hidden" name="nonce" value="5707478c43dd3"><div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="说点什么吧…"></textarea><pre class="ds-hidden-text"></pre></div><div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync"></span></div><button class="ds-post-button" type="submit">发布</button><div class="ds-toolbar-buttons"><a class="ds-toolbar-button ds-add-emote" title="插入表情"></a></div></div></form></div><p class="ds-powered-by"><a href="http://duoshuo.com/" target="_blank" rel="nofollow">皓眸网正在使用多说</a></p></div></div>
      <!-- 多说评论框 end -->
      <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
      var duoshuoQuery = {short_name:'haomou'};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
      <!-- 多说公共JS代码 end -->
    </section>
    

            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-myself" style="clear:both">
      <link media="all" href="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/nav.css" type="text/css" rel="stylesheet">
      <!--<div id="container">-->
      	<!--<div class=flash-box>-->
      		<!--<h2>网易微专业(优秀学员直接进网易/阿里/腾讯/百度等名企)</h2>-->
      		<!--<div class="big-pic" id="SwitchBigPic">-->
      		<!--&lt;!&ndash;	<A href="http://mooc.study.163.com/smartSpec/detail/28001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" id="top2360" target="_blank" title="自由职业摄影师"><IMG src="/nav/images/top1.png"></A> &ndash;&gt;-->
            <!--&lt;!&ndash;<A href="http://s.click.taobao.com/r2lgLYx" id="top2365" target="_blank" title="床上大号电脑桌36元包邮"><IMG src="/nav/images/computerDesk.png"></A>&ndash;&gt;-->
      		<!--<A href="http://mooc.study.163.com/smartSpec/detail/12001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" id="top2359" target="_blank" title="前端工程师微专业"><IMG src="/nav/images/webfront.png"></A>-->
      		<!--<A href="http://mooc.study.163.com/smartSpec/detail/85003.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate-->
            <!--" id="top2366" target="_blank" title="《产品经理》微专业"><IMG src="/nav/images/pm.jpg"></A>-->
            <!--<A href="http://mooc.study.163.com/smartSpec/detail/85002.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate-->
<!--" id="top2367" target="_blank" title="《JavaWeb开发工程师》微专业"><IMG src="/nav/images/java.jpg"></A>-->
      		<!--<A href="http://mooc.study.163.com/smartSpec/detail/20001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" id="top2361" target="_blank" title="MySQL数据库管理工程师"><IMG src="/nav/images/top2.png"></A>-->
      		<!--<A href="http://mooc.study.163.com/smartSpec/detail/16001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate-->
<!--" id="top2362" target="_blank" title="大数据工程师"><IMG src="/nav/images/top3.png"></A>-->
      	<!--&lt;!&ndash;	<A href="http://mooc.study.163.com/smartSpec/detail/50002.htm?utm_source=caohuanhuan&utm_medium=cps&utm_campaign=affiliate-->
<!--" id="top2363" target="_blank" title="自动化测试工程师"><IMG src="/nav/images/top4.png"></A> &ndash;&gt;-->
      		<!--<A href="http://mooc.study.163.com/smartSpec/detail/51001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate-->
<!--" id="top2364" target="_blank" title="移动应用测试工程师"><IMG src="/nav/images/top5.png"></A>-->


      		<!--</div>-->
      		<!--<div class="pic-list_0810">-->
      			<!--<div id="ul_recom">-->
                    <!--&lt;!&ndash;<A title="床上大号电脑桌36元包邮" target="_blank" href="http://s.click.taobao.com/r2lgLYx" blockid="top2365"><IMG src="/nav/images/computerDesks.png"><SPAN><STRONG>IT项目经理</STRONG></SPAN><SPAN>IT互联网经理人培训机构光环国际</SPAN></A>&ndash;&gt;-->
      			  <!--&lt;!&ndash; <A class="currA" title="自由职业摄影师" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/28001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2360"><IMG  src="/nav/images/top1s.png"><SPAN><STRONG>自由职业摄影师</STRONG></SPAN><SPAN>国际摄影爱好者协会主席，咔图摄影教育中心</SPAN></A> &ndash;&gt;-->
      			  <!--<A class="currA" title="前端工程师微专业" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/12001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2359"><IMG  src="/nav/images/webfronts.png"><SPAN><STRONG>前端工程师微专业</STRONG></SPAN><SPAN>网易一线资深前端开发工程师倾情打造！</SPAN></A>-->
      			  <!--<A title="《产品经理》微专业" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/85003.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2366"><IMG src="/nav/images/pms.jpg"><SPAN><STRONG>《产品经理》微专业</STRONG></SPAN><SPAN>网易云音乐、LOFTER、考拉海购、易信、邮箱等亿级产品的产品负责人亲授，只为打造国内顶尖产品经理课程。带你掌握从需求挖掘、产品设计到数据分析、产品运营的全部技能，帮你成为一个合格产品人</SPAN></A>-->
                  <!--<A title="《JavaWeb开发工程师》微专业" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/85002.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2367"><IMG src="/nav/images/javas.jpg"><SPAN><STRONG>《JavaWeb开发工程师》微专业</STRONG></SPAN><SPAN>聚焦JavaWeb开发工程师必知必会的知识技能。既有系统的知识体系保证学生吸收，又有大量网易内部案例和实践，保证学生无缝对接企业需求。优秀学生还可获得工作推荐。</SPAN></A>-->
      			  <!--<A title="MySQL数据库管理工程师" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/20001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2361"><IMG  src="/nav/images/top2s.png"><SPAN><STRONG>MySQL数据库管理工程师</STRONG></SPAN><SPAN>网易一线DBA团队打造</SPAN></A>-->
      			  <!--<A title="大数据工程师" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/16001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2362"><IMG src="/nav/images/top3s.png"><SPAN><STRONG>大数据工程师</STRONG></SPAN><SPAN>国际学术出版商Wiley开发</SPAN></A>-->
      			<!--&lt;!&ndash;  <A title="自动化测试工程师" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/50002.htm?utm_source=caohuanhuan&utm_medium=cps&utm_campaign=affiliate" blockid="top2363"><IMG src="/nav/images/top4s.png"><SPAN><STRONG>自动化测试工程师</STRONG></SPAN><SPAN>网易杭州研究院Web自动化测试</SPAN></A> &ndash;&gt;-->
      			   <!--<A title="移动应用测试工程师" target="_blank" href="http://mooc.study.163.com/smartSpec/detail/51001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate" blockid="top2364"><IMG src="/nav/images/top5s.png"><SPAN><STRONG>移动应用测试工程师</STRONG></SPAN><SPAN>支付宝资深测试工程师</SPAN></A>-->


      			<!--</div>-->
      	   <!--</div>-->

      	<!--</div>-->
      <!--</div>-->

      <h1> 前端技术导航 </h1>
      <p>
        <span>前端类：</span>
        <a href="http://fex.baidu.com/" target="_blank">百度FEX</a>
        <a href="http://isux.tencent.com/" target="_blank">腾讯ISUX</a>
        <a href="http://www.w3cplus.com/" target="_blank">W3CPlus</a>
        <a href="http://www.imooc.com/course/list" target="_blank">幕课网</a>
        <a href="http://tympanus.net/codrops/" target="_blank">Codrops</a>
        <a href="http://www.ruanyifeng.com/home.html" target="_blank">阮一峰</a>
        <a href="http://codepen.io/" target="_blank">CodePen</a>
        <a href="https://segmentfault.com/" target="_blank">segmentfault</a>
      </p>
      <p>
        <span>工具类：</span>
        <a href="http://fontello.com/" target="_blank">fontello</a>
        <a href="http://lab.hakim.se/reveal-js/#/" target="_blank">REVEAL</a>
        <a href="https://www.shiyanlou.com/courses/" target="_blank">实验楼</a>
        <a href="http://fortawesome.github.io/Font-Awesome/" target="_blank">Awesome</a>
        <a href="https://kuler.adobe.com/" target="_blank">配色工具</a>
        <a href="https://monaca.io/" target="_blank">monaca</a>
        <a href="http://caniuse.com/" target="_blank">CanIUse</a>
        <a href="http://browsershots.org/" target="_blank">浏览器快照</a>
      </p>
      <p>
         <span>资讯类：</span>
        <a href="http://www.36kr.com/" target="_blank">36氪</a>
        <a href="http://cn.engadget.com/" target="_blank">瘾科技</a>
        <a href="http://www.huxiu.com/" target="_blank">虎嗅网</a>
        <a href="http://www.ikanchai.com/" target="_blank">砍柴网</a>
        <a href="http://www.cnbeta.com/" target="_blank">cnBeta</a>
      </p>
      <p>
         <span>常用API：</span>
        <a href="http://www.ionicframework.com/" target="_blank">Ionic</a>
        <a href="http://cordova.apache.org/docs/en/5.0.0/" target="_blank">Cordova</a>
        <a href="http://docs.phonegap.com/en/edge/index.html" target="_blank">PhoneGap</a>
        <a href="http://ngcordova.com/" target="_blank">Ng-Cordova</a>
        <a href="http://docs.strongloop.com/display/public/LB/LoopBack" target="_blank">Loopback</a>
        <a href="http://docs.angularjs.cn/api" target="_blank">Angular</a>
        <a href="http://nej.netease.com/" target="_blank">NEJ</a>
        <a href="http://regularjs.github.io/" target="_blank">Regular</a>
      </p>

  </div>
  <div class="sidebar-top">
    <span>前端工程师学习交流群：345413787</span>
    <br><span>1. <a href="http://www.haomou.net/2014/10/06/2014_ionic_learn/" target="_blank">Ionic系列教程【年薪15w】</a></span>
    <br><span>2. <a href="http://www.haomou.net/2015/11/05/2015_svg_learn/" target="_blank">SVG系列教程【年薪10w】</a></span>
    <br><span>3. <a href="http://www.haomou.net/2015/08/30/2015_threejs0/" target="_blank">WebGL系列教程【年薪20w】</a></span>
    <br><span>4. <a href="http://www.haomou.net/2015/02/06/2015_loopback_learn/" target="_blank">LoopBack系列教程【年薪15w】</a></span>
    <br><span>5. <a href="http://www.haomou.net/2015/12/09/2015_web_learn/" target="_blank">前端工程师修炼教程【年薪20w】</a></span>
    <br><span>6. <a href="http://www.haomou.net/2016/03/31/2016_java_learn/" target="_blank">JAVA工程师系列教程【年薪20w】</a></span>
    <!-- <br><span >那一刻创业项目：<a href="http://m.pictcake.cn/"  target="_blank">求点赞（m.pictcake.cn）</a></span>
    <br><span >基础知识学习：<a href="http://www.icourse163.org/"  target="_blank">推荐中国大学MOOC</a></span> -->
    <br><span><a href="http://www.gamelofter.com/" target="_blank">出售域名(&nbsp; gamelofter.com &nbsp;)</a>，需要的联系我</span>
    <br><span>想到网易实习(或正职工作)吗，扫码加入网易校招实习或正职内推QQ群:478483951,不定期更新内推招聘岗位！</span>
    <div style="text-align:center;margin-top:10px;"><img width="150" height="200" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/qrcode1.jpg" data-bd-imgshare-binded="1"></div>
      <!-- <div style="text-align:center;margin-top:10px;"><a href="http://t.kaola.com/ZrIb2e" target="_blank"><img width="100%" height="100%" src="/images/kaola.jpg"/></a></div>-->
  </div>
  
    
<nav id="article-nav">
  
    <a href="http://www.haomou.net/2014/09/16/2014_jquery_defered/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <p class="article-nav-title">
        
          jquery笔记deferred
        
      </p>
      <i class="icon" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="http://www.haomou.net/2014/09/09/2014_nodejs_buffer/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <p class="article-nav-title">NodeJS的buffer使用总结</p>
      <i class="icon" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
      
  <div class="widget-wrap">
    <h3 class="widget-title">recents</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="http://www.haomou.net/2016/05/11/2016_05_11_read/" class="thumbnail">
  
    <span style="background-image:url(/images/read.jpg
)" alt="2016-05-11前端早读" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></p>
              <p class="item-title"><a href="http://www.haomou.net/2016/05/11/2016_05_11_read/" class="title">2016-05-11前端早读</a></p>
              <p class="item-date"><time datetime="2016-05-11T03:10:10.000Z" itemprop="datePublished">2016-05-11</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="http://www.haomou.net/2016/05/10/2016_05_10_read/" class="thumbnail">
  
    <span style="background-image:url(/images/read.jpg
)" alt="2016-05-10前端早读" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></p>
              <p class="item-title"><a href="http://www.haomou.net/2016/05/10/2016_05_10_read/" class="title">2016-05-10前端早读</a></p>
              <p class="item-date"><time datetime="2016-05-10T02:10:10.000Z" itemprop="datePublished">2016-05-10</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="http://www.haomou.net/2016/05/09/2016_05_09_read/" class="thumbnail">
  
    <span style="background-image:url(/images/read.jpg
)" alt="2016-05-09前端早读" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></p>
              <p class="item-title"><a href="http://www.haomou.net/2016/05/09/2016_05_09_read/" class="title">2016-05-09前端早读</a></p>
              <p class="item-date"><time datetime="2016-05-09T02:10:10.000Z" itemprop="datePublished">2016-05-09</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="http://www.haomou.net/2016/04/26/2016_test_summery/" class="thumbnail">
  
    <span style="background-image:url(/images/test.gif
)" alt="测试培训学习总结" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></p>
              <p class="item-title"><a href="http://www.haomou.net/2016/04/26/2016_test_summery/" class="title">测试培训学习总结</a></p>
              <p class="item-date"><time datetime="2016-04-26T12:03:10.000Z" itemprop="datePublished">2016-04-26</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="http://www.haomou.net/2016/04/20/2016_04_20_read/" class="thumbnail">
  
    <span style="background-image:url(/images/read.jpg
)" alt="2016-04-20前端早读" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a></p>
              <p class="item-title"><a href="http://www.haomou.net/2016/04/20/2016_04_20_read/" class="title">2016-04-20前端早读</a></p>
              <p class="item-date"><time datetime="2016-04-20T02:10:10.000Z" itemprop="datePublished">2016-04-20</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/Angular-React/">Angular|React</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/HTML5-CSS3/">HTML5|CSS3</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/JAVA/">JAVA</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/JavaScript-NodeJs/">JavaScript|NodeJs</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/WebGL-ThreeJs/">WebGL|ThreeJs</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/ionic-reapp/">ionic|reapp</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/loopback-%E6%9C%8D%E5%8A%A1%E7%AB%AF/">loopback|服务端</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="http://www.haomou.net/categories/%E5%89%8D%E7%AB%AF%E6%97%A9%E8%AF%BB/">前端早读</a><span class="category-list-count">57</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2016/05/">May 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2016/04/">April 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2016/03/">March 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2016/01/">January 2016</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/12/">December 2015</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/11/">November 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/10/">October 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/09/">September 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/07/">July 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/06/">June 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/05/">May 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/03/">March 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/02/">February 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2015/01/">January 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2014/10/">October 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2014/09/">September 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2014/08/">August 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://www.haomou.net/archives/2014/07/">July 2014</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-float">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget tagcloud">
      <a href="http://www.haomou.net/tags/API/" style="font-size: 10px;">API</a> <a href="http://www.haomou.net/tags/Android/" style="font-size: 10px;">Android</a> <a href="http://www.haomou.net/tags/AngularJS/" style="font-size: 14.55px;">AngularJS</a> <a href="http://www.haomou.net/tags/Babel/" style="font-size: 10px;">Babel</a> <a href="http://www.haomou.net/tags/Grunt/" style="font-size: 10px;">Grunt</a> <a href="http://www.haomou.net/tags/Gulp/" style="font-size: 10.91px;">Gulp</a> <a href="http://www.haomou.net/tags/HTML5/" style="font-size: 10.91px;">HTML5</a> <a href="http://www.haomou.net/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="http://www.haomou.net/tags/HTTPS/" style="font-size: 10.91px;">HTTPS</a> <a href="http://www.haomou.net/tags/JAVA/" style="font-size: 10.91px;">JAVA</a> <a href="http://www.haomou.net/tags/JavaScript/" style="font-size: 16.36px;">JavaScript</a> <a href="http://www.haomou.net/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="http://www.haomou.net/tags/NodeJS/" style="font-size: 15.45px;">NodeJS</a> <a href="http://www.haomou.net/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="http://www.haomou.net/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="http://www.haomou.net/tags/WebGL/" style="font-size: 13.64px;">WebGL</a> <a href="http://www.haomou.net/tags/Webpack/" style="font-size: 10.91px;">Webpack</a> <a href="http://www.haomou.net/tags/android/" style="font-size: 13.64px;">android</a> <a href="http://www.haomou.net/tags/bearer/" style="font-size: 10px;">bearer</a> <a href="http://www.haomou.net/tags/buffer/" style="font-size: 10px;">buffer</a> <a href="http://www.haomou.net/tags/bug/" style="font-size: 10px;">bug</a> <a href="http://www.haomou.net/tags/canvas/" style="font-size: 10.91px;">canvas</a> <a href="http://www.haomou.net/tags/centos/" style="font-size: 11.82px;">centos</a> <a href="http://www.haomou.net/tags/css/" style="font-size: 12.73px;">css</a> <a href="http://www.haomou.net/tags/fabric/" style="font-size: 10px;">fabric</a> <a href="http://www.haomou.net/tags/git/" style="font-size: 11.82px;">git</a> <a href="http://www.haomou.net/tags/html/" style="font-size: 10px;">html</a> <a href="http://www.haomou.net/tags/hybridApp/" style="font-size: 10px;">hybridApp</a> <a href="http://www.haomou.net/tags/iframe/" style="font-size: 10px;">iframe</a> <a href="http://www.haomou.net/tags/ionic/" style="font-size: 18.18px;">ionic</a> <a href="http://www.haomou.net/tags/jQuery/" style="font-size: 11.82px;">jQuery</a> <a href="http://www.haomou.net/tags/loopback/" style="font-size: 17.27px;">loopback</a> <a href="http://www.haomou.net/tags/mongoDB/" style="font-size: 11.82px;">mongoDB</a> <a href="http://www.haomou.net/tags/phonegap/" style="font-size: 10.91px;">phonegap</a> <a href="http://www.haomou.net/tags/reapp/" style="font-size: 10px;">reapp</a> <a href="http://www.haomou.net/tags/scss/" style="font-size: 10px;">scss</a> <a href="http://www.haomou.net/tags/session/" style="font-size: 10px;">session</a> <a href="http://www.haomou.net/tags/storage/" style="font-size: 10px;">storage</a> <a href="http://www.haomou.net/tags/svg/" style="font-size: 13.64px;">svg</a> <a href="http://www.haomou.net/tags/token/" style="font-size: 10.91px;">token</a> <a href="http://www.haomou.net/tags/ubuntu/" style="font-size: 10.91px;">ubuntu</a> <a href="http://www.haomou.net/tags/weinre/" style="font-size: 10px;">weinre</a> <a href="http://www.haomou.net/tags/%E4%BC%AA%E7%B1%BB/" style="font-size: 10px;">伪类</a> <a href="http://www.haomou.net/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/" style="font-size: 10px;">兼容性</a> <a href="http://www.haomou.net/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="http://www.haomou.net/tags/%E5%8A%A0%E5%AF%86/" style="font-size: 10.91px;">加密</a> <a href="http://www.haomou.net/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 10px;">原型链</a> <a href="http://www.haomou.net/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 10.91px;">图像处理</a> <a href="http://www.haomou.net/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 10px;">域名</a> <a href="http://www.haomou.net/tags/%E5%AE%89%E5%85%A8/" style="font-size: 11.82px;">安全</a> <a href="http://www.haomou.net/tags/%E5%BF%83%E6%83%85/" style="font-size: 10px;">心情</a> <a href="http://www.haomou.net/tags/%E6%80%9D%E8%80%83/" style="font-size: 10px;">思考</a> <a href="http://www.haomou.net/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/" style="font-size: 10px;">敏捷开发</a> <a href="http://www.haomou.net/tags/%E6%95%99%E7%A8%8B/" style="font-size: 19.09px;">教程</a> <a href="http://www.haomou.net/tags/%E6%95%B0%E5%AD%A6%E7%90%86%E8%AE%BA/" style="font-size: 10px;">数学理论</a> <a href="http://www.haomou.net/tags/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/" style="font-size: 10px;">模板引擎</a> <a href="http://www.haomou.net/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a> <a href="http://www.haomou.net/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="http://www.haomou.net/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 16.36px;">笔记</a> <a href="http://www.haomou.net/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="http://www.haomou.net/tags/%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">网页</a> <a href="http://www.haomou.net/tags/%E8%B7%A8%E5%9F%9F/" style="font-size: 10px;">跨域</a> <a href="http://www.haomou.net/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">运维</a> <a href="http://www.haomou.net/tags/%E9%97%AD%E5%8C%85/" style="font-size: 10px;">闭包</a> <a href="http://www.haomou.net/tags/%E9%97%AE%E9%A2%98/" style="font-size: 10.91px;">问题</a> <a href="http://www.haomou.net/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/" style="font-size: 10px;">黑苹果</a>
    </div>
  </div>


    
      
  <div id="haomou_ad" class="widget-wrap widget-list">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/12001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">前端工程师微专业【年薪20w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/85002.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">《JavaWeb开发工程师》【年薪20w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/16001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">大数据工程师【年薪15w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/50002.htm?utm_source=caohuanhuan&utm_medium=cps&utm_campaign=affiliate">自动化测试工程师【年薪15w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/51001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">移动应用测试工程师【年薪15w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/85003.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">《产品经理》微专业【年薪25w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/55001.htm?utm_source=caohuanhuan&utm_medium=cps&utm_campaign=affiliate">IT项目经理【年薪15w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/28001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">自由职业摄影师【年薪15w】</a>
          </li>
        
          <li>
            <a target="_blank" href="http://mooc.study.163.com/smartSpec/detail/20001.htm?utm_source=676375&utm_medium=cps&utm_campaign=affiliate">MySQL数据库管理工程师【年薪15w】</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  </div>
<dl id="outline" style="position: relative; margin-top: 20px;"><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#指令用处" class="nslog:1026" title="指令用处" onclick="return false;" style="color: rgb(103, 169, 210);">指令用处</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">0</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AngularJS" class="nslog:1026" title="AngularJS" onclick="return false;" style="color: rgb(103, 169, 210);">AngularJS</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">1</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#一个例子" class="nslog:1026" title="一个例子" onclick="return false;" style="color: rgb(103, 169, 210);">一个例子</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">2</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#依赖注入" class="nslog:1026" title="依赖注入" onclick="return false;" style="color: rgb(103, 169, 210);">依赖注入</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">3</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#作用域" class="nslog:1026" title="作用域" onclick="return false;" style="color: rgb(103, 169, 210);">作用域</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">4</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#数据绑定与模板" class="nslog:1026" title="数据绑定与模板" onclick="return false;" style="color: rgb(103, 169, 210);">数据绑定与模板</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">5</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模版数据模板综合" class="nslog:1026" title="模版数据模板综合" onclick="return false;" style="color: rgb(103, 169, 210);">模版数据模板综合</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">6</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板" class="nslog:1026" title="模板" onclick="return false;" style="color: rgb(103, 169, 210);">模板</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">7</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#节点控制" class="nslog:1026" title="节点控制" onclick="return false;" style="color: rgb(103, 169, 210);">节点控制</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">8</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#事件绑定" class="nslog:1026" title="事件绑定" onclick="return false;" style="color: rgb(103, 169, 210);">事件绑定</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">9</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#表单控件" class="nslog:1026" title="表单控件" onclick="return false;" style="color: rgb(103, 169, 210);">表单控件</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">10</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#模板中的过滤器" class="nslog:1026" title="模板中的过滤器" onclick="return false;" style="color: rgb(103, 169, 210);">模板中的过滤器</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">11</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#锚点路由" class="nslog:1026" title="锚点路由" onclick="return false;" style="color: rgb(103, 169, 210);">锚点路由</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">12</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#定义模板变量标识标签" class="nslog:1026" title="定义模板变量标识标签" onclick="return false;" style="color: rgb(103, 169, 210);">定义模板变量标识标签</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">13</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AJAX" class="nslog:1026" title="AJAX" onclick="return false;" style="color: rgb(103, 169, 210);">AJAX</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">14</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#工具函数" class="nslog:1026" title="工具函数" onclick="return false;" style="color: rgb(103, 169, 210);">工具函数</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">15</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#其它服务" class="nslog:1026" title="其它服务" onclick="return false;" style="color: rgb(103, 169, 210);">其它服务</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">16</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义模块和服务" class="nslog:1026" title="自定义模块和服务" onclick="return false;" style="color: rgb(103, 169, 210);">自定义模块和服务</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">17</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#附加模块-ngResource" class="nslog:1026" title="附加模块-ngResource" onclick="return false;" style="color: rgb(103, 169, 210);">附加模块-ngResource</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">18</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#AngularJS与其它框架的混用" class="nslog:1026" title="AngularJS与其它框架的混用" onclick="return false;" style="color: rgb(103, 169, 210);">AngularJS与其它框架的混用</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">19</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义过滤器" class="nslog:1026" title="自定义过滤器" onclick="return false;" style="color: rgb(103, 169, 210);">自定义过滤器</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">20</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#自定义指令directive" class="nslog:1026" title="自定义指令directive" onclick="return false;" style="color: rgb(103, 169, 210);">自定义指令directive</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">21</span></dd><dd class="sideCatalog-item2" id="sideToolbar-item--1_3"><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#谢谢！" class="nslog:1026" title="谢谢！" onclick="return false;" style="color: rgb(103, 169, 210);">谢谢！</a><span class="sideCatalog-dot"></span><span class="sideCatalog-index2">22</span></dd></dl></aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon" id="icon-angle-up"></i></a>
      <div class="credit">
        <h1 class="logo-wrap">
          <!-- <a href="/" class="logo"></a> -->
          <a href="http://www.fed123.com/"><img alt="fed前端" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/logo.png" width="121px" height="75px" style="display: block;" data-bd-imgshare-binded="1"></a>
        </h1>
        <p>© 2016 网易高级前端工程师</p>
        <p>苏ICP备13018740号-6
        <!-- <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5849006'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/stat.php%3Fid%3D5849006%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script> -->
        </p>
      </div>
      <div class="foot-nav">
        <img alt="FED前端开发" src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/hm.jpg" width="100" height="120" style="border-radius: 5px;margin-top: 5px;margin-right: 5px;float:left;" data-bd-imgshare-binded="1">
          <div style="color: #428bca;text-align: center;font-size: 18px;padding:5px;">曹欢欢(chale)</div>中国科学技术大学硕士研究生，网易高级前端工程师，5年前端工作经验，刻苦专研，自学成才。FED123.com是前端开发（Front End Developer）工程师学习交流的家园，分享精彩的前端早读，前端后端开发相关的知识点，大家共同学习进步！
      </div>


    </div>
  </div>
</footer>
    


  <script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/jquery-2.1.3.min.js"></script>



  <script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/jquery.fancybox.pack.js"></script>



  <script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/jquery.scrollLoading.js"></script>
  <script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/main.js"></script>


<script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/html-patch.js"></script>
<script src="./AngularJS笔记-详细使用 _ 皓眸大前端-前端开发学习交流圈子_files/script.js"></script>

  </div>


<iframe frameborder="0" id="bdSharePopup_selectshare1463015117580bg" class="bdselect_share_bg" style="display:none;"></iframe><div id="bdSharePopup_selectshare1463015117580box" style="display:none;" share-type="selectshare" class="bdselect_share_box" data-bd-bind="1463015117579"><div class="selectshare-mod-triangle"><div class="triangle-border"></div><div class="triangle-inset"></div></div><div class="bdselect_share_head"><span>分享到</span><a href="http://www.baidu.com/s?wd=&tn=SE_hldp08010_vurs2xrp" class="bdselect_share_dialog_search" target="_blank"><i class="bdselect_share_dialog_search_i"></i><span class="bdselect_share_dialog_search_span">百度一下</span></a><a class="bdselect_share_dialog_close"></a></div><div class="bdselect_share_content"><ul class="bdselect_share_list bdshare-button-style0-32"><div class="bdselect_share_partners"></div><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" class="bds_more" data-cmd="more"></a></ul></div></div><div id="bdimgshare_1463015117586" class="sr-bdimgshare sr-bdimgshare-list sr-bdimgshare-24 sr-bdimgshare-black" style="height:42px;line-height:32px;font-size:14px;width:autopx;display:none;" data-bd-bind="1463015117585"><div class="bdimgshare-bg"></div><div class="bdimgshare-content bdsharebuttonbox bdshare-button-style0-24"><label class="bdimgshare-lbl">分享到：</label><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_qzone" data-cmd="qzone" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_tsina" data-cmd="tsina" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_tqq" data-cmd="tqq" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_renren" data-cmd="renren" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_weixin" data-cmd="weixin" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_sqq" data-cmd="sqq" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_youdao" data-cmd="youdao" hidefocus=""></a><a href="http://www.haomou.net/2014/09/12/2014_angularjs_2/#" onclick="return false;" class="bds_more" data-cmd="more" hidefocus=""></a></div></div></body></html>