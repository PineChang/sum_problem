<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0046)http://www.cnblogs.com/xdp-gacl/p/4007225.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园</title>
<link type="text/css" rel="stylesheet" href="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/bundle-SimpleClear.css">
<link type="text/css" rel="stylesheet" href="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/133816.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/xdp-gacl/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/xdp-gacl/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/xdp-gacl/wlwmanifest.xml">
<script type="text/javascript" src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/encoder.js"></script><script src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'xdp-gacl', cb_enable_mathjax=false;</script>
<script src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/blog-common.js" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>
<div id="page_begin_html"><!-- Baidu Button BEGIN -->
<!--<div style="display: none" id="__document_write_ajax_div-1"></div><script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=0&amp;pos=right&amp;uid=6507240" >window['__document_write_ajax_callbacks__']['1']();</script>
<div style="display: none" id="__document_write_ajax_div-2"></div><script type="text/javascript" id="bdshell_js">window['__document_write_ajax_callbacks__']['2']();</script>
<div style="display: none" id="__document_write_ajax_div-3"></div><script type="text/javascript">window['__document_write_ajax_callbacks__']['3']();</script>-->
<!-- Baidu Button END -->

<!--添加博客目录-->


<!--
<head>

DIY 博客全文界面的推荐、反对、加关注、返回顶部、快速评论等小功能的集成

<div style="display: none" id="__document_write_ajax_div-5"></div><script type="text/javascript">window['__document_write_ajax_callbacks__']['5']();</script>
</head>
--></div><script>load_page_begin_html();</script>

<div id="main">
<div id="header">
<h1><a id="Header1_HeaderTitle" href="http://www.cnblogs.com/xdp-gacl/">孤傲苍狼</a></h1>
<p id="tagline">只为成功找方法，不为失败找借口！</p></div>

<div id="post_detail">
<div class="post">
    <h2 class="postTitle"><a id="cb_post_title_url" href="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园.html">javaweb学习总结(四十一)——Apache的DBUtils框架学习</a></h2>
    <div class="postText"><div id="cnblogs_post_body"><h2 id="blogTitle0">一、commons-dbutils简介　</h2>
<p>　　commons-dbutils 是 Apache 组织提供的一个开源 JDBC工具类库，它是对JDBC的简单封装，学习成本极低，并且使用dbutils能极大简化jdbc编码的工作量，同时也不会影响程序的性能。因此dbutils成为很多不喜欢hibernate的公司的首选。</p>
<p>　　commons-dbutilsAPI介绍：</p>
<ul>
<li>org.apache.commons.dbutils.QueryRunner</li>
<li>org.apache.commons.dbutils.ResultSetHandler</li>
</ul>
<p>　　工具类</p>
<ul>
<li>org.apache.commons.dbutils.DbUtils</li>
</ul>
<h2 id="blogTitle1">二、QueryRunner类使用讲解</h2>
<p>　　该类简单化了SQL查询，它与ResultSetHandler组合在一起使用可以完成大部分的数据库操作，能够大大减少编码量。<br>　　QueryRunner类提供了两个构造方法：</p>
<ul>
<li>默认的构造方法</li>
<li>需要一个 javax.sql.DataSource 来作参数的构造方法。</li>








</ul>
<h3 id="blogTitle2">2.1、QueryRunner类的主要方法</h3>
<p>　　public Object query(Connection conn, String sql, Object[] params, ResultSetHandler rsh) throws SQLException：执行一个查询操作，在这个查询中，对象数组中的每个元素值被用来作为查询语句的置换参数。该方法会自行处理 PreparedStatement 和 ResultSet 的创建和关闭。<br>　　public Object query(String sql, Object[] params, ResultSetHandler rsh) throws SQLException:　几乎与第一种方法一样；唯一的不同在于它不将数据库连接提供给方法，并且它是从提供给构造方法的数据源(DataSource) 或使用的setDataSource 方法中重新获得 Connection。<br>　　public Object query(Connection conn, String sql, ResultSetHandler rsh) throws SQLException : 执行一个不需要置换参数的查询操作。<br>　　public int update(Connection conn, String sql, Object[] params) throws SQLException:用来执行一个更新（插入、更新或删除）操作。<br>　　public int update(Connection conn, String sql) throws SQLException：用来执行一个不需要置换参数的更新操作。</p>
<h3 id="blogTitle3">2.2、使用QueryRunner类实现CRUD</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.test;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Date;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.File;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.FileReader;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.sql.rowset.serial.SerialClob;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.User;
</span><span style="color: #008080;"> 11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.QueryRunner;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.BeanHandler;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.BeanListHandler;
</span><span style="color: #008080;"> 15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.junit.Test;
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 18</span> <span style="color: #008000;">* @ClassName: DBUtilsCRUDTest
</span><span style="color: #008080;"> 19</span> <span style="color: #008000;">* @Description:使用dbutils框架的QueryRunner类完成CRUD,以及批处理
</span><span style="color: #008080;"> 20</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;"> 21</span> <span style="color: #008000;">* @date: 2014-10-5 下午4:56:44
</span><span style="color: #008080;"> 22</span> <span style="color: #008000;">*
</span><span style="color: #008080;"> 23</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 24</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> QueryRunnerCRUDTest {
</span><span style="color: #008080;"> 25</span> 
<span style="color: #008080;"> 26</span>     <span style="color: #008000;">/*</span>
<span style="color: #008080;"> 27</span> <span style="color: #008000;">     *测试表
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;">     create table users(
</span><span style="color: #008080;"> 29</span> <span style="color: #008000;">         id int primary key auto_increment, 
</span><span style="color: #008080;"> 30</span> <span style="color: #008000;">         name varchar(40),
</span><span style="color: #008080;"> 31</span> <span style="color: #008000;">         password varchar(40), 
</span><span style="color: #008080;"> 32</span> <span style="color: #008000;">         email varchar(60), 
</span><span style="color: #008080;"> 33</span> <span style="color: #008000;">         birthday date 
</span><span style="color: #008080;"> 34</span> <span style="color: #008000;">     );
</span><span style="color: #008080;"> 35</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 36</span>     
<span style="color: #008080;"> 37</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 38</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> add() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 39</span>         <span style="color: #008000;">//</span><span style="color: #008000;">将数据源传递给QueryRunner，QueryRunner内部通过数据源获取数据库连接</span>
<span style="color: #008080;"> 40</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 41</span>         String sql = "insert into users(name,password,email,birthday) values(?,?,?,?)"<span style="color: #000000;">;
</span><span style="color: #008080;"> 42</span>         Object params[] = {"孤傲苍狼","123", "gacl@sina.com", <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date()};
</span><span style="color: #008080;"> 43</span>         <span style="color: #008000;">//</span><span style="color: #008000;">Object params[] = {"白虎神皇","123", "gacl@sina.com", "1988-05-07"};</span>
<span style="color: #008080;"> 44</span> <span style="color: #000000;">        qr.update(sql, params);
</span><span style="color: #008080;"> 45</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 46</span>     
<span style="color: #008080;"> 47</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 48</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> delete() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 51</span>         String sql = "delete from users where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;"> 52</span>         qr.update(sql, 1<span style="color: #000000;">);
</span><span style="color: #008080;"> 53</span> 
<span style="color: #008080;"> 54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 55</span> 
<span style="color: #008080;"> 56</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 57</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> update() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 58</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 59</span>         String sql = "update users set name=? where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;"> 60</span>         Object params[] = { "ddd", 5<span style="color: #000000;">};
</span><span style="color: #008080;"> 61</span> <span style="color: #000000;">        qr.update(sql, params);
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 63</span> 
<span style="color: #008080;"> 64</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 65</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> find() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 66</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 67</span>         String sql = "select * from users where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;"> 68</span>         Object params[] = {2<span style="color: #000000;">};
</span><span style="color: #008080;"> 69</span>         User user = (User) qr.query(sql, params, <span style="color: #0000ff;">new</span> BeanHandler(User.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">        System.out.println(user.getBirthday());
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 72</span> 
<span style="color: #008080;"> 73</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 74</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> getAll() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 75</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 76</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 77</span>         List list = (List) qr.query(sql, <span style="color: #0000ff;">new</span> BeanListHandler(User.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">        System.out.println(list.size());
</span><span style="color: #008080;"> 79</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 80</span> 
<span style="color: #008080;"> 81</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 82</span> <span style="color: #008000;">    * @Method: testBatch
</span><span style="color: #008080;"> 83</span> <span style="color: #008000;">    * @Description:批处理
</span><span style="color: #008080;"> 84</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;"> 85</span> <span style="color: #008000;">    *
</span><span style="color: #008080;"> 86</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;"> 87</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 88</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 89</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testBatch() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;"> 90</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 91</span>         String sql = "insert into users(name,password,email,birthday) values(?,?,?,?)"<span style="color: #000000;">;
</span><span style="color: #008080;"> 92</span>         Object params[][] = <span style="color: #0000ff;">new</span> Object[10<span style="color: #000000;">][];
</span><span style="color: #008080;"> 93</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; 10; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 94</span>             params[i] = <span style="color: #0000ff;">new</span> Object[] { "aa" + i, "123", "aa@sina.com"<span style="color: #000000;">,
</span><span style="color: #008080;"> 95</span>                     <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date() };
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">        qr.batch(sql, params);
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 99</span>     
<span style="color: #008080;">100</span>     <span style="color: #008000;">//</span><span style="color: #008000;">用dbutils完成大数据（不建议用）</span>
<span style="color: #008080;">101</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">*************************************************************************
</span><span style="color: #008080;">102</span> <span style="color: #008000;">     create table testclob
</span><span style="color: #008080;">103</span> <span style="color: #008000;">     (
</span><span style="color: #008080;">104</span> <span style="color: #008000;">         id int primary key auto_increment,
</span><span style="color: #008080;">105</span> <span style="color: #008000;">         resume text
</span><span style="color: #008080;">106</span> <span style="color: #008000;">     );
</span><span style="color: #008080;">107</span> <span style="color: #008000;">     *************************************************************************</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">108</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;">109</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testclob() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException, IOException{
</span><span style="color: #008080;">110</span>         QueryRunner runner = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;">111</span>         String sql = "insert into testclob(resume) values(?)";  <span style="color: #008000;">//</span><span style="color: #008000;">clob
</span><span style="color: #008080;">112</span>         <span style="color: #008000;">//</span><span style="color: #008000;">这种方式获取的路径，其中的空格会被使用“%20”代替</span>
<span style="color: #008080;">113</span>         String path  = QueryRunnerCRUDTest.<span style="color: #0000ff;">class</span>.getClassLoader().getResource("data.txt"<span style="color: #000000;">).getPath();
</span><span style="color: #008080;">114</span>         <span style="color: #008000;">//</span><span style="color: #008000;">将“%20”替换回空格</span>
<span style="color: #008080;">115</span>         path = path.replaceAll("%20", " "<span style="color: #000000;">);
</span><span style="color: #008080;">116</span>         FileReader in = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileReader(path);
</span><span style="color: #008080;">117</span>         <span style="color: #0000ff;">char</span>[] buffer = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">char</span>[(<span style="color: #0000ff;">int</span>) <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(path).length()];
</span><span style="color: #008080;">118</span> <span style="color: #000000;">        in.read(buffer);
</span><span style="color: #008080;">119</span>         SerialClob clob = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SerialClob(buffer);
</span><span style="color: #008080;">120</span>         Object params[] =<span style="color: #000000;"> {clob};
</span><span style="color: #008080;">121</span> <span style="color: #000000;">        runner.update(sql, params);
</span><span style="color: #008080;">122</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">123</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h2 id="blogTitle4">三、ResultSetHandler接口使用讲解</h2>
<p>　　该接口用于处理java.sql.ResultSet，将数据按要求转换为另一种形式。<br>　　ResultSetHandler接口提供了一个单独的方法：Object handle (java.sql.ResultSet .rs)</p>
<h3 id="blogTitle5">3.1、ResultSetHandler接口的实现类</h3>
<ul>
<li>ArrayHandler：把结果集中的<span style="color: #ff0000;"><strong>第一行</strong></span>数据转成对象数组。</li>
<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</li>
<li>BeanHandler：将结果集中的<span style="color: #ff0000;"><strong>第一行</strong></span>数据封装到一个对应的JavaBean实例中。</li>
<li>BeanListHandler：将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。</li>
<li>ColumnListHandler：将结果集中某一列的数据存放到List中。</li>
<li>KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map里，再把这些map再存到一个map里，其key为指定的key。</li>
<li>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。</li>
<li>MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List</li>








</ul>
<h3 id="blogTitle6">3.2、测试dbutils各种类型的处理器</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.test;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Arrays;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.QueryRunner;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.ArrayHandler;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.ArrayListHandler;
</span><span style="color: #008080;"> 11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.ColumnListHandler;
</span><span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.KeyedHandler;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.MapHandler;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.MapListHandler;
</span><span style="color: #008080;"> 15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.ScalarHandler;
</span><span style="color: #008080;"> 16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.junit.Test;
</span><span style="color: #008080;"> 17</span> 
<span style="color: #008080;"> 18</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 19</span> <span style="color: #008000;">* @ClassName: ResultSetHandlerTest
</span><span style="color: #008080;"> 20</span> <span style="color: #008000;">* @Description:测试dbutils各种类型的处理器
</span><span style="color: #008080;"> 21</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;"> 22</span> <span style="color: #008000;">* @date: 2014-10-6 上午8:39:14
</span><span style="color: #008080;"> 23</span> <span style="color: #008000;">*
</span><span style="color: #008080;"> 24</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 25</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ResultSetHandlerTest {
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 28</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testArrayHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 29</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 30</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 31</span>         Object result[] = (Object[]) qr.query(sql, <span style="color: #0000ff;">new</span><span style="color: #000000;"> ArrayHandler());
</span><span style="color: #008080;"> 32</span>         System.out.println(Arrays.asList(result));  <span style="color: #008000;">//</span><span style="color: #008000;">list  toString()</span>
<span style="color: #008080;"> 33</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 34</span>     
<span style="color: #008080;"> 35</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 36</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testArrayListHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 37</span>         
<span style="color: #008080;"> 38</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 39</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 40</span>         List&lt;Object[]&gt; list = (List) qr.query(sql, <span style="color: #0000ff;">new</span><span style="color: #000000;"> ArrayListHandler());
</span><span style="color: #008080;"> 41</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;">(Object[] o : list){
</span><span style="color: #008080;"> 42</span> <span style="color: #000000;">            System.out.println(Arrays.asList(o));
</span><span style="color: #008080;"> 43</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 44</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 45</span>     
<span style="color: #008080;"> 46</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 47</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testColumnListHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 48</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 49</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 50</span>         List list = (List) qr.query(sql, <span style="color: #0000ff;">new</span> ColumnListHandler("id"<span style="color: #000000;">));
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">        System.out.println(list);
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 53</span>     
<span style="color: #008080;"> 54</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 55</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testKeyedHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception{
</span><span style="color: #008080;"> 56</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 57</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 58</span>         
<span style="color: #008080;"> 59</span>         Map&lt;Integer,Map&gt; map = (Map) qr.query(sql, <span style="color: #0000ff;">new</span> KeyedHandler("id"<span style="color: #000000;">));
</span><span style="color: #008080;"> 60</span>         <span style="color: #0000ff;">for</span>(Map.Entry&lt;Integer, Map&gt;<span style="color: #000000;"> me : map.entrySet()){
</span><span style="color: #008080;"> 61</span>             <span style="color: #0000ff;">int</span>  id =<span style="color: #000000;"> me.getKey();
</span><span style="color: #008080;"> 62</span>             Map&lt;String,Object&gt; innermap =<span style="color: #000000;"> me.getValue();
</span><span style="color: #008080;"> 63</span>             <span style="color: #0000ff;">for</span>(Map.Entry&lt;String, Object&gt;<span style="color: #000000;"> innerme : innermap.entrySet()){
</span><span style="color: #008080;"> 64</span>                 String columnName =<span style="color: #000000;"> innerme.getKey();
</span><span style="color: #008080;"> 65</span>                 Object value =<span style="color: #000000;"> innerme.getValue();
</span><span style="color: #008080;"> 66</span>                 System.out.println(columnName + "=" +<span style="color: #000000;"> value);
</span><span style="color: #008080;"> 67</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 68</span>             System.out.println("----------------"<span style="color: #000000;">);
</span><span style="color: #008080;"> 69</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 71</span>     
<span style="color: #008080;"> 72</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 73</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testMapHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 74</span>         
<span style="color: #008080;"> 75</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 76</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 77</span>         
<span style="color: #008080;"> 78</span>         Map&lt;String,Object&gt; map = (Map) qr.query(sql, <span style="color: #0000ff;">new</span><span style="color: #000000;"> MapHandler());
</span><span style="color: #008080;"> 79</span>         <span style="color: #0000ff;">for</span>(Map.Entry&lt;String, Object&gt;<span style="color: #000000;"> me : map.entrySet())
</span><span style="color: #008080;"> 80</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 81</span>             System.out.println(me.getKey() + "=" +<span style="color: #000000;"> me.getValue());
</span><span style="color: #008080;"> 82</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 83</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 84</span>     
<span style="color: #008080;"> 85</span>     
<span style="color: #008080;"> 86</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;"> 87</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testMapListHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 88</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;"> 89</span>         String sql = "select * from users"<span style="color: #000000;">;
</span><span style="color: #008080;"> 90</span>         List&lt;Map&gt; list = (List) qr.query(sql, <span style="color: #0000ff;">new</span><span style="color: #000000;"> MapListHandler());
</span><span style="color: #008080;"> 91</span>         <span style="color: #0000ff;">for</span>(Map&lt;String,Object&gt;<span style="color: #000000;"> map :list){
</span><span style="color: #008080;"> 92</span>             <span style="color: #0000ff;">for</span>(Map.Entry&lt;String, Object&gt;<span style="color: #000000;"> me : map.entrySet())
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">            {
</span><span style="color: #008080;"> 94</span>                 System.out.println(me.getKey() + "=" +<span style="color: #000000;"> me.getValue());
</span><span style="color: #008080;"> 95</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 98</span>     
<span style="color: #008080;"> 99</span> <span style="color: #000000;">    @Test
</span><span style="color: #008080;">100</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> testScalarHandler() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">101</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner(JdbcUtils.getDataSource());
</span><span style="color: #008080;">102</span>         String sql = "select count(*) from users";  <span style="color: #008000;">//</span><span style="color: #008000;">[13]  list[13]</span>
<span style="color: #008080;">103</span>         <span style="color: #0000ff;">int</span> count = ((Long)qr.query(sql, <span style="color: #0000ff;">new</span> ScalarHandler(1<span style="color: #000000;">))).intValue();
</span><span style="color: #008080;">104</span> <span style="color: #000000;">        System.out.println(count);
</span><span style="color: #008080;">105</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">106</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h2 id="blogTitle7">&nbsp;三、DbUtils类使用讲解</h2>
<p>　　DbUtils ：提供如关闭连接、装载JDBC驱动程序等常规工作的工具类，里面的所有方法都是静态的。主要方法如下：<br>　　public static void close(…) throws java.sql.SQLException：　DbUtils类提供了三个重载的关闭方法。这些方法检查所提供的参数是不是NULL，如果不是的话，它们就关闭Connection、Statement和ResultSet。<br>　　public static void closeQuietly(…): 这一类方法不仅能在Connection、Statement和ResultSet为NULL情况下避免关闭，还能隐藏一些在程序中抛出的SQLEeception。<br>　　public static void commitAndCloseQuietly(Connection conn)： 用来提交连接，然后关闭连接，并且在关闭连接时不抛出SQL异常。 <br>　　public static boolean loadDriver(java.lang.String driverClassName)：这一方装载并注册JDBC驱动程序，如果成功就返回true。使用该方法，你不需要捕捉这个异常ClassNotFoundException。</p>
<h2 id="blogTitle8">四、JDBC开发中的事务处理</h2>
<p>　　在开发中，对数据库的多个表或者对一个表中的多条数据执行更新操作时要保证对多个更新操作要么同时成功，要么都不成功，这就涉及到对多个更新操作的事务管理问题了。比如银行业务中的转账问题，A用户向B用户转账100元，假设A用户和B用户的钱都存储在Account表，那么A用户向B用户转账时就涉及到同时更新Account表中的A用户的钱和B用户的钱，用SQL来表示就是：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">update</span> account <span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #0000ff;">money</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">100</span> <span style="color: #0000ff;">where</span> name<span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">A</span><span style="color: #ff0000;">'</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">update</span> account <span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #0000ff;">money</span><span style="color: #808080;">+</span><span style="color: #800000; font-weight: bold;">100</span> <span style="color: #0000ff;">where</span> name<span style="color: #808080;">=</span><span style="color: #ff0000;">'</span><span style="color: #ff0000;">B</span><span style="color: #ff0000;">'</span></pre>
</div>
<h3 id="blogTitle9">4.1、在数据访问层(Dao)中处理事务</h3>
<p>　　对于这样的同时更新一个表中的多条数据的操作，那么必须保证要么同时成功，要么都不成功，所以需要保证这两个update操作在同一个事务中进行。在开发中，我们可能会在AccountDao写一个转账处理方法，如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 2</span> <span style="color: #008000;">    * @Method: transfer
</span><span style="color: #008080;"> 3</span> <span style="color: #008000;">    * @Description:这个方法是用来处理两个用户之间的转账业务
</span><span style="color: #008080;"> 4</span> <span style="color: #008000;">    * 在开发中，DAO层的职责应该只涉及到CRUD，
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;">    * 而这个transfer方法是处理两个用户之间的转账业务的，已经涉及到具体的业务操作，应该在业务层中做，不应该出现在DAO层的
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">    * 所以在开发中DAO层出现这样的业务处理方法是完全错误的
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;">    *
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> sourceName
</span><span style="color: #008080;">10</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> targetName
</span><span style="color: #008080;">11</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> money
</span><span style="color: #008080;">12</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">13</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> transfer(String sourceName,String targetName,<span style="color: #0000ff;">float</span> money) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">15</span>         Connection conn = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;">17</span>             conn =<span style="color: #000000;"> JdbcUtils.getConnection();
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;">开启事务</span>
<span style="color: #008080;">19</span>             conn.setAutoCommit(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">20</span>             <span style="color: #008000;">/**</span>
<span style="color: #008080;">21</span> <span style="color: #008000;">             * 在创建QueryRunner对象时，不传递数据源给它，是为了保证这两条SQL在同一个事务中进行，
</span><span style="color: #008080;">22</span> <span style="color: #008000;">             * 我们手动获取数据库连接，然后让这两条SQL使用同一个数据库连接执行
</span><span style="color: #008080;">23</span>              <span style="color: #008000;">*/</span>
<span style="color: #008080;">24</span>             QueryRunner runner = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">25</span>             String sql1 = "update account set money=money-100 where name=?"<span style="color: #000000;">;
</span><span style="color: #008080;">26</span>             String sql2 = "update account set money=money+100 where name=?"<span style="color: #000000;">;
</span><span style="color: #008080;">27</span>             Object[] paramArr1 =<span style="color: #000000;"> {sourceName};
</span><span style="color: #008080;">28</span>             Object[] paramArr2 =<span style="color: #000000;"> {targetName};
</span><span style="color: #008080;">29</span> <span style="color: #000000;">            runner.update(conn,sql1,paramArr1);
</span><span style="color: #008080;">30</span>             <span style="color: #008000;">//</span><span style="color: #008000;">模拟程序出现异常让事务回滚</span>
<span style="color: #008080;">31</span>             <span style="color: #0000ff;">int</span> x = 1/0<span style="color: #000000;">;
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            runner.update(conn,sql2,paramArr2);
</span><span style="color: #008080;">33</span>             <span style="color: #008000;">//</span><span style="color: #008000;">sql正常执行之后就提交事务</span>
<span style="color: #008080;">34</span> <span style="color: #000000;">            conn.commit();
</span><span style="color: #008080;">35</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">36</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">if</span>(conn!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;">38</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">出现异常之后就回滚事务</span>
<span style="color: #008080;">39</span> <span style="color: #000000;">                conn.rollback();
</span><span style="color: #008080;">40</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">41</span>         }<span style="color: #0000ff;">finally</span><span style="color: #000000;">{
</span><span style="color: #008080;">42</span>             <span style="color: #008000;">//</span><span style="color: #008000;">关闭数据库连接</span>
<span style="color: #008080;">43</span> <span style="color: #000000;">            conn.close();
</span><span style="color: #008080;">44</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">45</span>     }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　然后我们在AccountService中再写一个同名方法，在方法内部调用AccountDao的transfer方法处理转账业务，如下：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> transfer(String sourceName,String targetName,<span style="color: #0000ff;">float</span> money) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">2</span>         AccountDao dao = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AccountDao();
</span><span style="color: #008080;">3</span> <span style="color: #000000;">        dao.transfer(sourceName, targetName, money);
</span><span style="color: #008080;">4</span> }</pre>
</div>
<p>　　上面AccountDao的这个transfer方法可以处理转账业务，并且保证了在同一个事务中进行，但是AccountDao的这个transfer方法是处理两个用户之间的转账业务的，已经涉及到具体的业务操作，应该在业务层中做，不应该出现在DAO层的，在开发中，DAO层的职责应该只涉及到基本的CRUD，不涉及具体的业务操作，所以在开发中DAO层出现这样的业务处理方法是一种不好的设计。</p>
<h3 id="blogTitle10">4.2、在业务层(BusinessService)处理事务</h3>
<p>　　由于上述AccountDao存在具体的业务处理方法，导致AccountDao的职责不够单一，下面我们对AccountDao进行改造，让AccountDao的职责只是做CRUD操作，将事务的处理挪到业务层(BusinessService)，改造后的AccountDao如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.dao;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.QueryRunner;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.BeanHandler;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #008000;">/*<span style="color: #008000;">account</span>测试表</span>
<span style="color: #008080;">11</span> <span style="color: #008000;">create table account(
</span><span style="color: #008080;">12</span> <span style="color: #008000;">    id int primary key auto_increment,
</span><span style="color: #008080;">13</span> <span style="color: #008000;">    name varchar(40),
</span><span style="color: #008080;">14</span> <span style="color: #008000;">    money float
</span><span style="color: #008080;">15</span> <span style="color: #008000;">)character set utf8 collate utf8_general_ci;
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #008000;">insert into account(name,money) values('A',1000);
</span><span style="color: #008080;">18</span> <span style="color: #008000;">insert into account(name,money) values('B',1000);
</span><span style="color: #008080;">19</span> <span style="color: #008000;">insert into account(name,money) values('C',1000);
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span> <span style="color: #008000;">*/</span>
<span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">24</span> <span style="color: #008000;">* @ClassName: AccountDao
</span><span style="color: #008080;">25</span> <span style="color: #008000;">* @Description: 针对Account对象的CRUD
</span><span style="color: #008080;">26</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;">27</span> <span style="color: #008000;">* @date: 2014-10-6 下午4:00:42
</span><span style="color: #008080;">28</span> <span style="color: #008000;">*
</span><span style="color: #008080;">29</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">30</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountDao {
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>     <span style="color: #008000;">//</span><span style="color: #008000;">接收service层传递过来的Connection对象</span>
<span style="color: #008080;">33</span>     <span style="color: #0000ff;">private</span> Connection conn = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">34</span>     
<span style="color: #008080;">35</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> AccountDao(Connection conn){
</span><span style="color: #008080;">36</span>         <span style="color: #0000ff;">this</span>.conn =<span style="color: #000000;"> conn;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span>     
<span style="color: #008080;">39</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> AccountDao(){
</span><span style="color: #008080;">40</span>         
<span style="color: #008080;">41</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">42</span>     
<span style="color: #008080;">43</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">44</span> <span style="color: #008000;">    * @Method: update
</span><span style="color: #008080;">45</span> <span style="color: #008000;">    * @Description:更新
</span><span style="color: #008080;">46</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">47</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">48</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> account
</span><span style="color: #008080;">49</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">50</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">51</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> update(Account account) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">52</span>         
<span style="color: #008080;">53</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">54</span>         String sql = "update account set name=?,money=? where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">55</span>         Object params[] =<span style="color: #000000;"> {account.getName(),account.getMoney(),account.getId()};
</span><span style="color: #008080;">56</span>         <span style="color: #008000;">//</span><span style="color: #008000;">使用service层传递过来的Connection对象操作数据库</span>
<span style="color: #008080;">57</span> <span style="color: #000000;">        qr.update(conn,sql, params);
</span><span style="color: #008080;">58</span>         
<span style="color: #008080;">59</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">60</span>     
<span style="color: #008080;">61</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">62</span> <span style="color: #008000;">    * @Method: find
</span><span style="color: #008080;">63</span> <span style="color: #008000;">    * @Description:查找
</span><span style="color: #008080;">64</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">65</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">66</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> id
</span><span style="color: #008080;">67</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@return</span>
<span style="color: #008080;">68</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">69</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">70</span>     <span style="color: #0000ff;">public</span> Account find(<span style="color: #0000ff;">int</span> id) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">71</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">72</span>         String sql = "select * from account where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">73</span>         <span style="color: #008000;">//</span><span style="color: #008000;">使用service层传递过来的Connection对象操作数据库</span>
<span style="color: #008080;">74</span>         <span style="color: #0000ff;">return</span> (Account) qr.query(conn,sql, id, <span style="color: #0000ff;">new</span> BeanHandler(Account.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;">75</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">76</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　接着对AccountService(业务层)中的transfer方法的改造，在业务层(BusinessService)中处理事务</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.service;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.dao.AccountDao;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;">* @ClassName: AccountService
</span><span style="color: #008080;">11</span> <span style="color: #008000;">* @Description: 业务逻辑处理层
</span><span style="color: #008080;">12</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;">13</span> <span style="color: #008000;">* @date: 2014-10-6 下午5:30:15
</span><span style="color: #008080;">14</span> <span style="color: #008000;">*
</span><span style="color: #008080;">15</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountService {
</span><span style="color: #008080;">17</span>     
<span style="color: #008080;">18</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">19</span> <span style="color: #008000;">    * @Method: transfer
</span><span style="color: #008080;">20</span> <span style="color: #008000;">    * @Description:这个方法是用来处理两个用户之间的转账业务
</span><span style="color: #008080;">21</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">22</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">23</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> sourceid
</span><span style="color: #008080;">24</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> tartgetid
</span><span style="color: #008080;">25</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> money
</span><span style="color: #008080;">26</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">27</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">28</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> transfer(<span style="color: #0000ff;">int</span> sourceid,<span style="color: #0000ff;">int</span> tartgetid,<span style="color: #0000ff;">float</span> money) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">29</span>         Connection conn = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;">31</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取数据库连接</span>
<span style="color: #008080;">32</span>             conn =<span style="color: #000000;"> JdbcUtils.getConnection();
</span><span style="color: #008080;">33</span>             <span style="color: #008000;">//</span><span style="color: #008000;">开启事务</span>
<span style="color: #008080;">34</span>             conn.setAutoCommit(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">35</span>             <span style="color: #008000;">//</span><span style="color: #008000;">将获取到的Connection传递给AccountDao，保证dao层使用的是同一个Connection对象操作数据库</span>
<span style="color: #008080;">36</span>             AccountDao dao = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AccountDao(conn);
</span><span style="color: #008080;">37</span>             Account source =<span style="color: #000000;"> dao.find(sourceid);
</span><span style="color: #008080;">38</span>             Account target =<span style="color: #000000;"> dao.find(tartgetid);
</span><span style="color: #008080;">39</span>             
<span style="color: #008080;">40</span>             source.setMoney(source.getMoney()-<span style="color: #000000;">money);
</span><span style="color: #008080;">41</span>             target.setMoney(target.getMoney()+<span style="color: #000000;">money);
</span><span style="color: #008080;">42</span>             
<span style="color: #008080;">43</span> <span style="color: #000000;">            dao.update(source);
</span><span style="color: #008080;">44</span>             <span style="color: #008000;">//</span><span style="color: #008000;">模拟程序出现异常让事务回滚</span>
<span style="color: #008080;">45</span>             <span style="color: #0000ff;">int</span> x = 1/0<span style="color: #000000;">;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">            dao.update(target);
</span><span style="color: #008080;">47</span>             <span style="color: #008000;">//</span><span style="color: #008000;">提交事务</span>
<span style="color: #008080;">48</span> <span style="color: #000000;">            conn.commit();
</span><span style="color: #008080;">49</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">50</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">51</span>             <span style="color: #008000;">//</span><span style="color: #008000;">出现异常之后就回滚事务</span>
<span style="color: #008080;">52</span> <span style="color: #000000;">            conn.rollback();
</span><span style="color: #008080;">53</span>         }<span style="color: #0000ff;">finally</span><span style="color: #000000;">{
</span><span style="color: #008080;">54</span> <span style="color: #000000;">            conn.close();
</span><span style="color: #008080;">55</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">56</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">57</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　程序经过这样改造之后就比刚才好多了，AccountDao只负责CRUD，里面没有具体的业务处理方法了，职责就单一了，而AccountService则负责具体的业务逻辑和事务的处理，需要操作数据库时，就调用AccountDao层提供的CRUD方法操作数据库。</p>
<h3 id="blogTitle11">4.3、使用ThreadLocal进行更加优雅的事务处理</h3>
<p>　　上面的在businessService层这种处理事务的方式依然不够优雅，为了能够让事务处理更加优雅，我们使用ThreadLocal类进行改造，<span style="color: #ff0000;"><strong>ThreadLocal一个容器，向这个容器存储的对象，在当前线程范围内都可以取得出来，向ThreadLocal里面存东西就是向它里面的Map存东西的，然后ThreadLocal把这个Map挂到当前的线程底下，这样Map就只属于这个线程了</strong></span></p>
<p><span style="color: #000000;">　　ThreadLocal类的使用范例如下：</span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.test;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ThreadLocalTest {
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 6</span>         <span style="color: #008000;">//</span><span style="color: #008000;">得到程序运行时的当前线程</span>
<span style="color: #008080;"> 7</span>         Thread currentThread =<span style="color: #000000;"> Thread.currentThread();
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        System.out.println(currentThread);
</span><span style="color: #008080;"> 9</span>         <span style="color: #008000;">//</span><span style="color: #008000;">ThreadLocal一个容器，向这个容器存储的对象，在当前线程范围内都可以取得出来</span>
<span style="color: #008080;">10</span>         ThreadLocal&lt;String&gt; t = <span style="color: #0000ff;">new</span> ThreadLocal&lt;String&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;">把某个对象绑定到当前线程上 对象以键值对的形式存储到一个Map集合中，对象的的key是当前的线程，如： map(currentThread,"aaa")</span>
<span style="color: #008080;">12</span>         t.set("aaa"<span style="color: #000000;">);
</span><span style="color: #008080;">13</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取绑定到当前线程中的对象</span>
<span style="color: #008080;">14</span>         String value =<span style="color: #000000;"> t.get();
</span><span style="color: #008080;">15</span>         <span style="color: #008000;">//</span><span style="color: #008000;">输出value的值是aaa</span>
<span style="color: #008080;">16</span> <span style="color: #000000;">        System.out.println(value);
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　使用使用ThreadLocal类进行改造数据库连接工具类JdbcUtils，改造后的代码如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.util;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.sql.DataSource;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.mchange.v2.c3p0.ComboPooledDataSource;
</span><span style="color: #008080;">  7</span> 
<span style="color: #008080;">  8</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">  9</span> <span style="color: #008000;">* @ClassName: JdbcUtils2
</span><span style="color: #008080;"> 10</span> <span style="color: #008000;">* @Description: 数据库连接工具类
</span><span style="color: #008080;"> 11</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;"> 12</span> <span style="color: #008000;">* @date: 2014-10-4 下午6:04:36
</span><span style="color: #008080;"> 13</span> <span style="color: #008000;">*
</span><span style="color: #008080;"> 14</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JdbcUtils2 {
</span><span style="color: #008080;"> 16</span>     
<span style="color: #008080;"> 17</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ComboPooledDataSource ds = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 18</span>     <span style="color: #008000;">//</span><span style="color: #008000;">使用ThreadLocal存储当前线程中的Connection对象</span>
<span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span style="color: #0000ff;">new</span> ThreadLocal&lt;Connection&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 20</span>     
<span style="color: #008080;"> 21</span>     <span style="color: #008000;">//</span><span style="color: #008000;">在静态代码块中创建数据库连接池</span>
<span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 23</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 24</span>             <span style="color: #008000;">//</span><span style="color: #008000;">通过代码创建C3P0数据库连接池</span>
<span style="color: #008080;"> 25</span>             <span style="color: #008000;">/*</span><span style="color: #008000;">ds = new ComboPooledDataSource();
</span><span style="color: #008080;"> 26</span> <span style="color: #008000;">            ds.setDriverClass("com.mysql.jdbc.Driver");
</span><span style="color: #008080;"> 27</span> <span style="color: #008000;">            ds.setJdbcUrl("jdbc:mysql://localhost:3306/jdbcstudy");
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;">            ds.setUser("root");
</span><span style="color: #008080;"> 29</span> <span style="color: #008000;">            ds.setPassword("XDP");
</span><span style="color: #008080;"> 30</span> <span style="color: #008000;">            ds.setInitialPoolSize(10);
</span><span style="color: #008080;"> 31</span> <span style="color: #008000;">            ds.setMinPoolSize(5);
</span><span style="color: #008080;"> 32</span> <span style="color: #008000;">            ds.setMaxPoolSize(20);</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 33</span>             
<span style="color: #008080;"> 34</span>             <span style="color: #008000;">//</span><span style="color: #008000;">通过读取C3P0的xml配置文件创建数据源，C3P0的xml配置文件c3p0-config.xml必须放在src目录下
</span><span style="color: #008080;"> 35</span>             <span style="color: #008000;">//</span><span style="color: #008000;">ds = new ComboPooledDataSource();</span><span style="color: #008000;">//</span><span style="color: #008000;">使用C3P0的默认配置来创建数据源</span>
<span style="color: #008080;"> 36</span>             ds = <span style="color: #0000ff;">new</span> ComboPooledDataSource("MySQL");<span style="color: #008000;">//</span><span style="color: #008000;">使用C3P0的命名配置来创建数据源</span>
<span style="color: #008080;"> 37</span>             
<span style="color: #008080;"> 38</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;"> 39</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> ExceptionInInitializerError(e);
</span><span style="color: #008080;"> 40</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 41</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 42</span>     
<span style="color: #008080;"> 43</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 44</span> <span style="color: #008000;">    * @Method: getConnection
</span><span style="color: #008080;"> 45</span> <span style="color: #008000;">    * @Description: 从数据源中获取数据库连接
</span><span style="color: #008080;"> 46</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;"> 47</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> Connection
</span><span style="color: #008080;"> 48</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;"> 49</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 50</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Connection getConnection() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;"> 51</span>         <span style="color: #008000;">//</span><span style="color: #008000;">从当前线程中获取Connection</span>
<span style="color: #008080;"> 52</span>         Connection conn =<span style="color: #000000;"> threadLocal.get();
</span><span style="color: #008080;"> 53</span>         <span style="color: #0000ff;">if</span>(conn==<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;"> 54</span>             <span style="color: #008000;">//</span><span style="color: #008000;">从数据源中获取数据库连接</span>
<span style="color: #008080;"> 55</span>             conn =<span style="color: #000000;"> getDataSource().getConnection();
</span><span style="color: #008080;"> 56</span>             <span style="color: #008000;">//</span><span style="color: #008000;">将conn绑定到当前线程</span>
<span style="color: #008080;"> 57</span> <span style="color: #000000;">            threadLocal.set(conn);
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 59</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> conn;
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 61</span>     
<span style="color: #008080;"> 62</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 63</span> <span style="color: #008000;">    * @Method: startTransaction
</span><span style="color: #008080;"> 64</span> <span style="color: #008000;">    * @Description: 开启事务
</span><span style="color: #008080;"> 65</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;"> 66</span> <span style="color: #008000;">    *
</span><span style="color: #008080;"> 67</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 68</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> startTransaction(){
</span><span style="color: #008080;"> 69</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 70</span>             Connection conn =<span style="color: #000000;">  threadLocal.get();
</span><span style="color: #008080;"> 71</span>             <span style="color: #0000ff;">if</span>(conn==<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;"> 72</span>                 conn =<span style="color: #000000;"> getConnection();
</span><span style="color: #008080;"> 73</span>                  <span style="color: #008000;">//</span><span style="color: #008000;">把 conn绑定到当前线程上</span>
<span style="color: #008080;"> 74</span> <span style="color: #000000;">                threadLocal.set(conn);
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 76</span>             <span style="color: #008000;">//</span><span style="color: #008000;">开启事务</span>
<span style="color: #008080;"> 77</span>             conn.setAutoCommit(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 78</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;"> 79</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> RuntimeException(e);
</span><span style="color: #008080;"> 80</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 82</span>     
<span style="color: #008080;"> 83</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 84</span> <span style="color: #008000;">    * @Method: rollback
</span><span style="color: #008080;"> 85</span> <span style="color: #008000;">    * @Description:回滚事务
</span><span style="color: #008080;"> 86</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;"> 87</span> <span style="color: #008000;">    *
</span><span style="color: #008080;"> 88</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;"> 89</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> rollback(){
</span><span style="color: #008080;"> 90</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 91</span>             <span style="color: #008000;">//</span><span style="color: #008000;">从当前线程中获取Connection</span>
<span style="color: #008080;"> 92</span>             Connection conn =<span style="color: #000000;"> threadLocal.get();
</span><span style="color: #008080;"> 93</span>             <span style="color: #0000ff;">if</span>(conn!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;"> 94</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">回滚事务</span>
<span style="color: #008080;"> 95</span> <span style="color: #000000;">                conn.rollback();
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 97</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;"> 98</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> RuntimeException(e);
</span><span style="color: #008080;"> 99</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">100</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">101</span>     
<span style="color: #008080;">102</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">103</span> <span style="color: #008000;">    * @Method: commit
</span><span style="color: #008080;">104</span> <span style="color: #008000;">    * @Description:提交事务
</span><span style="color: #008080;">105</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">106</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">107</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">108</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> commit(){
</span><span style="color: #008080;">109</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;">110</span>             <span style="color: #008000;">//</span><span style="color: #008000;">从当前线程中获取Connection</span>
<span style="color: #008080;">111</span>             Connection conn =<span style="color: #000000;"> threadLocal.get();
</span><span style="color: #008080;">112</span>             <span style="color: #0000ff;">if</span>(conn!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;">113</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">提交事务</span>
<span style="color: #008080;">114</span> <span style="color: #000000;">                conn.commit();
</span><span style="color: #008080;">115</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">116</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">117</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> RuntimeException(e);
</span><span style="color: #008080;">118</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">119</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">120</span>     
<span style="color: #008080;">121</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">122</span> <span style="color: #008000;">    * @Method: close
</span><span style="color: #008080;">123</span> <span style="color: #008000;">    * @Description:关闭数据库连接(注意，并不是真的关闭，而是把连接还给数据库连接池)
</span><span style="color: #008080;">124</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">125</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">126</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">127</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> close(){
</span><span style="color: #008080;">128</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;">129</span>             <span style="color: #008000;">//</span><span style="color: #008000;">从当前线程中获取Connection</span>
<span style="color: #008080;">130</span>             Connection conn =<span style="color: #000000;"> threadLocal.get();
</span><span style="color: #008080;">131</span>             <span style="color: #0000ff;">if</span>(conn!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;">132</span> <span style="color: #000000;">                conn.close();
</span><span style="color: #008080;">133</span>                  <span style="color: #008000;">//</span><span style="color: #008000;">解除当前线程上绑定conn</span>
<span style="color: #008080;">134</span> <span style="color: #000000;">                threadLocal.remove();
</span><span style="color: #008080;">135</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">136</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">137</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> RuntimeException(e);
</span><span style="color: #008080;">138</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">139</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">140</span>     
<span style="color: #008080;">141</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">142</span> <span style="color: #008000;">    * @Method: getDataSource
</span><span style="color: #008080;">143</span> <span style="color: #008000;">    * @Description: 获取数据源
</span><span style="color: #008080;">144</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">145</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> DataSource
</span><span style="color: #008080;">146</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">147</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DataSource getDataSource(){
</span><span style="color: #008080;">148</span>         <span style="color: #008000;">//</span><span style="color: #008000;">从数据源中获取数据库连接</span>
<span style="color: #008080;">149</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> ds;
</span><span style="color: #008080;">150</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">151</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　对AccountDao进行改造，数据库连接对象不再需要service层传递过来，而是直接从JdbcUtils2提供的getConnection方法去获取，改造后的AccountDao如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.dao;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.QueryRunner;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.BeanHandler;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils2;
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #008000;">/*</span>
<span style="color: #008080;">12</span> <span style="color: #008000;">create table account(
</span><span style="color: #008080;">13</span> <span style="color: #008000;">    id int primary key auto_increment,
</span><span style="color: #008080;">14</span> <span style="color: #008000;">    name varchar(40),
</span><span style="color: #008080;">15</span> <span style="color: #008000;">    money float
</span><span style="color: #008080;">16</span> <span style="color: #008000;">)character set utf8 collate utf8_general_ci;
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="color: #008000;">insert into account(name,money) values('A',1000);
</span><span style="color: #008080;">19</span> <span style="color: #008000;">insert into account(name,money) values('B',1000);
</span><span style="color: #008080;">20</span> <span style="color: #008000;">insert into account(name,money) values('C',1000);
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span> <span style="color: #008000;">*/</span>
<span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">25</span> <span style="color: #008000;">* @ClassName: AccountDao
</span><span style="color: #008080;">26</span> <span style="color: #008000;">* @Description: 针对Account对象的CRUD
</span><span style="color: #008080;">27</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;">28</span> <span style="color: #008000;">* @date: 2014-10-6 下午4:00:42
</span><span style="color: #008080;">29</span> <span style="color: #008000;">*
</span><span style="color: #008080;">30</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">31</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountDao2 {
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> update(Account account) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">34</span>         
<span style="color: #008080;">35</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">36</span>         String sql = "update account set name=?,money=? where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">37</span>         Object params[] =<span style="color: #000000;"> {account.getName(),account.getMoney(),account.getId()};
</span><span style="color: #008080;">38</span>         <span style="color: #008000;">//</span><span style="color: #008000;">JdbcUtils2.getConnection()获取当前线程中的Connection对象</span>
<span style="color: #008080;">39</span> <span style="color: #000000;">        qr.update(JdbcUtils2.getConnection(),sql, params);
</span><span style="color: #008080;">40</span>         
<span style="color: #008080;">41</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">42</span>     
<span style="color: #008080;">43</span>     <span style="color: #0000ff;">public</span> Account find(<span style="color: #0000ff;">int</span> id) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">44</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">45</span>         String sql = "select * from account where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">46</span>         <span style="color: #008000;">//</span><span style="color: #008000;">JdbcUtils2.getConnection()获取当前线程中的Connection对象</span>
<span style="color: #008080;">47</span>         <span style="color: #0000ff;">return</span> (Account) qr.query(JdbcUtils2.getConnection(),sql, id, <span style="color: #0000ff;">new</span> BeanHandler(Account.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;">48</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">49</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　对AccountService进行改造，service层不再需要传递数据库连接Connection给Dao层，改造后的AccountService如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.service;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.dao.AccountDao2;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils2;
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountService2 {
</span><span style="color: #008080;"> 9</span>     
<span style="color: #008080;">10</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">11</span> <span style="color: #008000;">    * @Method: transfer
</span><span style="color: #008080;">12</span> <span style="color: #008000;">    * @Description:在业务层处理两个账户之间的转账问题
</span><span style="color: #008080;">13</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">14</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">15</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> sourceid
</span><span style="color: #008080;">16</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> tartgetid
</span><span style="color: #008080;">17</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> money
</span><span style="color: #008080;">18</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">19</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">20</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> transfer(<span style="color: #0000ff;">int</span> sourceid,<span style="color: #0000ff;">int</span> tartgetid,<span style="color: #0000ff;">float</span> money) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{
</span><span style="color: #008080;">22</span>             <span style="color: #008000;">//</span><span style="color: #008000;">开启事务，在业务层处理事务，保证dao层的多个操作在同一个事务中进行</span>
<span style="color: #008080;">23</span> <span style="color: #000000;">            JdbcUtils2.startTransaction();
</span><span style="color: #008080;">24</span>             AccountDao2 dao = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AccountDao2();
</span><span style="color: #008080;">25</span>             
<span style="color: #008080;">26</span>             Account source =<span style="color: #000000;"> dao.find(sourceid);
</span><span style="color: #008080;">27</span>             Account target =<span style="color: #000000;"> dao.find(tartgetid);
</span><span style="color: #008080;">28</span>             source.setMoney(source.getMoney()-<span style="color: #000000;">money);
</span><span style="color: #008080;">29</span>             target.setMoney(target.getMoney()+<span style="color: #000000;">money);
</span><span style="color: #008080;">30</span>             
<span style="color: #008080;">31</span> <span style="color: #000000;">            dao.update(source);
</span><span style="color: #008080;">32</span>             <span style="color: #008000;">//</span><span style="color: #008000;">模拟程序出现异常让事务回滚</span>
<span style="color: #008080;">33</span>             <span style="color: #0000ff;">int</span> x = 1/0<span style="color: #000000;">;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            dao.update(target);
</span><span style="color: #008080;">35</span>             
<span style="color: #008080;">36</span>             <span style="color: #008000;">//</span><span style="color: #008000;">SQL正常执行之后提交事务</span>
<span style="color: #008080;">37</span> <span style="color: #000000;">            JdbcUtils2.commit();
</span><span style="color: #008080;">38</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">39</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">40</span>             <span style="color: #008000;">//</span><span style="color: #008000;">出现异常之后就回滚事务</span>
<span style="color: #008080;">41</span> <span style="color: #000000;">            JdbcUtils2.rollback();
</span><span style="color: #008080;">42</span>         }<span style="color: #0000ff;">finally</span><span style="color: #000000;">{
</span><span style="color: #008080;">43</span>             <span style="color: #008000;">//</span><span style="color: #008000;">关闭数据库连接</span>
<span style="color: #008080;">44</span> <span style="color: #000000;">            JdbcUtils2.close();
</span><span style="color: #008080;">45</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">47</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　这样在service层对事务的处理看起来就更加优雅了。ThreadLocal类在开发中使用得是比较多的，<span style="color: #ff0000;"><strong>程序运行中产生的数据要想在一个线程范围内共享，只需要把数据使用ThreadLocal进行存储即可</strong></span>。</p>
<h3 id="blogTitle12">4.4、ThreadLocal + Filter 处理事务</h3>
<p>　　上面介绍了JDBC开发中事务处理的3种方式，下面再介绍的一种使用ThreadLocal + Filter进行统一的事务处理，这种方式主要是使用过滤器进行统一的事务处理，如下图所示：</p>
<p>　　<img style="border: 1px solid black;" src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/070808249216296.png" alt=""></p>
<p><strong>1、编写一个事务过滤器TransactionFilter</strong></p>
<p>代码如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gac.web.filter;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.Filter;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.FilterChain;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.FilterConfig;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletRequest;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletResponse;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.util.JdbcUtils;
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">17</span> <span style="color: #008000;">* @ClassName: TransactionFilter
</span><span style="color: #008080;">18</span> <span style="color: #008000;">* @Description:ThreadLocal + Filter 统一处理数据库事务
</span><span style="color: #008080;">19</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;">20</span> <span style="color: #008000;">* @date: 2014-10-6 下午11:36:58
</span><span style="color: #008080;">21</span> <span style="color: #008000;">*
</span><span style="color: #008080;">22</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">23</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> TransactionFilter <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Filter {
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">26</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> init(FilterConfig filterConfig) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException {
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doFilter(ServletRequest request, ServletResponse response,
</span><span style="color: #008080;">32</span>             FilterChain chain) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, ServletException {
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>         Connection connection = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">36</span>             <span style="color: #008000;">//</span><span style="color: #008000;">1、获取数据库连接对象Connection</span>
<span style="color: #008080;">37</span>             connection =<span style="color: #000000;"> JdbcUtils.getConnection();
</span><span style="color: #008080;">38</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2、开启事务</span>
<span style="color: #008080;">39</span>             connection.setAutoCommit(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">40</span>             <span style="color: #008000;">//</span><span style="color: #008000;">3、利用ThreadLocal把获取数据库连接对象Connection和当前线程绑定</span>
<span style="color: #008080;">41</span> <span style="color: #000000;">            ConnectionContext.getInstance().bind(connection);
</span><span style="color: #008080;">42</span>             <span style="color: #008000;">//</span><span style="color: #008000;">4、把请求转发给目标Servlet</span>
<span style="color: #008080;">43</span> <span style="color: #000000;">            chain.doFilter(request, response);
</span><span style="color: #008080;">44</span>             <span style="color: #008000;">//</span><span style="color: #008000;">5、提交事务</span>
<span style="color: #008080;">45</span> <span style="color: #000000;">            connection.commit();
</span><span style="color: #008080;">46</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">47</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">48</span>             <span style="color: #008000;">//</span><span style="color: #008000;">6、回滚事务</span>
<span style="color: #008080;">49</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">50</span> <span style="color: #000000;">                connection.rollback();
</span><span style="color: #008080;">51</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (SQLException e1) {
</span><span style="color: #008080;">52</span> <span style="color: #000000;">                e1.printStackTrace();
</span><span style="color: #008080;">53</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">54</span>             HttpServletRequest req =<span style="color: #000000;"> (HttpServletRequest) request;
</span><span style="color: #008080;">55</span>             HttpServletResponse res =<span style="color: #000000;"> (HttpServletResponse) response;
</span><span style="color: #008080;">56</span>             <span style="color: #008000;">//</span><span style="color: #008000;">req.setAttribute("errMsg", e.getMessage());
</span><span style="color: #008080;">57</span>             <span style="color: #008000;">//</span><span style="color: #008000;">req.getRequestDispatcher("/error.jsp").forward(req, res);
</span><span style="color: #008080;">58</span>             <span style="color: #008000;">//</span><span style="color: #008000;">出现异常之后跳转到错误页面</span>
<span style="color: #008080;">59</span>             res.sendRedirect(req.getContextPath()+"/error.jsp"<span style="color: #000000;">);
</span><span style="color: #008080;">60</span>         }<span style="color: #0000ff;">finally</span><span style="color: #000000;">{
</span><span style="color: #008080;">61</span>             <span style="color: #008000;">//</span><span style="color: #008000;">7、解除绑定</span>
<span style="color: #008080;">62</span> <span style="color: #000000;">            ConnectionContext.getInstance().remove();
</span><span style="color: #008080;">63</span>             <span style="color: #008000;">//</span><span style="color: #008000;">8、关闭数据库连接</span>
<span style="color: #008080;">64</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">65</span> <span style="color: #000000;">                connection.close();
</span><span style="color: #008080;">66</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (SQLException e) {
</span><span style="color: #008080;">67</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">68</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">70</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">71</span> 
<span style="color: #008080;">72</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">73</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> destroy() {
</span><span style="color: #008080;">74</span> 
<span style="color: #008080;">75</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">76</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　我们在TransactionFilter中把获取到的数据库连接使用ThreadLocal绑定到当前线程之后，在DAO层还需要从ThreadLocal中取出数据库连接来操作数据库，因此需要编写一个ConnectionContext类来存储ThreadLocal，ConnectionContext类的代码如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gac.web.filter;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 6</span> <span style="color: #008000;">* @ClassName: ConnectionContext
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;">* @Description:数据库连接上下文
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;">* @date: 2014-10-7 上午8:36:01
</span><span style="color: #008080;">10</span> <span style="color: #008000;">*
</span><span style="color: #008080;">11</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConnectionContext {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">15</span> <span style="color: #008000;">     * 构造方法私有化，将ConnectionContext设计成单例
</span><span style="color: #008080;">16</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> ConnectionContext(){
</span><span style="color: #008080;">18</span>         
<span style="color: #008080;">19</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">20</span>     <span style="color: #008000;">//</span><span style="color: #008000;">创建ConnectionContext实例对象</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ConnectionContext connectionContext = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConnectionContext();
</span><span style="color: #008080;">22</span>     
<span style="color: #008080;">23</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">24</span> <span style="color: #008000;">    * @Method: getInstance
</span><span style="color: #008080;">25</span> <span style="color: #008000;">    * @Description:获取ConnectionContext实例对象
</span><span style="color: #008080;">26</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">27</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">28</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@return</span>
<span style="color: #008080;">29</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">30</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> ConnectionContext getInstance(){
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> connectionContext;
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span>     
<span style="color: #008080;">34</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">35</span> <span style="color: #008000;">    * @Field: connectionThreadLocal
</span><span style="color: #008080;">36</span> <span style="color: #008000;">    *         使用ThreadLocal存储数据库连接对象
</span><span style="color: #008080;">37</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">38</span>     <span style="color: #0000ff;">private</span> ThreadLocal&lt;Connection&gt; connectionThreadLocal = <span style="color: #0000ff;">new</span> ThreadLocal&lt;Connection&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">39</span>     
<span style="color: #008080;">40</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">41</span> <span style="color: #008000;">    * @Method: bind
</span><span style="color: #008080;">42</span> <span style="color: #008000;">    * @Description:利用ThreadLocal把获取数据库连接对象Connection和当前线程绑定
</span><span style="color: #008080;">43</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">44</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">45</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> connection
</span><span style="color: #008080;">46</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">47</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> bind(Connection connection){
</span><span style="color: #008080;">48</span> <span style="color: #000000;">        connectionThreadLocal.set(connection);
</span><span style="color: #008080;">49</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">50</span>     
<span style="color: #008080;">51</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">52</span> <span style="color: #008000;">    * @Method: getConnection
</span><span style="color: #008080;">53</span> <span style="color: #008000;">    * @Description:从当前线程中取出Connection对象
</span><span style="color: #008080;">54</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">55</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">56</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@return</span>
<span style="color: #008080;">57</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">58</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Connection getConnection(){
</span><span style="color: #008080;">59</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> connectionThreadLocal.get();
</span><span style="color: #008080;">60</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">61</span>     
<span style="color: #008080;">62</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">63</span> <span style="color: #008000;">    * @Method: remove
</span><span style="color: #008080;">64</span> <span style="color: #008000;">    * @Description: 解除当前线程上绑定Connection
</span><span style="color: #008080;">65</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">66</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">67</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">68</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> remove(){
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        connectionThreadLocal.remove();
</span><span style="color: #008080;">70</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">71</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　在DAO层想获取数据库连接时，就可以使用ConnectionContext.getInstance().getConnection()来获取，如下所示：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.dao;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.QueryRunner;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.commons.dbutils.handlers.BeanHandler;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gac.web.filter.ConnectionContext;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #008000;">/*</span>
<span style="color: #008080;">11</span> <span style="color: #008000;">create table account(
</span><span style="color: #008080;">12</span> <span style="color: #008000;">    id int primary key auto_increment,
</span><span style="color: #008080;">13</span> <span style="color: #008000;">    name varchar(40),
</span><span style="color: #008080;">14</span> <span style="color: #008000;">    money float
</span><span style="color: #008080;">15</span> <span style="color: #008000;">)character set utf8 collate utf8_general_ci;
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #008000;">insert into account(name,money) values('A',1000);
</span><span style="color: #008080;">18</span> <span style="color: #008000;">insert into account(name,money) values('B',1000);
</span><span style="color: #008080;">19</span> <span style="color: #008000;">insert into account(name,money) values('C',1000);
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span> <span style="color: #008000;">*/</span>
<span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">24</span> <span style="color: #008000;">* @ClassName: AccountDao
</span><span style="color: #008080;">25</span> <span style="color: #008000;">* @Description: 针对Account对象的CRUD
</span><span style="color: #008080;">26</span> <span style="color: #008000;">* </span><span style="color: #808080;">@author</span><span style="color: #008000;">: 孤傲苍狼
</span><span style="color: #008080;">27</span> <span style="color: #008000;">* @date: 2014-10-6 下午4:00:42
</span><span style="color: #008080;">28</span> <span style="color: #008000;">*
</span><span style="color: #008080;">29</span> <span style="color: #008000;">*/</span> 
<span style="color: #008080;">30</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountDao3 {
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> update(Account account) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">33</span>         
<span style="color: #008080;">34</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">35</span>         String sql = "update account set name=?,money=? where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">36</span>         Object params[] =<span style="color: #000000;"> {account.getName(),account.getMoney(),account.getId()};
</span><span style="color: #008080;">37</span>         <span style="color: #008000;">//</span><span style="color: #008000;">ConnectionContext.getInstance().getConnection()获取当前线程中的Connection对象</span>
<span style="color: #008080;">38</span> <span style="color: #000000;">        qr.update(ConnectionContext.getInstance().getConnection(),sql, params);
</span><span style="color: #008080;">39</span>         
<span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span>     
<span style="color: #008080;">42</span>     <span style="color: #0000ff;">public</span> Account find(<span style="color: #0000ff;">int</span> id) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException{
</span><span style="color: #008080;">43</span>         QueryRunner qr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> QueryRunner();
</span><span style="color: #008080;">44</span>         String sql = "select * from account where id=?"<span style="color: #000000;">;
</span><span style="color: #008080;">45</span>         <span style="color: #008000;">//</span><span style="color: #008000;">ConnectionContext.getInstance().getConnection()获取当前线程中的Connection对象</span>
<span style="color: #008080;">46</span>         <span style="color: #0000ff;">return</span> (Account) qr.query(ConnectionContext.getInstance().getConnection(),sql, id, <span style="color: #0000ff;">new</span> BeanHandler(Account.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;">47</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">48</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　businessService层也不用处理事务和数据库连接问题了，这些统一在TransactionFilter中统一管理了，businessService层只需要专注业务逻辑的处理即可，如下所示：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.service;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.dao.AccountDao3;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.domain.Account;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> AccountService3 {
</span><span style="color: #008080;"> 8</span>     
<span style="color: #008080;"> 9</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;">    * @Method: transfer
</span><span style="color: #008080;">11</span> <span style="color: #008000;">    * @Description:在业务层处理两个账户之间的转账问题
</span><span style="color: #008080;">12</span> <span style="color: #008000;">    * @Anthor:孤傲苍狼
</span><span style="color: #008080;">13</span> <span style="color: #008000;">    *
</span><span style="color: #008080;">14</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> sourceid
</span><span style="color: #008080;">15</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> tartgetid
</span><span style="color: #008080;">16</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> money
</span><span style="color: #008080;">17</span> <span style="color: #008000;">    * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> SQLException
</span><span style="color: #008080;">18</span>     <span style="color: #008000;">*/</span> 
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> transfer(<span style="color: #0000ff;">int</span> sourceid, <span style="color: #0000ff;">int</span> tartgetid, <span style="color: #0000ff;">float</span><span style="color: #000000;"> money)
</span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;">21</span>         AccountDao3 dao = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AccountDao3();
</span><span style="color: #008080;">22</span>         Account source =<span style="color: #000000;"> dao.find(sourceid);
</span><span style="color: #008080;">23</span>         Account target =<span style="color: #000000;"> dao.find(tartgetid);
</span><span style="color: #008080;">24</span>         source.setMoney(source.getMoney() -<span style="color: #000000;"> money);
</span><span style="color: #008080;">25</span>         target.setMoney(target.getMoney() +<span style="color: #000000;"> money);
</span><span style="color: #008080;">26</span> <span style="color: #000000;">        dao.update(source);
</span><span style="color: #008080;">27</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 模拟程序出现异常让事务回滚</span>
<span style="color: #008080;">28</span>         <span style="color: #0000ff;">int</span> x = 1 / 0<span style="color: #000000;">;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        dao.update(target);
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">31</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>　　Web层的Servlet调用businessService层的业务方法处理用户请求，需要注意的是：调用businessService层的方法出异常之后，继续将异常抛出，这样在TransactionFilter就能捕获到抛出的异常，继而执行事务回滚操作，如下所示：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> me.gacl.web.controller;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> me.gacl.service.AccountService3;
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> AccountServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doGet(HttpServletRequest request, HttpServletResponse response)
</span><span style="color: #008080;">14</span>             <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
</span><span style="color: #008080;">15</span>         AccountService3 service = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AccountService3();
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">17</span>             service.transfer(1, 2, 100<span style="color: #000000;">);
</span><span style="color: #008080;">18</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (SQLException e) {
</span><span style="color: #008080;">19</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">20</span>             <span style="color: #008000;">//</span><span style="color: #008000;">注意：调用service层的方法出异常之后，继续将异常抛出，这样在TransactionFilter就能捕获到抛出的异常，继而执行事务回滚操作</span>
<span style="color: #008080;">21</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> RuntimeException(e);
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doPost(HttpServletRequest request, HttpServletResponse response)
</span><span style="color: #008080;">26</span>             <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
</span><span style="color: #008080;">27</span> <span style="color: #000000;">        doGet(request, response);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">29</span> }</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/xdp-gacl/category/574705.html">JavaWeb学习总结</a></div>
<div id="EntryTag">标签: <a href="http://www.cnblogs.com/xdp-gacl/tag/JavaWeb%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">JavaWeb学习总结</a></div>
<div id="blog_post_info"><div id="green_channel">
<a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(4007225,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
<a id="green_channel_follow" onclick="c_follow();" href="javascript:void(0);">关注我</a>
<a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a><a id="green_channel_contact" href="http://msg.cnblogs.com/send/%E5%AD%A4%E5%82%B2%E8%8B%8D%E7%8B%BC" target="_blank">联系我</a>
<a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/icon_weibo_24.png" alt=""></a>
<a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
<div id="author_profile_info" class="author_profile_info">
<a href="http://home.cnblogs.com/u/xdp-gacl/" target="_blank"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20160221223904.png" class="author_avatar" alt=""></a>
<div id="author_profile_detail" class="author_profile_info">
<a href="http://home.cnblogs.com/u/xdp-gacl/">孤傲苍狼</a><br>
<a href="http://home.cnblogs.com/u/xdp-gacl/followees">关注 - 83</a><br>
<a href="http://home.cnblogs.com/u/xdp-gacl/followers">粉丝 - 4889</a>
</div>
</div>
<div class="clear"></div>
<div id="author_profile_honor"></div>
<div id="author_profile_follow">
    <a href="javascript:void(0);" onclick="c_follow();return false;">+加关注</a>
</div>
</div>
<div id="div_digg">										
    <div class="diggit" onclick="votePost(4007225,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">11</span>
    </div>
	<div class="buryit" onclick="votePost(4007225,&#39;Bury&#39;)"> 
		<span class="burynum" id="bury_count">0</span>
	</div>
	<div class="clear"></div>	
	<div class="diggword" id="digg_tips">
    (请您对文章做出评价)
    </div>	
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/xdp-gacl/p/4006830.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/xdp-gacl/p/4006830.html" title="发布于2014-10-19 09:20">javaweb学习总结(四十)——编写自己的JDBC框架</a><br><a href="http://www.cnblogs.com/xdp-gacl/p/3948353.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/xdp-gacl/p/3948353.html" title="发布于2014-10-20 09:23">javaweb学习总结(四十二)——Filter(过滤器)学习</a><br></div>
</div>

</div>
    <p class="postfoot">posted on <span id="post-date">2014-10-19 20:40</span> <a href="http://www.cnblogs.com/xdp-gacl/">孤傲苍狼</a> 阅读(<span id="post_view_count">23755</span>) 评论(<span id="post_comment_count">15</span>)  <a href="http://i.cnblogs.com/EditPosts.aspx?postid=4007225" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#" onclick="AddToWz(4007225);return false;">收藏</a></p>
</div>
<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=133816,cb_entryId=4007225,cb_blogApp=currentBlogApp,cb_blogUserGuid='f1774468-815f-e011-a53f-842b2b196315',cb_entryCreatedDate='2014/10/19 20:40:00';loadViewCount(cb_entryId);</script>

</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<a name="评论"></a>
<div id="comments">
<h3>评论</h3>
	
	
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3046957" class="layer">#1楼</a><a name="3046957" id="comment_anchor_3046957"></a>
					<span>
						 <span class="comment_date">2014-10-20 09:23</span>
					</span>
				<a id="a_comment_author_3046957" href="http://www.cnblogs.com/wuhao1991/" target="_blank">郁闷的耗子</a> <a href="http://msg.cnblogs.com/send/%E9%83%81%E9%97%B7%E7%9A%84%E8%80%97%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3046957" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>DBUtils的包我一直想自己研究下，但是觉得自己不是很理解，这个包的具体功能我还是不是很懂，对了楼主，我刚刚看了下有关JDBC的模块，楼主jdbc封装后的用法特别像MyBatis这中封装该怎么做，也就是是说那些sql全部写到*.xml中，希望楼主的文章能给我一些帮助，刚刚出来的实习生就是这么苦逼啊。</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3046957,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3046957,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3046971" class="layer">#2楼</a><a name="3046971" id="comment_anchor_3046971"></a>[<span class="louzhu">楼主</span>]
					<span>
						 <span class="comment_date">2014-10-20 09:31</span>
					</span>
				<a id="a_comment_author_3046971" href="http://www.cnblogs.com/xdp-gacl/" target="_blank">孤傲苍狼</a> <a href="http://msg.cnblogs.com/send/%E5%AD%A4%E5%82%B2%E8%8B%8D%E7%8B%BC" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3046971" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3046957" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3046957);">@</a>
郁闷的耗子<br>额，MyBatis我在开发中暂时还没有使用过，这方面暂时给不了你什么实质性的建议，不过你说要把SQL写到XML中去，那么做法肯定是先解析XML中的节点，把里面的SQL获取到，然后再执行，如果SQL中有参数，那么就判断有多少个参数，然后用具体的值替换掉相应的参数。</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3046971,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3046971,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3046971_avatar" style="display:none;">http://pic.cnblogs.com/face/289233/20160221223904.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065367" class="layer">#3楼</a><a name="3065367" id="comment_anchor_3065367"></a>
					<span>
						 <span class="comment_date">2014-11-16 22:46</span>
					</span>
				<a id="a_comment_author_3065367" href="http://home.cnblogs.com/u/654140/" target="_blank">凌霄phxism</a> <a href="http://msg.cnblogs.com/send/%E5%87%8C%E9%9C%84phxism" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3065367" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>你好，博主！QueryRunner qr = new QueryRunner(JdbcUtils.getDataSource())；引用的JdbcUtils是那个上章节的工具类吗？为神马会有The method getDataSource() is undefined for the type JdbcUtils　这个报错。我在 JdbcUtils　创建了这个方法，却不知道该怎么写实现啊？能解答下吗？</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3065367,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3065367,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065616" class="layer">#4楼</a><a name="3065616" id="comment_anchor_3065616"></a>[<span class="louzhu">楼主</span>]
					<span>
						 <span class="comment_date">2014-11-17 11:29</span>
					</span>
				<a id="a_comment_author_3065616" href="http://www.cnblogs.com/xdp-gacl/" target="_blank">孤傲苍狼</a> <a href="http://msg.cnblogs.com/send/%E5%AD%A4%E5%82%B2%E8%8B%8D%E7%8B%BC" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3065616" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065367" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3065367);">@</a>
凌霄phxism<br> /**<br>    * @Method: getDataSource<br>    * @Description: 获取数据源<br>    * @Anthor:孤傲苍狼<br>    * @return DataSource<br>    */ <br>    public static DataSource getDataSource(){<br>        //从数据源中获取数据库连接<br>        return ds;<br>    }</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3065616,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3065616,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3065616_avatar" style="display:none;">http://pic.cnblogs.com/face/289233/20160221223904.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065721" class="layer">#5楼</a><a name="3065721" id="comment_anchor_3065721"></a>
					<span>
						 <span class="comment_date">2014-11-17 14:08</span>
					</span>
				<a id="a_comment_author_3065721" href="http://www.cnblogs.com/520130phx/" target="_blank">凌霄phxism</a> <a href="http://msg.cnblogs.com/send/%E5%87%8C%E9%9C%84phxism" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3065721" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065616" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3065616);">@</a>
孤傲苍狼<br></p><div class="cnblogs_Highlighter sh-gutter"><div><div id="highlighter_175086" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">me.gacl.util;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">java.sql.Connection;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">java.sql.ResultSet;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">java.sql.SQLException;</code></div><div class="line number6 index5 alt1"><code class="java keyword">import</code> <code class="java plain">java.sql.Statement;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java keyword">import</code> <code class="java plain">javax.sql.DataSource;</code></div><div class="line number9 index8 alt2"><code class="java keyword">import</code> <code class="java plain">com.mchange.v2.c3p0.ComboPooledDataSource;</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">JdbcUtils {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java plain">DataSource ds = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//在静态代码块中创建数据库连接池</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code><code class="java plain">{</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code><code class="java plain">{</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//通过读取C3P0的xml配置文件创建数据源，C3P0的xml配置文件c3p0-config.xml必须放在src目录下</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ds = </code><code class="java keyword">new</code> <code class="java plain">ComboPooledDataSource(</code><code class="java string">"MySQL"</code><code class="java plain">);</code><code class="java comments">//使用C3P0的命名配置来创建数据源</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">ExceptionInInitializerError(e);</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">Connection getConnection() </code><code class="java keyword">throws</code> <code class="java plain">SQLException{</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//从数据源中获取数据库连接</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">ds.getConnection();</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">release(Connection conn,Statement st,ResultSet rs){</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code><code class="java plain">(rs!=</code><code class="java keyword">null</code><code class="java plain">){</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code><code class="java plain">{</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//关闭存储查询结果的ResultSet对象</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rs.close();</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rs = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code><code class="java plain">(st!=</code><code class="java keyword">null</code><code class="java plain">){</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code><code class="java plain">{</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//关闭负责执行SQL命令的Statement对象</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">st.close();</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code><code class="java plain">(conn!=</code><code class="java keyword">null</code><code class="java plain">){</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code><code class="java plain">{</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//将Connection连接对象还给数据库连接池</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">conn.close();</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number59 index58 alt2">&nbsp;</div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">DataSource getDataSource() {</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TODO Auto-generated method stub</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">ds;</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number64 index63 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div><br>我根据您之前的代码改成这样的JdbcUtils.测试通过，可以实现CRUD<br>但是我有个疑问，Apache的dbutils操作数据库，必须要通过 C3P0 ，JDNI，等等技术来配置数据源才行吗？就是说JdbcUtils中至少需要得到数据源才能使用 QueryRunner qr = new QueryRunner(JdbcUtils.getDataSource());<br>那无参数的构造方法怎样操作数据库呢。。。。<p></p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3065721,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3065721,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3065721_avatar" style="display:none;">http://pic.cnblogs.com/face/654140/20140724204640.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065896" class="layer">#6楼</a><a name="3065896" id="comment_anchor_3065896"></a>[<span class="louzhu">楼主</span>]
					<span>
						 <span class="comment_date">2014-11-17 16:56</span>
					</span>
				<a id="a_comment_author_3065896" href="http://www.cnblogs.com/xdp-gacl/" target="_blank">孤傲苍狼</a> <a href="http://msg.cnblogs.com/send/%E5%AD%A4%E5%82%B2%E8%8B%8D%E7%8B%BC" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3065896" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065721" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3065721);">@</a>
凌霄phxism<br>不需要的，不要把dbutils想得太复杂，他就是一个简单的JDBC执行工具类，你只需要把数据库连接对象，SQL，以及SQL执行时使用的参数传递给他的方法，例如:<br>    public void update(Account account) throws SQLException{<br>        <br>        QueryRunner qr = new QueryRunner();<br>        String sql = "update account set name=?,money=? where id=?";<br>        Object params[] = {account.getName(),account.getMoney(),account.getId()};<br>        //使用service层传递过来的Connection对象操作数据库<br>        qr.update(conn,sql, params);<br>        <br>    }<br>然后由他来帮助我们执行SQL而已，他只是在我们平时写的JDBC代码上面简单封装了一下，获取数据库连接也不一定采用数据源的方式获取，用最原始的JDBC方式去获取就可以了</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3065896,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3065896,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3065896_avatar" style="display:none;">http://pic.cnblogs.com/face/289233/20160221223904.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065909" class="layer">#7楼</a><a name="3065909" id="comment_anchor_3065909"></a>
					<span>
						 <span class="comment_date">2014-11-17 17:05</span>
					</span>
				<a id="a_comment_author_3065909" href="http://www.cnblogs.com/520130phx/" target="_blank">凌霄phxism</a> <a href="http://msg.cnblogs.com/send/%E5%87%8C%E9%9C%84phxism" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3065909" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065896" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3065896);">@</a>
孤傲苍狼<br>明白了，谢谢啦<br>刚又想到一个问题自定义Crud操作后都会调用JdbcUtils.release(conn, st, rs);来释放连接。而你编写的 用Apache Dbutils 实现的CRUD好像没有这个步骤哦，最好加上是吧。</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3065909,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3065909,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3065909_avatar" style="display:none;">http://pic.cnblogs.com/face/654140/20140724204640.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3102628" class="layer">#8楼</a><a name="3102628" id="comment_anchor_3102628"></a>
					<span>
						 <span class="comment_date">2015-01-08 10:37</span>
					</span>
				<a id="a_comment_author_3102628" href="http://www.cnblogs.com/bluechip/" target="_blank">友人M</a> <a href="http://msg.cnblogs.com/send/%E5%8F%8B%E4%BA%BAM" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3102628" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3065909" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3065909);">@</a>
凌霄phxism<br>query方法,博主原文已写:<br>该方法会自行处理 PreparedStatement 和 ResultSet 的创建和关闭。</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3102628,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3102628,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3102628_avatar" style="display:none;">http://pic.cnblogs.com/face/665418/20140821014142.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3183199" class="layer">#9楼</a><a name="3183199" id="comment_anchor_3183199"></a>
					<span>
						 <span class="comment_date">2015-05-13 20:16</span>
					</span>
				<a id="a_comment_author_3183199" href="http://home.cnblogs.com/u/683555/" target="_blank">看看左右</a> <a href="http://msg.cnblogs.com/send/%E7%9C%8B%E7%9C%8B%E5%B7%A6%E5%8F%B3" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3183199" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>谢谢楼主分享<br>收益匪浅啊</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3183199,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3183199,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3297312" class="layer">#10楼</a><a name="3297312" id="comment_anchor_3297312"></a>
					<span>
						 <span class="comment_date">2015-11-02 19:43</span>
					</span>
				<a id="a_comment_author_3297312" href="http://home.cnblogs.com/u/618198/" target="_blank">zhrb</a> <a href="http://msg.cnblogs.com/send/zhrb" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3297312" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>JdbcUtils是楼主自己编写的获取数据库连接的工具类吧？<br>如果想使用传递连接给Dbutil的方法，博主的这个程序要改动不少吧</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3297312,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3297312,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3298841" class="layer">#11楼</a><a name="3298841" id="comment_anchor_3298841"></a>
					<span>
						 <span class="comment_date">2015-11-04 14:08</span>
					</span>
				<a id="a_comment_author_3298841" href="http://www.cnblogs.com/erptool/" target="_blank">C#_工大小辉</a> <a href="http://msg.cnblogs.com/send/C%23_%E5%B7%A5%E5%A4%A7%E5%B0%8F%E8%BE%89" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3298841" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>博主，您好，新手学习，博主，哪里能下载能讲的完整源代码，新手学习，急需代码。</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3298841,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3298841,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3298843" class="layer">#12楼</a><a name="3298843" id="comment_anchor_3298843"></a>
					<span>
						 <span class="comment_date">2015-11-04 14:09</span>
					</span>
				<a id="a_comment_author_3298843" href="http://www.cnblogs.com/erptool/" target="_blank">C#_工大小辉</a> <a href="http://msg.cnblogs.com/send/C%23_%E5%B7%A5%E5%A4%A7%E5%B0%8F%E8%BE%89" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3298843" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>如果方便，麻烦博主发我一份。 1024289938@qq.com</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3298843,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3298843,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3309561" class="layer">#13楼</a><a name="3309561" id="comment_anchor_3309561"></a>
					<span>
						 <span class="comment_date">2015-11-18 22:33</span>
					</span>
				<a id="a_comment_author_3309561" href="http://www.cnblogs.com/yygz/" target="_blank">月夜归醉</a> <a href="http://msg.cnblogs.com/send/%E6%9C%88%E5%A4%9C%E5%BD%92%E9%86%89" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3309561" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>很好的文章，感觉自己受益匪浅。不仅代码优雅，而且很好的降低耦合性！先收藏了，以后有时间慢慢品尝。赞！！！</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3309561,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3309561,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3309561_avatar" style="display:none;">http://pic.cnblogs.com/face/626374/20140622095937.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3376918" class="layer">#14楼</a><a name="3376918" id="comment_anchor_3376918"></a>
					<span>
						 <span class="comment_date">2016-03-10 15:12</span>
					</span>
				<a id="a_comment_author_3376918" href="http://www.cnblogs.com/SteadyJack/" target="_blank">稳杰</a> <a href="http://msg.cnblogs.com/send/%E7%A8%B3%E6%9D%B0" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3376918" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>真的相当不错，让我学习了！！</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3376918,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3376918,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3376918_avatar" style="display:none;">http://pic.cnblogs.com/face/899429/20160301154245.png</span>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
			<h4>
				<a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#3402672" class="layer">#15楼</a><a name="3402672" id="comment_anchor_3402672"></a><span id="comment-maxId" style="display:none;">3402672</span><span id="comment-maxDate" style="display:none;">2016/4/7 19:17:17</span>
					<span>
						 <span class="comment_date">2016-04-07 19:17</span>
					</span>
				<a id="a_comment_author_3402672" href="http://www.cnblogs.com/s502/" target="_blank">码农甲</a> <a href="http://msg.cnblogs.com/send/%E7%A0%81%E5%86%9C%E7%94%B2" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</h4>
			<p>
				</p><div id="comment_body_3402672" class="blog_comment_body"><div class="list"><table class="out" border="0" cellspacing="0" cellpadding="0"> <tbody><tr><td class="icontd" align="right" valign="bottom"><img src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/20131202131125.png" width="70px" height="57px"></td><td align="left" valign="bottom" class="q"><table border="0" cellpadding="0" cellspacing="0" style=""> <tbody><tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> <tr><td class="left"></td> <td align="left" class="conmts"><p>public static Connection getConnection() throws SQLException{<br>        //从当前线程中获取Connection<br>        Connection conn = threadLocal.get();<br>        if(conn==null){<br>            //从数据源中获取数据库连接<br>            conn = getDataSource().getConnection();<br>            //将conn绑定到当前线程<br>            threadLocal.set(conn);<br>        }<br>        return conn;<br>    }<br><br>不明白这里为什么要用threadLocal这个，直接返回getDataSource().getConnection();不就可以了吗？<br>connecton连接对象不是由C3P0数据库连接池管理的吗，还需要管它从哪个线程获取吗？<br>新手，不太明白，往楼主指教</p> </td> <td class="right"></td></tr> <tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> </tbody></table></td> </tr> </tbody></table> </div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3402672,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3402672,&#39;Bury&#39;,this)">反对(0)</a></div>
				&nbsp;&nbsp;<span class="comment_actions"></span>
			<p></p>
		
</div><div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/xdp-gacl/p/4007225.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank">【推荐】50万行VC++源码: 大型组态工控、电力仿真CAD与GIS源码库</a><br><a href="http://www.rongcloud.cn/" target="_blank">【推荐】融云即时通讯云－豆果美食、Faceu等亿级APP都在用</a><br><a href="http://www.gcpowertools.com.cn/products/spreadjs/?utm_source=cnblogs&utm_medium=blogpage&utm_term=bottom&utm_content=SpreadJS&utm_campaign=community" target="_blank">【推荐】怎样将“在线Excel“嵌入你的开发系统中？</a><br><a href="http://click.aliyun.com/m/3037/" target="_blank">【推荐】阿里云高性能云服务器+SSD云盘，让业务响应0延迟</a><br></div>
<div id="opt_under_post"></div>
<div id="ad_c1" class="c_ad_block"><a href="https://www.wilddog.com/?utm_source=cnblogs&utm_medium=banner&utm_campaign=orangemarch" target="_blank"><img width="300" height="250" src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/cnblogs-300x250-1.jpg" alt=""></a></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/545131/" target="_blank">亚马逊创始人贝索斯过去三个月资产增加180亿美元</a><br> ·  <a href="http://news.cnblogs.com/n/545130/" target="_blank">Facebook要做聊天机器人，一个月内吸引了上千开发者</a><br> ·  <a href="http://news.cnblogs.com/n/545129/" target="_blank">俞敏洪：不主张大学生创业，大学生的项目我不投！</a><br> ·  <a href="http://news.cnblogs.com/n/545128/" target="_blank">三个季度连续亏损 LG移动部门或将减员缩编</a><br> ·  <a href="http://news.cnblogs.com/n/545127/" target="_blank">微软手机最新黑科技：利用传感器“预知”用户行为</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="ad_c2" class="c_ad_block"><a href="https://www.jpush.cn/?from=cnblogs01" target="_blank"><img width="468" height="60" src="./javaweb学习总结(四十一)——Apache的DBUtils框架学习 - 孤傲苍狼 - 博客园_files/24442-20160307140747632-1210035054.jpg" alt=""></a></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/543110/" target="_blank">架构漫谈（九）：理清技术、业务和架构的关系</a><br> ·  <a href="http://kb.cnblogs.com/page/542725/" target="_blank">架构漫谈（八）：从架构的角度看如何写好代码</a><br> ·  <a href="http://kb.cnblogs.com/page/542257/" target="_blank">架构漫谈（七）：不要空设架构师这个职位，给他实权</a><br> ·  <a href="http://kb.cnblogs.com/page/541740/" target="_blank">架构漫谈（六）：软件架构到底是要解决什么问题？</a><br> ·  <a href="http://kb.cnblogs.com/page/541188/" target="_blank">架构漫谈（五）：什么是软件</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);    
});
</script>
</div>


</div>
<div id="rightmenu">
	
		
<div id="my_links">
<h3>导航</h3>
<ul>
<li><a id="MyLinks1_HomeLink" href="http://www.cnblogs.com/">博客园</a></li>
<li><a id="MyLinks1_MyHomeLink" href="http://www.cnblogs.com/xdp-gacl/">首页</a></li>
<!--<li><a id="MyLinks1_NewPostLink" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>-->
<li><a id="MyLinks1_ContactLink" rel="nofollow" href="http://msg.cnblogs.com/send/%E5%AD%A4%E5%82%B2%E8%8B%8D%E7%8B%BC">联系</a></li>
<li><a id="MyLinks1_Syndication" href="http://www.cnblogs.com/xdp-gacl/rss">订阅</a></li><!--<a id="MyLinks1_XMLLink" href="http://www.cnblogs.com/xdp-gacl/rss"><img src="http://www.cnblogs.com/images/xml.gif" alt="订阅" /></a>-->
<li><a id="MyLinks1_Admin" rel="nofollow" href="http://i.cnblogs.com/">管理</a></li>
</ul>
</div>
		<div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2016/04/01&#39;);return false;">&lt;</a></td><td align="center">2016年5月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2016/06/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">24</td><td class="CalOtherMonthDay" align="center">25</td><td class="CalOtherMonthDay" align="center">26</td><td class="CalOtherMonthDay" align="center">27</td><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td></tr><tr><td class="CalWeekendDay" align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">6</td><td class="CalWeekendDay" align="center">7</td></tr><tr><td class="CalWeekendDay" align="center">8</td><td align="center">9</td><td align="center">10</td><td class="CalTodayDay" align="center">11</td><td align="center">12</td><td align="center">13</td><td class="CalWeekendDay" align="center">14</td></tr><tr><td class="CalWeekendDay" align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td align="center">19</td><td align="center">20</td><td class="CalWeekendDay" align="center">21</td></tr><tr><td class="CalWeekendDay" align="center">22</td><td align="center">23</td><td align="center">24</td><td align="center">25</td><td align="center">26</td><td align="center">27</td><td class="CalWeekendDay" align="center">28</td></tr><tr><td class="CalWeekendDay" align="center">29</td><td align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
		
<h3>公告</h3>
<div class="newsItem">
	<div id="blog-news"><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/xdp-gacl/">孤傲苍狼</a><br>园龄：<a href="http://home.cnblogs.com/u/xdp-gacl/" title="入园时间：2011-04-05">5年1个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/xdp-gacl/followers/">4889</a><br>关注：<a href="http://home.cnblogs.com/u/xdp-gacl/followees/">83</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="cnblogs.UserManager.FollowBlogger(&#39;f1774468-815f-e011-a53f-842b2b196315&#39;)">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>
</div>		
		
<div id="blog_stats">
<h3>统计</h3>
<ul>
<li>随笔 - 275
</li><li>文章 - 0
</li><li>评论 - 1503
<!--<li>引用 - 0-->
</li>
</ul>
</div>
		<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/xdp-gacl/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">

</div></div><div id="sidebar_toptags" class="sidebar-block">
<h3 class="catListTitle">我的标签</h3>
<div id="MyTag">
<ul>
<li><a href="http://www.cnblogs.com/xdp-gacl/tag/JavaWeb%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">JavaWeb学习总结</a>(62)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/java%E5%9F%BA%E7%A1%80%E6%80%BB%E7%BB%93/">java基础总结</a>(28)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/Javascript%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">Javascript学习总结</a>(27)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/Snmp%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">Snmp学习总结</a>(15)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/MyEclipse%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/">MyEclipse使用总结</a>(13)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/Android%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">Android开发学习总结</a>(13)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/Maven%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">Maven学习总结</a>(11)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/WebLogic%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/">WebLogic使用总结</a>(9)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/MyBatis%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">MyBatis学习总结</a>(8)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/MySQL%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">MySQL学习总结</a>(8)</li><li><a href="http://www.cnblogs.com/xdp-gacl/tag/">更多</a></li>
</ul>
</div></div><div id="sidebar_categories">
		<h3>随笔分类</h3>
		
				<ul>
			
				<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/xdp-gacl/category/431986.html">AJAX(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/xdp-gacl/category/663970.html">Android开发(12)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/xdp-gacl/category/431983.html">ASP.NET(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/xdp-gacl/category/431981.html">C#(8)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/xdp-gacl/category/647917.html">CSS学习总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/xdp-gacl/category/557089.html">C语言学习总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_6" href="http://www.cnblogs.com/xdp-gacl/category/605855.html">FusionCharts</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_7" href="http://www.cnblogs.com/xdp-gacl/category/641669.html">H2数据库学习使用总结(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_8" href="http://www.cnblogs.com/xdp-gacl/category/601788.html">Hessian(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_9" href="http://www.cnblogs.com/xdp-gacl/category/557131.html">Hibernate</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_10" href="http://www.cnblogs.com/xdp-gacl/category/602554.html">Highcharts</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_11" href="http://www.cnblogs.com/xdp-gacl/category/544383.html">HTML(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_12" href="http://www.cnblogs.com/xdp-gacl/category/791376.html">html5学习使用总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_13" href="http://www.cnblogs.com/xdp-gacl/category/647915.html">Html学习总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_14" href="http://www.cnblogs.com/xdp-gacl/category/431984.html">Java(13)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_15" href="http://www.cnblogs.com/xdp-gacl/category/431982.html">JavaScript(27)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_16" href="http://www.cnblogs.com/xdp-gacl/category/574705.html">JavaWeb学习总结(55)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_17" href="http://www.cnblogs.com/xdp-gacl/category/563691.html">Java基础加强总结(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_18" href="http://www.cnblogs.com/xdp-gacl/category/566451.html">java基础面试题(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_19" href="http://www.cnblogs.com/xdp-gacl/category/563690.html">java基础总结(28)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_20" href="http://www.cnblogs.com/xdp-gacl/category/595905.html">Java监控</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_21" href="http://www.cnblogs.com/xdp-gacl/category/607504.html">Java事务处理</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_22" href="http://www.cnblogs.com/xdp-gacl/category/600539.html">java字节码的处理技术</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_23" href="http://www.cnblogs.com/xdp-gacl/category/636007.html">JFinal学习研究</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_24" href="http://www.cnblogs.com/xdp-gacl/category/609326.html">JNDI(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_25" href="http://www.cnblogs.com/xdp-gacl/category/571424.html">Jquery EasyUI学习使用总结(7)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_26" href="http://www.cnblogs.com/xdp-gacl/category/600080.html">jwebap</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_27" href="http://www.cnblogs.com/xdp-gacl/category/599454.html">kafka</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_28" href="http://www.cnblogs.com/xdp-gacl/category/590574.html">LDAP</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_29" href="http://www.cnblogs.com/xdp-gacl/category/620197.html">Linux学习总结(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_30" href="http://www.cnblogs.com/xdp-gacl/category/544719.html">Maven(10)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_31" href="http://www.cnblogs.com/xdp-gacl/category/599453.html">Mina</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_32" href="http://www.cnblogs.com/xdp-gacl/category/655890.html">Mybatis(8)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_33" href="http://www.cnblogs.com/xdp-gacl/category/544414.html">MyEclipse(11)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_34" href="http://www.cnblogs.com/xdp-gacl/category/557132.html">MySQL(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_35" href="http://www.cnblogs.com/xdp-gacl/category/576035.html">Nginx(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_36" href="http://www.cnblogs.com/xdp-gacl/category/567838.html">Oracle学习使用总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_37" href="http://www.cnblogs.com/xdp-gacl/category/562877.html">PowerDesigner使用总结(5)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_38" href="http://www.cnblogs.com/xdp-gacl/category/640475.html">redis</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_39" href="http://www.cnblogs.com/xdp-gacl/category/591218.html">RESTful架构(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_40" href="http://www.cnblogs.com/xdp-gacl/category/649781.html">Servlet3.0(4)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_41" href="http://www.cnblogs.com/xdp-gacl/category/613358.html">Snmp学习总结(8)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_42" href="http://www.cnblogs.com/xdp-gacl/category/544380.html">Spring(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_43" href="http://www.cnblogs.com/xdp-gacl/category/654626.html">SpringMVC学习总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_44" href="http://www.cnblogs.com/xdp-gacl/category/543327.html">SQLServer(4)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_45" href="http://www.cnblogs.com/xdp-gacl/category/543338.html">Struts2(4)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_46" href="http://www.cnblogs.com/xdp-gacl/category/737796.html">SVN</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_47" href="http://www.cnblogs.com/xdp-gacl/category/544377.html">VB.NET(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_48" href="http://www.cnblogs.com/xdp-gacl/category/637206.html">WebLogic使用总结(8)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_49" href="http://www.cnblogs.com/xdp-gacl/category/629559.html">WebService学习总结(4)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_50" href="http://www.cnblogs.com/xdp-gacl/category/787823.html">WebSocket(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_51" href="http://www.cnblogs.com/xdp-gacl/category/554263.html">WinForm学习总结</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_52" href="http://www.cnblogs.com/xdp-gacl/category/602889.html">XML学习总结(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_53" href="http://www.cnblogs.com/xdp-gacl/category/551491.html">插件化开发</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_54" href="http://www.cnblogs.com/xdp-gacl/category/598077.html">创业知识(5)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_55" href="http://www.cnblogs.com/xdp-gacl/category/651090.html">大数据/hadoop(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_56" href="http://www.cnblogs.com/xdp-gacl/category/645953.html">代码注释(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_57" href="http://www.cnblogs.com/xdp-gacl/category/588156.html">单点登录(Yale_CAS_SSO)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_58" href="http://www.cnblogs.com/xdp-gacl/category/710266.html">电脑基本技能</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_59" href="http://www.cnblogs.com/xdp-gacl/category/636430.html">读书笔记</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_60" href="http://www.cnblogs.com/xdp-gacl/category/635429.html">负载均衡(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_61" href="http://www.cnblogs.com/xdp-gacl/category/543351.html">互联网基础(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_62" href="http://www.cnblogs.com/xdp-gacl/category/644775.html">缓存框架</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_63" href="http://www.cnblogs.com/xdp-gacl/category/801455.html">架构设计</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_64" href="http://www.cnblogs.com/xdp-gacl/category/661363.html">框架整合(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_65" href="http://www.cnblogs.com/xdp-gacl/category/810590.html">敏捷开发(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_66" href="http://www.cnblogs.com/xdp-gacl/category/591507.html">权限设计</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_67" href="http://www.cnblogs.com/xdp-gacl/category/431985.html">生活感悟(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_68" href="http://www.cnblogs.com/xdp-gacl/category/589802.html">数据库Sharding(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_69" href="http://www.cnblogs.com/xdp-gacl/category/562913.html">数据库理论基础(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_70" href="http://www.cnblogs.com/xdp-gacl/category/608526.html">微信开发(3)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_71" href="http://www.cnblogs.com/xdp-gacl/category/811446.html">我的开发框架</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_72" href="http://www.cnblogs.com/xdp-gacl/category/806539.html">项目管理(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_73" href="http://www.cnblogs.com/xdp-gacl/category/654566.html">英语学习</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_74" href="http://www.cnblogs.com/xdp-gacl/category/578277.html">原创小工具(1)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_75" href="http://www.cnblogs.com/xdp-gacl/category/594056.html">云计算(2)</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_76" href="http://www.cnblogs.com/xdp-gacl/category/598078.html">哲学人生</a> </li>
			
				<li><a id="CatList_LinkList_0_Link_77" href="http://www.cnblogs.com/xdp-gacl/category/596451.html">职场感悟(3)</a> </li>
			
				</ul>
			
	
		<h3>随笔档案</h3>
		
				<ul>
			
				<li><a id="CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/xdp-gacl/archive/2016/04.html">2016年4月 (5)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/xdp-gacl/archive/2016/03.html">2016年3月 (5)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/xdp-gacl/archive/2016/02.html">2016年2月 (3)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/xdp-gacl/archive/2016/01.html">2016年1月 (2)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/xdp-gacl/archive/2015/07.html">2015年7月 (11)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/xdp-gacl/archive/2015/03.html">2015年3月 (12)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_6" href="http://www.cnblogs.com/xdp-gacl/archive/2015/02.html">2015年2月 (6)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_7" href="http://www.cnblogs.com/xdp-gacl/archive/2015/01.html">2015年1月 (40)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_8" href="http://www.cnblogs.com/xdp-gacl/archive/2014/12.html">2014年12月 (17)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_9" href="http://www.cnblogs.com/xdp-gacl/archive/2014/11.html">2014年11月 (12)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_10" href="http://www.cnblogs.com/xdp-gacl/archive/2014/10.html">2014年10月 (31)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_11" href="http://www.cnblogs.com/xdp-gacl/archive/2014/08.html">2014年8月 (10)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_12" href="http://www.cnblogs.com/xdp-gacl/archive/2014/07.html">2014年7月 (25)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_13" href="http://www.cnblogs.com/xdp-gacl/archive/2014/06.html">2014年6月 (6)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_14" href="http://www.cnblogs.com/xdp-gacl/archive/2014/05.html">2014年5月 (10)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_15" href="http://www.cnblogs.com/xdp-gacl/archive/2014/04.html">2014年4月 (22)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_16" href="http://www.cnblogs.com/xdp-gacl/archive/2014/03.html">2014年3月 (28)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_17" href="http://www.cnblogs.com/xdp-gacl/archive/2014/02.html">2014年2月 (11)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_18" href="http://www.cnblogs.com/xdp-gacl/archive/2014/01.html">2014年1月 (2)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_19" href="http://www.cnblogs.com/xdp-gacl/archive/2013/12.html">2013年12月 (16)</a> </li>
			
				<li><a id="CatList_LinkList_1_Link_20" href="http://www.cnblogs.com/xdp-gacl/archive/2012/11.html">2012年11月 (1)</a> </li>
			
				</ul>
			
	</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<h3 class="catListTitle">最新评论</h3>
<div class="RecentComment" id="RecentComments">
	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3495887.html#3427933">1. Re:Spring常用注解</a></li>
        <li class="recent_comment_body">通俗易懂，谢谢博主的分享。</li>
        <li class="recent_comment_author">--Xsum</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3637073.html#3427806">2. Re:java基础学习总结——equals方法</a></li>
        <li class="recent_comment_body">楼主写得很好，简单明了</li>
        <li class="recent_comment_author">--bequt</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3983253.html#3427770">3. Re:javaweb学习总结(三十六)——使用JDBC进行批处理</a></li>
        <li class="recent_comment_body">顶</li>
        <li class="recent_comment_author">--孟妹</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/4261895.html#3427757">4. Re:MyBatis学习总结(一)——MyBatis快速入门</a></li>
        <li class="recent_comment_body">感谢你，讲的很详细</li>
        <li class="recent_comment_author">--zimu1990</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3908610.html#3427733">5. Re:javaweb学习总结(二十一)——JavaWeb的两种开发模式</a></li>
        <li class="recent_comment_body">写的实在是太好了</li>
        <li class="recent_comment_author">--寻影657</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/4240930.html#3427216">6. Re:Maven学习总结(三)——使用Maven构建项目</a></li>
        <li class="recent_comment_body">真心不错</li>
        <li class="recent_comment_author">--奕p</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3760336.html#3426738">7. Re:javaweb学习总结(五)——Servlet开发(一)</a></li>
        <li class="recent_comment_body">请教下楼主，上面为servlet映射url是在config里面的web.xml还是WEB-INF里的web.xml里创建啊？小白不懂求指导。</li>
        <li class="recent_comment_author">--metaluo</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/3729033.html#3425929">8. Re:JavaWeb学习总结(一)——JavaWeb开发入门</a></li>
        <li class="recent_comment_body">LZ肯定对大家这么弱鸡而无语</li>
        <li class="recent_comment_author">--March On</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/4200090.html#3425801">9. Re:JavaWeb学习总结(五十)——文件上传和下载</a></li>
        <li class="recent_comment_body">博主大赞，如果能有上传到数据库就更好了</li>
        <li class="recent_comment_author">--Charming2Future</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xdp-gacl/p/4271627.html#3425140">10. Re:MyBatis学习总结(八)——Mybatis3.x与Spring4.x整合</a></li>
        <li class="recent_comment_body">博主 我的项目在运行时报错：org.springframework.beans.factory.BeanCreationException: Error creating bean with nam......</li>
        <li class="recent_comment_author">--xkpactera</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<h3 class="catListTitle">阅读排行榜</h3>
<div class="RecentComment" id="TopViewPosts"> 
	<div id="TopViewPostsBlock"><ul><li><a href="http://www.cnblogs.com/xdp-gacl/p/4261895.html">1. MyBatis学习总结(一)——MyBatis快速入门(154164)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3497016.html">2. MyEclipse使用总结——MyEclipse10安装SVN插件(139728)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4200090.html">3. JavaWeb学习总结(五十)——文件上传和下载(100170)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3760336.html">4. javaweb学习总结(五)——Servlet开发(一)(99507)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3729033.html">5. JavaWeb学习总结(一)——JavaWeb开发入门(86497)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4322165.html">6. Android开发学习总结(一)——搭建最新版本的Android开发环境(79094)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3495887.html">7. Spring常用注解(72114)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3777987.html">8. Java基础学习总结——Java对象的序列化和反序列化(61572)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3902537.html">9. javaweb学习总结(二十二)——基于Servlet+JSP+JavaBean开发模式的用户登录注册(57260)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3734395.html">10. JavaWeb学习总结(二)——Tomcat服务器学习和使用(一)(51493)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<h3 class="catListTitle">评论排行榜</h3>
<div class="RecentComment" id="TopCommentsPosts">
	<div id="TopFeedbackPostsBlock"><ul><li><a href="http://www.cnblogs.com/xdp-gacl/p/4200090.html">1. JavaWeb学习总结(五十)——文件上传和下载(80)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3902537.html">2. javaweb学习总结(二十二)——基于Servlet+JSP+JavaBean开发模式的用户登录注册(57)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4261895.html">3. MyBatis学习总结(一)——MyBatis快速入门(52)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3751277.html">4. javaweb学习总结(四)——Http协议(43)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3729033.html">5. JavaWeb学习总结(一)——JavaWeb开发入门(42)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3718879.html">6. JavaScript自动生成博文目录导航(40)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3760336.html">7. javaweb学习总结(五)——Servlet开发(一)(39)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4239501.html">8. 使用Maven搭建Struts2+Spring3+Hibernate4的整合开发环境(34)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4271627.html">9. MyBatis学习总结(八)——Mybatis3.x与Spring4.x整合(32)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4322165.html">10. Android开发学习总结(一)——搭建最新版本的Android开发环境(31)</a></li></ul></div>
</div></div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<h3 class="catListTitle">推荐排行榜</h3>
<div class="RecentComment">
	<div id="TopDiggPostsBlock"><ul><li><a href="http://www.cnblogs.com/xdp-gacl/p/4261895.html">1. MyBatis学习总结(一)——MyBatis快速入门(63)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3760336.html">2. javaweb学习总结(五)——Servlet开发(一)(56)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3729033.html">3. JavaWeb学习总结(一)——JavaWeb开发入门(48)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4200090.html">4. JavaWeb学习总结(五十)——文件上传和下载(47)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3902537.html">5. javaweb学习总结(二十二)——基于Servlet+JSP+JavaBean开发模式的用户登录注册(41)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4271627.html">6. MyBatis学习总结(八)——Mybatis3.x与Spring4.x整合(37)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/5149171.html">7. 微信开发学习总结（一）——微信开发环境搭建(36)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3718879.html">8. JavaScript自动生成博文目录导航(36)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/4322165.html">9. Android开发学习总结(一)——搭建最新版本的Android开发环境(35)</a></li><li><a href="http://www.cnblogs.com/xdp-gacl/p/3751277.html">10. javaweb学习总结(四)——Http协议(34)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
        
		
<div id="footer">
	Powered by: 
	<br>
	
	<a id="Footer1_Hyperlink3" name="Hyperlink1" href="http://www.cnblogs.com/" style="font-family:Verdana;font-size:12px;">博客园</a>
	<br>
	Copyright © 孤傲苍狼
</div>
	
</div>			
			
	

<!--PageEndHtml Block Begin-->
<!--评论，生成气泡效果标签代码-->
<script type="text/javascript" language="javascript"> 
    $(document).ready(function() {
        var commentTime = setInterval(function(){if($("#comments_pager_bottom").length>0){CommentBubble();clearTimeout(commentTime);}},50);
    }); 
    function CommentBubble()
    {
var w1 = '<div class="list">' +
        '<table class="out" border="0" cellspacing="0" cellpadding="0"> ' +
            '<tr>' +
                '<td class="icontd" align="right" valign="bottom">' +
                    '<img src="http://pic.cnitblog.com/face/289233/20131202131125.png" width="70px" height="57px"/>' +
                '</td>' +
                '<td align="left" valign="bottom" class="q">' +
                    '<table border="0" cellpadding="0" cellspacing="0" style=""> ' +
                        '<tr><td class="topleft"></td><td class="top"></td><td class="topright"></td></tr> ' +
                        '<tr><td class="left"></td> <td align="left" class="conmts"><p>';
 
 
        var w2 = '</p> </td> <td class="right"></td></tr> ' +
                        '<tr><td class="bottomleft"></td><td class="bottom"></td><td class="bottomright"></td></tr> ' +
                    '</table>' +
                '</td> ' +
            '</tr> ' +
        '</table> ' +
    '</div>';
 
        $.each($(".blog_comment_body"), function(i, t) {
            $(t).html(w1 + $(t).html() + w2);
        });
$(".louzhu").closest(".feedbackItem").find(".out").removeClass("out").addClass("inc");
        /*.find(".q").attr("align","right");*/
        }
</script>
<!--PageEndHtml Block End-->


<div class="sideBar" id="sideBar"><div id="sideBarTab"><h2>目录导航</h2></div><div id="sideBarContents" style="display: none;"><dl><dt name="0">一、commons-dbutils简介　</dt><dt name="1">二、QueryRunner类使用讲解</dt><dd name="2">2.1、QueryRunner类的主要方法</dd><dd name="3">2.2、使用QueryRunner类实现CRUD</dd><dt name="4">三、ResultSetHandler接口使用讲解</dt><dd name="5">3.1、ResultSetHandler接口的实现类</dd><dd name="6">3.2、测试dbutils各种类型的处理器</dd><dt name="7">三、DbUtils类使用讲解</dt><dt name="8">四、JDBC开发中的事务处理</dt><dd name="9">4.1、在数据访问层(Dao)中处理事务</dd><dd name="10">4.2、在业务层(BusinessService)处理事务</dd><dd name="11">4.3、使用ThreadLocal进行更加优雅的事务处理</dd><dd name="12">4.4、ThreadLocal + Filter 处理事务</dd></dl></div></div></body></html>